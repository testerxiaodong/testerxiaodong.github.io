[{"content":"Elasticsearchä»‹ç» Elasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼Œèƒ½å¤Ÿè¿‘å®æ—¶åœ°å¯¼å…¥ã€ç´¢å¼•å’Œç®¡ç†å„ç§ç±»å‹çš„æ•°æ®ï¼Œä½¿å…¶æ—¢å¯æœç´¢åˆå¯åˆ†æã€‚å‡­å€Ÿä¸“ä¸šçš„ç”¨æˆ·ç•Œé¢å’Œå·¥å…·ï¼Œå®ƒæä¾›äº†åˆ›å»ºã€éƒ¨ç½²å’Œè¿è¡Œå„ç§åº”ç”¨çš„çµæ´»æ€§ï¼Œä»æœç´¢åˆ°åˆ†æå†åˆ° AI é©±åŠ¨çš„è§£å†³æ–¹æ¡ˆã€‚\nä»¥ä¸‹æ˜¯Elasticsearchçš„ä½¿ç”¨æ¡ˆä¾‹ï¼š\nç”¨ä¾‹ ä¸šåŠ¡ç›®æ ‡ æŠ€æœ¯è¦æ±‚ å‘é‡æœç´¢/æ··åˆæœç´¢ è¿è¡Œæœ€è¿‘é‚»æœç´¢ï¼Œç»“åˆæ–‡æœ¬ç”Ÿæˆæ··åˆç»“æœ å¯†é›†åµŒå…¥ã€ç¨€ç–åµŒå…¥ï¼Œç»“åˆæ–‡æœ¬/BM25 ç”µå­å•†åŠ¡/äº§å“ç›®å½•æœç´¢ æä¾›å¿«é€Ÿã€ç›¸å…³ä¸”æœ€æ–°çš„ç»“æœï¼Œåˆ†é¢å¯¼èˆª åº“å­˜åŒæ­¥ã€ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªã€ç»“æœç¼“å­˜ å·¥ä½œåœºæ‰€/çŸ¥è¯†åº“æœç´¢ è·¨æ•°æ®æºæœç´¢ï¼Œæ‰§è¡Œæƒé™ ç¬¬ä¸‰æ–¹è¿æ¥å™¨ã€æ–‡æ¡£çº§å®‰å…¨ã€è§’è‰²æ˜ å°„ ç½‘ç«™æœç´¢ æä¾›ç›¸å…³ä¸”æœ€æ–°çš„ç»“æœ ç½‘é¡µçˆ¬å–ã€å¢é‡ç´¢å¼•ã€æŸ¥è¯¢ç¼“å­˜ å®¢æˆ·æ”¯æŒæœç´¢ å‘ˆç°ç›¸å…³è§£å†³æ–¹æ¡ˆï¼Œç®¡ç†è®¿é—®æ§åˆ¶ï¼Œè·Ÿè¸ªæŒ‡æ ‡ çŸ¥è¯†å›¾è°±ã€åŸºäºè§’è‰²çš„è®¿é—®ã€åˆ†æ èŠå¤©æœºå™¨äºº/RAG ä¿ƒè¿›è‡ªç„¶å¯¹è¯ï¼Œæä¾›èƒŒæ™¯ï¼Œä¿æŒçŸ¥è¯† çŸ¢é‡æœç´¢ã€æœºå™¨å­¦ä¹ æ¨¡å‹ã€çŸ¥è¯†åº“é›†æˆ åœ°ç†ç©ºé—´æœç´¢ è¿›ç¨‹ä½ç½®æŸ¥è¯¢ï¼ŒæŒ‰è·ç¦»æ’åºï¼ŒæŒ‰åŒºåŸŸç­›é€‰ åœ°ç†æ˜ å°„ã€ç©ºé—´ç´¢å¼•ã€è·ç¦»è®¡ç®— æœ€è¿‘å·¥ä½œå†…å®¹å’ŒElasticsearchç›¸å…³ï¼ŒåŒ…æ‹¬ElasticsearchæŸ¥è¯¢å‹æµ‹ä»¥åŠæ€§èƒ½ä¼˜åŒ–ï¼Œå› æ­¤å†™ä¸€ç¯‡åšå®¢è®°å½•ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ç‚¹ã€‚\nç´¢å¼•åŸºç¡€ ç´¢å¼•æ˜¯Elasticsearchä¸­å­˜å‚¨çš„åŸºæœ¬å•ä½ã€‚å®ƒæ˜¯ä¸€ç»„é€šè¿‡åå­—æˆ–åˆ«åå”¯ä¸€æ ‡è¯†çš„æ–‡ä»¶ã€‚è¿™ä¸ªå”¯ä¸€åç§°å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒç”¨äºæœç´¢æŸ¥è¯¢å’Œå…¶ä»–ä½œä¸­é’ˆå¯¹è¯¥ç´¢å¼•ã€‚\nç´¢å¼•ç”±ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ç»„æˆï¼š\nDocuments(æ–‡æ¡£) Metadata fields(å…ƒæ•°æ®å­—æ®µ) Mappings and data types(æ˜ å°„ä¸æ•°æ®ç±»å‹) Documents Elasticsearchä»¥JSONæ–‡æ¡£çš„å½¢å¼åºåˆ—åŒ–å’Œå­˜å‚¨æ•°æ®ã€‚æ–‡æ¡£æ˜¯ä¸€ç»„å­—æ®µï¼Œè¿™äº›å­—æ®µæ˜¯åŒ…å«ä½ æ•°æ®çš„é”®å€¼å¯¹ã€‚æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰å”¯ä¸€çš„IDï¼Œä½ å¯ä»¥åˆ›å»ºIDï¼Œä¹Ÿå¯ä»¥è®©Elasticsearchè‡ªåŠ¨ç”Ÿæˆã€‚\nä¸€ä¸ªç®€å•çš„ Elasticsearch æ–‡æ¡£å¯èƒ½å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 { \u0026#34;_index\u0026#34;: \u0026#34;my-first-elasticsearch-index\u0026#34;, \u0026#34;_id\u0026#34;: \u0026#34;DyFpo5EBxE8fzbb95DOa\u0026#34;, \u0026#34;_version\u0026#34;: 1, \u0026#34;_seq_no\u0026#34;: 0, \u0026#34;_primary_term\u0026#34;: 1, \u0026#34;found\u0026#34;: true, \u0026#34;_source\u0026#34;: { \u0026#34;email\u0026#34;: \u0026#34;john@smith.com\u0026#34;, \u0026#34;first_name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;last_name\u0026#34;: \u0026#34;Smith\u0026#34;, \u0026#34;info\u0026#34;: { \u0026#34;bio\u0026#34;: \u0026#34;Eco-warrior and defender of the weak\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;interests\u0026#34;: [ \u0026#34;dolphins\u0026#34;, \u0026#34;whales\u0026#34; ] }, \u0026#34;join_date\u0026#34;: \u0026#34;2024/05/01\u0026#34; } } Metadata fields ç´¢å¼•æ–‡æ¡£åŒ…å«æ•°æ®å’Œå…ƒæ•°æ®ã€‚ å…ƒæ•°æ®å­—æ®µæ˜¯å­˜å‚¨æ–‡æ¡£ä¿¡æ¯çš„ç³»ç»Ÿå­—æ®µã€‚åœ¨ Elasticsearch ä¸­ï¼Œå…ƒæ•°æ®å­—æ®µå‰åŠ ä¸‹åˆ’çº¿ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å­—æ®µæ˜¯å…ƒæ•°æ®å­—æ®µï¼š\n_indexï¼šæ–‡æ¡£å­˜å‚¨çš„ç´¢å¼•åç§°ã€‚ _idï¼šæ–‡æ¡£çš„ IDã€‚ID å¿…é¡»åœ¨æ¯ä¸ªç´¢å¼•ä¸­å”¯ä¸€ã€‚ Mappings and data types æ¯ä¸ªç´¢å¼•éƒ½æœ‰ä¸€ä¸ªmappingæˆ–schemaï¼Œç”¨äºæè¿°æ–‡æ¡£ä¸­å­—æ®µçš„ç´¢å¼•æ–¹å¼ã€‚æ˜ å°„å®šä¹‰äº†æ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ ã€å­—æ®µåº”å¦‚ä½•ç´¢å¼•ä»¥åŠå­˜å‚¨æ–¹å¼ã€‚\nåˆ›å»ºç´¢å¼• 1 PUT /books æ·»åŠ å•ä¸€æ–‡æ¡£ è¯·ä½¿ç”¨ä»¥ä¸‹è¯·æ±‚å°†å•ä¸€æ–‡æ¡£æ·»åŠ åˆ°å›¾ä¹¦ç´¢å¼•ä¸­ã€‚å¦‚æœç´¢å¼•è¿˜ä¸å­˜åœ¨ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šè‡ªåŠ¨ç”Ÿæˆå®ƒã€‚\n1 2 3 4 5 6 7 POST books/_doc { \u0026#34;name\u0026#34;: \u0026#34;Snow Crash\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Neal Stephenson\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;1992-06-01\u0026#34;, \u0026#34;page_count\u0026#34;: 470 } æ·»åŠ å¤šä»½æ–‡æ¡£ 1 2 3 4 5 6 7 8 9 10 11 POST /_bulk { \u0026#34;index\u0026#34; : { \u0026#34;_index\u0026#34; : \u0026#34;books\u0026#34; } } {\u0026#34;name\u0026#34;: \u0026#34;Revelation Space\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Alastair Reynolds\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;2000-03-15\u0026#34;, \u0026#34;page_count\u0026#34;: 585} { \u0026#34;index\u0026#34; : { \u0026#34;_index\u0026#34; : \u0026#34;books\u0026#34; } } {\u0026#34;name\u0026#34;: \u0026#34;1984\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;George Orwell\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;1985-06-01\u0026#34;, \u0026#34;page_count\u0026#34;: 328} { \u0026#34;index\u0026#34; : { \u0026#34;_index\u0026#34; : \u0026#34;books\u0026#34; } } {\u0026#34;name\u0026#34;: \u0026#34;Fahrenheit 451\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Ray Bradbury\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;1953-10-15\u0026#34;, \u0026#34;page_count\u0026#34;: 227} { \u0026#34;index\u0026#34; : { \u0026#34;_index\u0026#34; : \u0026#34;books\u0026#34; } } {\u0026#34;name\u0026#34;: \u0026#34;Brave New World\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Aldous Huxley\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;1932-06-01\u0026#34;, \u0026#34;page_count\u0026#34;: 268} { \u0026#34;index\u0026#34; : { \u0026#34;_index\u0026#34; : \u0026#34;books\u0026#34; } } {\u0026#34;name\u0026#34;: \u0026#34;The Handmaids Tale\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Margaret Atwood\u0026#34;, \u0026#34;release_date\u0026#34;: \u0026#34;1985-06-01\u0026#34;, \u0026#34;page_count\u0026#34;: 311} QueryDSL å…¨æ–‡æœç´¢éœ€è¦çš„æ˜¯_search API å’Œ Query DSL\nå…ˆåˆ›å»ºç´¢å¼•\n1 PUT /cooking_blog åˆ›å»ºæ˜ å°„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 PUT /cooking_blog/_mapping { \u0026#34;properties\u0026#34;: { \u0026#34;title\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;analyzer\u0026#34;: \u0026#34;standard\u0026#34;, \u0026#34;fields\u0026#34;: { \u0026#34;keyword\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;keyword\u0026#34;, \u0026#34;ignore_above\u0026#34;: 256 } } }, \u0026#34;description\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;fields\u0026#34;: { \u0026#34;keyword\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;keyword\u0026#34; } } }, \u0026#34;author\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;fields\u0026#34;: { \u0026#34;keyword\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;keyword\u0026#34; } } }, \u0026#34;date\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;date\u0026#34;, \u0026#34;format\u0026#34;: \u0026#34;yyyy-MM-dd\u0026#34; }, \u0026#34;category\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;fields\u0026#34;: { \u0026#34;keyword\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;keyword\u0026#34; } } }, \u0026#34;tags\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;text\u0026#34;, \u0026#34;fields\u0026#34;: { \u0026#34;keyword\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;keyword\u0026#34; } } }, \u0026#34;rating\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;float\u0026#34; } } } æ‰¹é‡æ·»åŠ æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 POST /cooking_blog/_bulk?refresh=wait_for {\u0026#34;index\u0026#34;:{\u0026#34;_id\u0026#34;:\u0026#34;1\u0026#34;}} {\u0026#34;title\u0026#34;:\u0026#34;Perfect Pancakes: A Fluffy Breakfast Delight\u0026#34;,\u0026#34;description\u0026#34;:\u0026#34;Learn the secrets to making the fluffiest pancakes, so amazing you won\u0026#39;t believe your tastebuds. This recipe uses buttermilk and a special folding technique to create light, airy pancakes that are perfect for lazy Sunday mornings.\u0026#34;,\u0026#34;author\u0026#34;:\u0026#34;Maria Rodriguez\u0026#34;,\u0026#34;date\u0026#34;:\u0026#34;2023-05-01\u0026#34;,\u0026#34;category\u0026#34;:\u0026#34;Breakfast\u0026#34;,\u0026#34;tags\u0026#34;:[\u0026#34;pancakes\u0026#34;,\u0026#34;breakfast\u0026#34;,\u0026#34;easy recipes\u0026#34;],\u0026#34;rating\u0026#34;:4.8} {\u0026#34;index\u0026#34;:{\u0026#34;_id\u0026#34;:\u0026#34;2\u0026#34;}} {\u0026#34;title\u0026#34;:\u0026#34;Spicy Thai Green Curry: A Vegetarian Adventure\u0026#34;,\u0026#34;description\u0026#34;:\u0026#34;Dive into the flavors of Thailand with this vibrant green curry. Packed with vegetables and aromatic herbs, this dish is both healthy and satisfying. Don\u0026#39;t worry about the heat - you can easily adjust the spice level to your liking.\u0026#34;,\u0026#34;author\u0026#34;:\u0026#34;Liam Chen\u0026#34;,\u0026#34;date\u0026#34;:\u0026#34;2023-05-05\u0026#34;,\u0026#34;category\u0026#34;:\u0026#34;Main Course\u0026#34;,\u0026#34;tags\u0026#34;:[\u0026#34;thai\u0026#34;,\u0026#34;vegetarian\u0026#34;,\u0026#34;curry\u0026#34;,\u0026#34;spicy\u0026#34;],\u0026#34;rating\u0026#34;:4.6} {\u0026#34;index\u0026#34;:{\u0026#34;_id\u0026#34;:\u0026#34;3\u0026#34;}} {\u0026#34;title\u0026#34;:\u0026#34;Classic Beef Stroganoff: A Creamy Comfort Food\u0026#34;,\u0026#34;description\u0026#34;:\u0026#34;Indulge in this rich and creamy beef stroganoff. Tender strips of beef in a savory mushroom sauce, served over a bed of egg noodles. It\u0026#39;s the ultimate comfort food for chilly evenings.\u0026#34;,\u0026#34;author\u0026#34;:\u0026#34;Emma Watson\u0026#34;,\u0026#34;date\u0026#34;:\u0026#34;2023-05-10\u0026#34;,\u0026#34;category\u0026#34;:\u0026#34;Main Course\u0026#34;,\u0026#34;tags\u0026#34;:[\u0026#34;beef\u0026#34;,\u0026#34;pasta\u0026#34;,\u0026#34;comfort food\u0026#34;],\u0026#34;rating\u0026#34;:4.7} {\u0026#34;index\u0026#34;:{\u0026#34;_id\u0026#34;:\u0026#34;4\u0026#34;}} {\u0026#34;title\u0026#34;:\u0026#34;Vegan Chocolate Avocado Mousse\u0026#34;,\u0026#34;description\u0026#34;:\u0026#34;Discover the magic of avocado in this rich, vegan chocolate mousse. Creamy, indulgent, and secretly healthy, it\u0026#39;s the perfect guilt-free dessert for chocolate lovers.\u0026#34;,\u0026#34;author\u0026#34;:\u0026#34;Alex Green\u0026#34;,\u0026#34;date\u0026#34;:\u0026#34;2023-05-15\u0026#34;,\u0026#34;category\u0026#34;:\u0026#34;Dessert\u0026#34;,\u0026#34;tags\u0026#34;:[\u0026#34;vegan\u0026#34;,\u0026#34;chocolate\u0026#34;,\u0026#34;avocado\u0026#34;,\u0026#34;healthy dessert\u0026#34;],\u0026#34;rating\u0026#34;:4.5} {\u0026#34;index\u0026#34;:{\u0026#34;_id\u0026#34;:\u0026#34;5\u0026#34;}} {\u0026#34;title\u0026#34;:\u0026#34;Crispy Oven-Fried Chicken\u0026#34;,\u0026#34;description\u0026#34;:\u0026#34;Get that perfect crunch without the deep fryer! This oven-fried chicken recipe delivers crispy, juicy results every time. A healthier take on the classic comfort food.\u0026#34;,\u0026#34;author\u0026#34;:\u0026#34;Maria Rodriguez\u0026#34;,\u0026#34;date\u0026#34;:\u0026#34;2023-05-20\u0026#34;,\u0026#34;category\u0026#34;:\u0026#34;Main Course\u0026#34;,\u0026#34;tags\u0026#34;:[\u0026#34;chicken\u0026#34;,\u0026#34;oven-fried\u0026#34;,\u0026#34;healthy\u0026#34;],\u0026#34;rating\u0026#34;:4.9} match å•å­—æ®µæŸ¥è¯¢ match queryæ˜¯å…¨æ–‡æœç´¢çš„æ ‡å‡†æŸ¥è¯¢ã€‚æŸ¥è¯¢æ–‡æœ¬å°†æ ¹æ®æ¯ä¸ªå­—æ®µï¼ˆæˆ–æŸ¥è¯¢æ—¶ï¼‰æŒ‡å®šçš„åˆ†æå™¨é…ç½®è¿›è¡Œåˆ†æã€‚\n1 2 3 4 5 6 7 8 9 10 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;match\u0026#34;: { \u0026#34;description\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;fluffy pancakes\u0026#34; } } } } åŒ…å«æŸ¥è¯¢ä¸­æ‰€æœ‰åŒ¹é…çš„æœ¯è¯­ æŒ‡å®šandç®—ç¬¦ï¼Œä½¿æè¿°å­—æ®µåŒ…å«è¿™ä¸¤ä¸ªæœ¯è¯­ã€‚è¿™ç§æ›´ä¸¥æ ¼çš„æœç´¢å¯¹æ ·æœ¬æ•°æ®æ²¡æœ‰ç»“æœ ï¼Œå› ä¸ºæ²¡æœ‰æ–‡æ¡£åŒæ—¶åŒ…å«â€œfluffyâ€å’Œâ€œpancakesâ€\n1 2 3 4 5 6 7 8 9 10 11 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;match\u0026#34;: { \u0026#34;description\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;fluffy pancakes\u0026#34;, \u0026#34;operator\u0026#34;: \u0026#34;and\u0026#34; } } } } æŒ‡å®šåŒ¹é…çš„æœ€ä½è¯æ•° ä½¿ç”¨minimum_should_matchå‚æ•°æŒ‡å®šæ–‡æ¡£æœç´¢ç»“æœä¸­åº”åŒ…å«çš„æœ€å°‘è¯æ•°\n1 2 3 4 5 6 7 8 9 10 11 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;match\u0026#34;: { \u0026#34;title\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;fluffy pancakes breakfast\u0026#34;, \u0026#34;minimum_should_match\u0026#34;: 2 } } } } multi_match è·¨å¤šä¸ªå­—æ®µæœç´¢ å½“ä½ è¾“å…¥æœç´¢æŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä¸çŸ¥é“æœç´¢è¯æ˜¯å¦å‡ºç°åœ¨æŸä¸ªç‰¹å®šå­—æ®µä¸­ã€‚multi_matchæŸ¥è¯¢å¯ä»¥è®©ä½ åŒæ—¶æœç´¢å¤šä¸ªå­—æ®µã€‚\n1 2 3 4 5 6 7 8 9 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;multi_match\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;vegetarian curry\u0026#34;, \u0026#34;fields\u0026#34;: [\u0026#34;title\u0026#34;, \u0026#34;description\u0026#34;, \u0026#34;tags\u0026#34;] } } } ä½¿ç”¨å­—æ®µå¢å¼ºæ¥è°ƒæ•´æ¯ä¸ªå­—æ®µçš„é‡è¦æ€§ 1 2 3 4 5 6 7 8 9 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;multi_match\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;vegetarian curry\u0026#34;, \u0026#34;fields\u0026#34;: [\u0026#34;title^3\u0026#34;, \u0026#34;description^2\u0026#34;, \u0026#34;tags\u0026#34;] } } } filter ç­›é€‰æŸ¥è¯¢ filteræŸ¥è¯¢æ˜¯boolæŸ¥è¯¢çš„å­æŸ¥è¯¢\n1 2 3 4 5 6 7 8 9 10 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;bool\u0026#34;: { \u0026#34;filter\u0026#34;: [ { \u0026#34;term\u0026#34;: { \u0026#34;category.keyword\u0026#34;: \u0026#34;Breakfast\u0026#34; } } ] } } } range èŒƒå›´æŸ¥è¯¢ 1 2 3 4 5 6 7 8 9 10 11 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;range\u0026#34;: { \u0026#34;date\u0026#34;: { \u0026#34;gte\u0026#34;: \u0026#34;2023-05-01\u0026#34;, \u0026#34;lte\u0026#34;: \u0026#34;2023-05-31\u0026#34; } } } } term æŸ¥è¯¢æ‰¾åˆ°å®Œå…¨åŒ¹é…çš„ 1 2 3 4 5 6 7 8 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;term\u0026#34;: { \u0026#34;author.keyword\u0026#34;: \u0026#34;Maria Rodriguez\u0026#34; } } } ç»“åˆå¤šä¸ªæœç´¢æ¡ä»¶ ä½ å¯ä»¥ç”¨boolæŸ¥è¯¢ç»„åˆå¤šä¸ªæŸ¥è¯¢å­å¥ï¼Œåˆ›å»ºå¤æ‚çš„æœç´¢ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 GET /cooking_blog/_search { \u0026#34;query\u0026#34;: { \u0026#34;bool\u0026#34;: { \u0026#34;must\u0026#34;: [ { \u0026#34;term\u0026#34;: { \u0026#34;tags\u0026#34;: \u0026#34;vegetarian\u0026#34; } }, { \u0026#34;range\u0026#34;: { \u0026#34;rating\u0026#34;: { \u0026#34;gte\u0026#34;: 4.5 } } } ], \u0026#34;should\u0026#34;: [ { \u0026#34;term\u0026#34;: { \u0026#34;category.keyword\u0026#34;: \u0026#34;Main Course\u0026#34; } }, { \u0026#34;multi_match\u0026#34;: { \u0026#34;query\u0026#34;: \u0026#34;curry spicy\u0026#34;, \u0026#34;fields\u0026#34;: [ \u0026#34;title^2\u0026#34;, \u0026#34;description\u0026#34; ] } }, { \u0026#34;range\u0026#34;: { \u0026#34;date\u0026#34;: { \u0026#34;gte\u0026#34;: \u0026#34;now-1M/d\u0026#34; } } } ], \u0026#34;must_not\u0026#34;: [ { \u0026#34;term\u0026#34;: { \u0026#34;category.keyword\u0026#34;: \u0026#34;Dessert\u0026#34; } } ] } } } Compound queries å¤åˆæŸ¥è¯¢ boolean query ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸ƒå°”å­å¥æ„å»ºï¼Œæ¯ä¸ªå­å¥éƒ½å¸¦æœ‰ç±»å‹å‡ºç°ã€‚å‘ç”Ÿç±»å‹åŒ…æ‹¬\nmust must_not should filter å…¶ä¸­mustå’Œshouldå¯¹å¾—åˆ†æœ‰å½±å“ï¼Œä¸ä¼šè¢«ç¼“å­˜ã€‚must_notå’Œfilterå¯¹å¾—åˆ†æ²¡å½±å“ï¼Œä¼šè¢«ç¼“å­˜ã€‚\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 POST _search { \u0026#34;query\u0026#34;: { \u0026#34;bool\u0026#34; : { \u0026#34;must\u0026#34; : { \u0026#34;term\u0026#34; : { \u0026#34;user.id\u0026#34; : \u0026#34;kimchy\u0026#34; } }, \u0026#34;filter\u0026#34;: { \u0026#34;term\u0026#34; : { \u0026#34;tags\u0026#34; : \u0026#34;production\u0026#34; } }, \u0026#34;must_not\u0026#34; : { \u0026#34;range\u0026#34; : { \u0026#34;age\u0026#34; : { \u0026#34;gte\u0026#34; : 10, \u0026#34;lte\u0026#34; : 20 } } }, \u0026#34;should\u0026#34; : [ { \u0026#34;term\u0026#34; : { \u0026#34;tags\u0026#34; : \u0026#34;env1\u0026#34; } }, { \u0026#34;term\u0026#34; : { \u0026#34;tags\u0026#34; : \u0026#34;deployed\u0026#34; } } ], \u0026#34;minimum_should_match\u0026#34; : 1, \u0026#34;boost\u0026#34; : 1.0 } } } Boosting query æå‡positiveæˆ–è€…é™ä½negativeç›¸å…³æ€§å¾—åˆ†ï¼Œå¯ä»¥ä½¿ç”¨æå‡æŸ¥è¯¢æ¥é™çº§æŸäº›æ–‡æ¡£ï¼ŒåŒæ—¶ä¸æ’é™¤å®ƒä»¬åœ¨æœç´¢ç»“æœä¸­ã€‚\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 GET /_search { \u0026#34;query\u0026#34;: { \u0026#34;boosting\u0026#34;: { \u0026#34;positive\u0026#34;: { \u0026#34;term\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;apple\u0026#34; } }, \u0026#34;negative\u0026#34;: { \u0026#34;term\u0026#34;: { \u0026#34;text\u0026#34;: \u0026#34;pie tart fruit crumble tree\u0026#34; } }, \u0026#34;negative_boost\u0026#34;: 0.5 } } } Constant score query å¯¹filter queryè¿›è¡Œå°è£…ï¼Œè¿”å›æ‰€æœ‰ç›¸å…³æ€§è¯„åˆ†ç­‰äºboostå‚æ•°å€¼çš„åŒ¹é…æ–‡æ¡£\nç¤ºä¾‹æŸ¥è¯¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 GET /_search { \u0026#34;query\u0026#34;: { \u0026#34;constant_score\u0026#34;: { \u0026#34;filter\u0026#34;: { \u0026#34;term\u0026#34;: { \u0026#34;user.id\u0026#34;: \u0026#34;kimchy\u0026#34; } }, \u0026#34;boost\u0026#34;: 1.2 } } } Disjunction max query è¿”å›åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªåŒ…è£¹æŸ¥è¯¢çš„æ–‡æ¡£ï¼Œç§°ä¸ºæŸ¥è¯¢å­å¥æˆ–å­å¥ã€‚\nå¦‚æœè¿”å›çš„æ–‡æ¡£åŒ¹é…å¤šä¸ªæŸ¥è¯¢å­å¥ï¼Œdis_max queryå°†èµ‹äºˆè¯¥æ–‡æ¡£ä»»ä½•åŒ¹é…å­å¥ä¸­æœ€é«˜çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œå¹¶å¯¹ä»»ä½•é¢å¤–çš„åŒ¹é…å­æŸ¥è¯¢åŠ æˆå¹³å±€ç ´ååˆ†æ•°ã€‚\nç¤ºä¾‹æŸ¥è¯¢ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 GET /_search { \u0026#34;query\u0026#34;: { \u0026#34;dis_max\u0026#34;: { \u0026#34;queries\u0026#34;: [ { \u0026#34;term\u0026#34;: { \u0026#34;title\u0026#34;: \u0026#34;Quick pets\u0026#34; } }, { \u0026#34;term\u0026#34;: { \u0026#34;body\u0026#34;: \u0026#34;Quick pets\u0026#34; } } ], \u0026#34;tie_breaker\u0026#34;: 0.7 } } } æŸ¥è¯¢å‚æ•°ï¼š\nqueries tie_breaker Function score query function_score å…è®¸ä½ ä¿®æ”¹æŸ¥è¯¢æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ†æ•°\nä½¿ç”¨function_scoreæ—¶ï¼Œç”¨æˆ·å¿…é¡»å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢å’Œä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¸ºæŸ¥è¯¢è¿”å›çš„æ¯ä¸ªæ–‡æ¡£è®¡ç®—æ–°çš„åˆ†æ•°\næŸ¥è¯¢ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 GET /_search { \u0026#34;query\u0026#34;: { \u0026#34;function_score\u0026#34;: { \u0026#34;query\u0026#34;: { \u0026#34;match_all\u0026#34;: {} }, \u0026#34;boost\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;functions\u0026#34;: [ { \u0026#34;filter\u0026#34;: { \u0026#34;match\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;bar\u0026#34; } }, \u0026#34;random_score\u0026#34;: {}, \u0026#34;weight\u0026#34;: 23 }, { \u0026#34;filter\u0026#34;: { \u0026#34;match\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;cat\u0026#34; } }, \u0026#34;weight\u0026#34;: 42 } ], \u0026#34;max_boost\u0026#34;: 42, \u0026#34;score_mode\u0026#34;: \u0026#34;max\u0026#34;, \u0026#34;boost_mode\u0026#34;: \u0026#34;multiply\u0026#34;, \u0026#34;min_score\u0026#34;: 42 } } } ","date":"2025-12-21T23:56:02+08:00","permalink":"https://www.cengdong.store/p/elasticsearchelasticsearch%E7%9F%A5%E8%AF%86%E7%82%B9/","title":"ã€Elasticsearchã€‘ElasticsearchçŸ¥è¯†ç‚¹"},{"content":"ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡åšå®¢ å¯¹ç§»åŠ¨åº”ç”¨æµ‹è¯•æ„Ÿå…´è¶£ï¼Œæƒ³è¦æå‡ç§»åŠ¨ç«¯ä»£ç èµ°è¯»èƒ½åŠ› å»ºè®¾Appium/Espressoè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½åŠ› ç§»åŠ¨åº”ç”¨æ€§èƒ½æµ‹è¯•ä¸è°ƒä¼˜çš„èƒ½åŠ› æ€ä¹ˆåš äº†è§£jetpack compose å®ŒæˆGoogleå®˜æ–¹çš„Androidè¯¾ç¨‹ æ‰¾åˆ°ä¸€ä¸ªå¼€æºå®‰å“é¡¹ç›®ï¼Œæ­å»ºè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶å¹¶ç¼–å†™ç”¨ä¾‹ï¼Œè¦†ç›–ä¸»è¦åŠŸèƒ½ ","date":"2025-08-31T23:42:32+08:00","permalink":"https://www.cengdong.store/p/androidandroid%E7%BC%96%E7%A8%8B/","title":"ã€Androidã€‘Androidç¼–ç¨‹"},{"content":"ä»€ä¹ˆæ˜¯ k6 ä½¿ç”¨ k6ï¼Œä½ å¯ä»¥æµ‹è¯•åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½çš„å¯é æ€§å’Œæ€§èƒ½ã€‚\nå·¥ç¨‹å›¢é˜Ÿï¼ˆåŒ…æ‹¬å¼€å‘äººå‘˜ã€QA å·¥ç¨‹å¸ˆã€SDET å’Œ SREï¼‰é€šå¸¸ä½¿ç”¨ k6 æ¥ï¼š\nè´Ÿè½½å’Œæ€§èƒ½æµ‹è¯• æµè§ˆå™¨æ€§èƒ½æµ‹è¯• æ€§èƒ½å’Œç»¼åˆç›‘æ§ æ€§èƒ½æµ‹è¯•è‡ªåŠ¨åŒ– æ··æ²Œä¸å¼¹æ€§æµ‹è¯• å®‰è£… K6 K6 æœ‰èƒ½åœ¨å¤šç§å¹³å°å®‰è£…ï¼š\nwindows mac linux é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ Docker å®¹å™¨æ–¹å¼è¿è¡Œ k6\nç›®å‰æˆ‘ç”¨çš„å¼€å‘ä¸»åŠ›æœºæ˜¯ macï¼Œåœ¨ mac ä¸Šå®‰è£… k6 çš„é€”å¾„ä¸»è¦æ˜¯é€šè¿‡homebrew\n1 brew install k6 æ­¤å¤–å°±æ˜¯é€šè¿‡ Docker å®‰è£… k6\n1 docker pull grafana/k6 ç¼–å†™ç¬¬ä¸€ä¸ª k6 æµ‹è¯•è„šæœ¬ å‰ææ¡ä»¶ è¦ç¼–å†™ k6 æµ‹è¯•è„šæœ¬ï¼Œéœ€è¦ä»¥ä¸‹å‰æï¼š\njavascript æˆ–è€… typescript çŸ¥è¯† åœ¨ç”µè„‘ä¸Šå®‰è£… k6 ç”¨äºç¼–å†™æµ‹è¯•è„šæœ¬çš„ä»£ç ç¼–è¾‘å™¨(æˆ‘ç›®å‰ä½¿ç”¨çš„æ˜¯ vscode) k6 æµ‹è¯•è„šæœ¬çš„ç»“æ„ æ¯ä¸ª k6 è„šæœ¬éƒ½éµå¾ªä¸€ä¸ªé€šç”¨ç»“æ„ï¼Œå›´ç»•å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š\né»˜è®¤å‡½æ•°ï¼šè¿™æ˜¯æµ‹è¯•é€»è¾‘æ‰€åœ¨çš„ä½ç½®ã€‚å®ƒå®šä¹‰äº†æµ‹è¯•å°†æ‰§è¡Œçš„æ“ä½œä»¥åŠåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¡Œä¸ºæ–¹å¼ã€‚å®ƒåº”ä½œä¸ºè„šæœ¬ä¸­çš„é»˜è®¤å‡½æ•°å¯¼å‡ºã€‚ imports ï¼šæ‚¨å¯ä»¥è¿›å£é¢å¤–çš„ k6 æ¨¡å—æˆ– JavaScript åº“ (jslibs) ç”¨äºæ‰©å±•è„šæœ¬åŠŸèƒ½ï¼Œä¾‹å¦‚å‘å‡º HTTP è¯·æ±‚æˆ–æ¨¡æ‹Ÿæµè§ˆå™¨äº¤äº’ã€‚è¯·æ³¨æ„ï¼Œk6 å¹¶éåŸºäº Node.js æ„å»ºï¼Œè€Œæ˜¯ä½¿ç”¨å…¶è‡ªèº«çš„ JavaScript è¿è¡Œæ—¶ã€‚ä¸æŸäº› npm æ¨¡å—çš„å…¼å®¹æ€§å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ optionsï¼ˆå¯é€‰ï¼‰ ï¼šå…è®¸æ‚¨é…ç½®æµ‹è¯•çš„æ‰§è¡Œï¼Œä¾‹å¦‚å®šä¹‰è™šæ‹Ÿç”¨æˆ·æ•°é‡ã€æµ‹è¯•æ—¶é•¿æˆ–è®¾ç½®æ€§èƒ½é˜ˆå€¼ã€‚è¯·å‚é˜… é€‰é¡¹ä»¥äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ ç”Ÿå‘½å‘¨æœŸæ“ä½œï¼ˆå¯é€‰ï¼‰ ï¼šç”±äºæ‚¨çš„æµ‹è¯•å¯èƒ½éœ€è¦åœ¨æ‰§è¡Œæµ‹è¯•é€»è¾‘ä¹‹å‰å’Œ/æˆ–ä¹‹åè¿è¡Œä»£ç ï¼Œä¾‹å¦‚ä»æ–‡ä»¶è§£ææ•°æ®æˆ–ä» Amazon S3 ä¸‹è½½å¯¹è±¡ï¼Œ ç”Ÿå‘½å‘¨æœŸæ“ä½œå…è®¸æ‚¨ç¼–å†™ä»£ç ï¼Œä½œä¸ºé¢„å®šä¹‰å‡½æ•°æˆ–åœ¨ç‰¹å®šä»£ç èŒƒå›´å†…ï¼Œè¿™äº›ä»£ç å°†åœ¨æµ‹è¯•æ‰§è¡Œçš„ä¸åŒé˜¶æ®µæ‰§è¡Œã€‚ ç¼–å†™ k6 æµ‹è¯•è„šæœ¬ åˆ›å»ºæµ‹è¯•è„šæœ¬(æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª js æ–‡ä»¶æˆ–è€…ä½¿ç”¨k6 new test.js) å¯¼å…¥æ¨¡å—(import http from 'k6/http') å®šä¹‰å‡½æ•°(export default function() {}) å£°æ˜æµ‹è¯•é€‰é¡¹(export const options = {}) æ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // å¯¼å…¥æ¨¡å— import http from \u0026#39;k6/http\u0026#39; import { sleep } from \u0026#39;k6\u0026#39; // å®šä¹‰å¯é€‰é¡¹ export const options = { iterations: 10, } // The default exported function is gonna be picked up by k6 as the entry point for the test script. It will be executed repeatedly in \u0026#34;iterations\u0026#34; for the whole duration of the test. // é»˜è®¤å‡½æ•°ï¼Œæµ‹è¯•è„šæœ¬é€»è¾‘å°±åœ¨è¿™é‡Œé¢ï¼Œå¿…é€‰é¡¹ export default function () { // Make a GET request to the target URL http.get(\u0026#39;https://quickpizza.grafana.com\u0026#39;) // Sleep for 1 second to simulate real-world usage sleep(1) } // æµ‹è¯•ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¯é€‰çš„ æ›´å¤šçš„ http è¯·æ±‚æ–¹å¼ k6 æ”¯æŒæ‰€æœ‰çš„ http è¯·æ±‚æ–¹æ³•\nget(GET) post(POST) put(PUT) del(DELETE) patch(PATCH) head(HEAD) options(OPTIONS) requests(ç±»ä¼¼äº python çš„ request åº“) batch(æ‰¹é‡è¯·æ±‚) get æ–¹æ³• 1 2 3 4 5 import http from \u0026#39;k6/http\u0026#39; export default function () { http.get(\u0026#39;http://test.k6.io\u0026#39;) } post æ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import http from \u0026#39;k6/http\u0026#39; export default function () { const url = \u0026#39;http://test.k6.io/login\u0026#39; const payload = JSON.stringify({ email: \u0026#39;aaa\u0026#39;, password: \u0026#39;bbb\u0026#39;, }) const params = { headers: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, }, } http.post(url, payload, params) } http è¯·æ±‚æ ‡ç­¾ æ ‡ç­¾ç¤ºä¾‹ k6 ä¼šè‡ªåŠ¨åº”ç”¨å†…ç½®æ ‡ç­¾åˆ° http è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥è¿‡æ»¤ç»“æœå¹¶ç»„ç»‡åˆ†æ\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ http ç›¸å…³çš„æ ‡ç­¾\næ ‡ç­¾å æè¿° expected_response æ˜¯å¦æ˜¯æœŸæœ›çš„å“åº”ï¼Œé»˜è®¤æƒ…å†µä¸‹ 200-399 ä¹‹é—´çš„éƒ½æ˜¯ trueï¼Œä¹Ÿå¯ä»¥é€šè¿‡setResponseCallbackæ›´æ”¹é»˜è®¤è¡Œä¸º group å½“è¯·æ±‚åœ¨æŸä¸ª group ä¸­æ—¶æ˜¯ç»„åï¼Œé»˜è®¤å€¼æ˜¯ç©º name é»˜è®¤ä¸ºè¯·æ±‚çš„ url method http è¯·æ±‚æ–¹æ³• scenario å½“è¯·æ±‚åœ¨æŸä¸ª scenario ä¸­æ—¶ï¼Œæ ‡ç­¾å€¼æ˜¯ scenario åï¼Œé»˜è®¤ä¸º default status å“åº”çŠ¶æ€ç  url é»˜è®¤ä¸º url è¯·æ±‚åœ°å€ ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•è®°å½•æµ‹è¯•ç»“æœæ•°æ®ç‚¹çš„ JSON ç¤ºä¾‹ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒæŒ‡æ ‡æ˜¯ HTTP è¯·æ±‚çš„æŒç»­æ—¶é—´\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 { \u0026#34;type\u0026#34;: \u0026#34;Point\u0026#34;, \u0026#34;metric\u0026#34;: \u0026#34;http_req_duration\u0026#34;, \u0026#34;data\u0026#34;: { \u0026#34;time\u0026#34;: \u0026#34;2017-06-02T23:10:29.52444541+02:00\u0026#34;, \u0026#34;value\u0026#34;: 586.831127, \u0026#34;tags\u0026#34;: { \u0026#34;expected_response\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;group\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;method\u0026#34;: \u0026#34;GET\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;http://test.k6.io\u0026#34;, \u0026#34;scenario\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;200\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;http://test.k6.io\u0026#34; } } } ä½¿ç”¨æ ‡ç­¾å°† URL åˆ†ç»„ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ‡ç­¾ä¼šæœ‰ä¸€ä¸ªnameå­—æ®µï¼Œç”¨äºä¿å­˜è¯·æ±‚çš„ URL çš„å€¼ï¼Œå¦‚æœæµ‹è¯•åŒ…å«åŠ¨æ€ URL è·¯å¾„ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ•°æ®èšåˆåˆ†æï¼Œè€Œä¸æ˜¯å¤§é‡çš„å”¯ä¸€ URL è¿›å…¥æŒ‡æ ‡æµã€‚\n1 2 3 4 5 6 7 8 9 import http from \u0026#39;k6/http\u0026#39; export default function () { for (let id = 1; id \u0026lt;= 100; id++) { http.get(`http://example.com/posts/${id}`) } } // tags.name=\\\u0026#34;http://example.com/posts/1\\\u0026#34;, // tags.name=\\\u0026#34;http://example.com/posts/2\\\u0026#34;, æˆ‘ä»¬æ›´å¸Œæœ›åœ¨å•ä¸ªæŒ‡æ ‡ä¸­æŠ¥å‘Šè¿™ä¸ªæ•°æ®ï¼Œè¦ä»åŠ¨æ€çš„ URL èšåˆæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® http è¯·æ±‚çš„nameæ ‡ç­¾\n1 2 3 4 5 6 7 8 9 10 11 import http from \u0026#39;k6/http\u0026#39; export default function () { for (let id = 1; id \u0026lt;= 100; id++) { http.get(`http://example.com/posts/${id}`, { tags: { name: \u0026#39;PostsItemURL\u0026#39; }, }) } } // tags.name=\\\u0026#34;PostsItemURL\\\u0026#34;, // tags.name=\\\u0026#34;PostsItemURL\\\u0026#34;, ä¸Šé¢çš„ä»£ç ä¼šäº§ç”Ÿå¦‚ä¸‹çš„ JSON è¾“å‡º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // For http://example.com/1, note that the url is not present in the JSON. { \u0026#34;type\u0026#34;:\u0026#34;Point\u0026#34;, \u0026#34;metric\u0026#34;:\u0026#34;http_req_duration\u0026#34;, \u0026#34;data\u0026#34;: { \u0026#34;time\u0026#34;:\u0026#34;2017-06-02T23:10:29.52444541+02:00\u0026#34;, \u0026#34;value\u0026#34;:586.831127, \u0026#34;tags\u0026#34;: { \u0026#34;method\u0026#34;:\u0026#34;GET\u0026#34;, \u0026#34;name\u0026#34;:\u0026#34;PostsItemURL\u0026#34;, \u0026#34;status\u0026#34;:\u0026#34;200\u0026#34;, \u0026#34;url\u0026#34;:\u0026#34;PostsItemURL\u0026#34; } } } // and for http://example.com/2 { \u0026#34;type\u0026#34;:\u0026#34;Point\u0026#34;, \u0026#34;metric\u0026#34;:\u0026#34;http_req_duration\u0026#34;, \u0026#34;data\u0026#34;: { \u0026#34;time\u0026#34;:\u0026#34;2017-06-02T23:10:29.58582529+02:00\u0026#34;, \u0026#34;value\u0026#34;:580.839273, \u0026#34;tags\u0026#34;: { \u0026#34;method\u0026#34;:\u0026#34;GET\u0026#34;, \u0026#34;name\u0026#34;:\u0026#34;PostsItemURL\u0026#34;, \u0026#34;status\u0026#34;:\u0026#34;200\u0026#34;, \u0026#34;url\u0026#34;:\u0026#34;PostsItemURL\u0026#34; } } } å°½ç®¡ä¸¤ä¸ªå¯¹è±¡çš„urlä¸åŒï¼Œä½†æ˜¯å®ƒä»¬çš„nameå´æ˜¯ç›¸åŒçš„\næˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨http.urlåŒ…è£…å™¨æ¥è®¾ç½®å…·æœ‰æ¨¡ç‰ˆå­—ç¬¦ä¸²å€¼çš„nameæ ‡ç­¾\n1 2 3 4 5 6 7 8 9 import http from \u0026#39;k6/http\u0026#39; export default function () { for (let id = 1; id \u0026lt;= 100; id++) { http.get(http.url`http://example.com/posts/${id}`) } } // tags.name=\u0026#34;http://example.com/posts/${}\u0026#34;, // tags.name=\u0026#34;http://example.com/posts/${}\u0026#34;, æŒ‡æ ‡ æŒ‡æ ‡è¡¡é‡ç³»ç»Ÿåœ¨æµ‹è¯•æ¡ä»¶ä¸‹çš„æ€§èƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œk6 ä¼šè‡ªåŠ¨æ”¶é›†å†…ç½®æŒ‡æ ‡ã€‚é™¤äº†å†…ç½®æŒ‡æ ‡å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰æŒ‡æ ‡ã€‚\næŒ‡æ ‡åˆ†ç±» æŒ‡æ ‡å¤§è‡´åˆ†ä¸ºå››ç±»ï¼š\nCounters è®¡ç®—æ€»å’Œå€¼ã€‚ Gauges è·Ÿè¸ªæœ€å°å€¼ã€æœ€å¤§å€¼å’Œæœ€æ–°å€¼ã€‚ Rates è·Ÿè¸ªéé›¶å€¼å‡ºç°çš„é¢‘ç‡ã€‚ Trends è®¡ç®—å¤šä¸ªå€¼ï¼ˆå¦‚å¹³å‡å€¼ã€ä¼—æ•°æˆ–ç™¾åˆ†ä½æ•°ï¼‰çš„ç»Ÿè®¡æ•°æ®ã€‚ ä¸ºäº†ä½¿æµ‹è¯•ä¸æ»¡è¶³æŸäº›æ ‡å‡†ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªåŸºäºæŒ‡æ ‡æ ‡å‡†çš„é˜ˆå€¼ã€‚\nè¦è¿‡æ»¤æŒ‡æ ‡ï¼Œä½ å¯ä»¥ä½¿ç”¨tagå’Œgroup\nè¿˜å¯ä»¥å¯¼å‡ºå„ç§æ‘˜è¦å’Œç²’åº¦æ ¼å¼çš„æŒ‡æ ‡ï¼Œå¦‚Result output\nè¦è§‚æµ‹çš„æŒ‡æ ‡ æ¯ä¸ªæŒ‡æ ‡éƒ½æä¾›äº†ä¸åŒçš„ç»©æ•ˆè§†è§’ï¼Œå› æ­¤ï¼Œæœ€åˆé€‚åˆ†æçš„æŒ‡æ ‡å–å†³äºè‡ªèº«çš„ç›®æ ‡\nå¦‚æœä½ ä¸ç¡®å®šè¦å…³æ³¨å“ªäº›æŒ‡æ ‡ï¼Œåˆ™å¯ä»¥ä»è¡¡é‡è¯·æ±‚ã€é”™è¯¯å’ŒæŒç»­æ—¶é—´çš„æŒ‡æ ‡å¼€å§‹(RED æ–¹æ³•)\nhttp_reqs ï¼Œç”¨äºæµ‹é‡è¯·æ±‚ http_req_failed ï¼Œæµ‹é‡é”™è¯¯ç‡ http_req_duration ï¼Œç”¨äºæµ‹é‡æŒç»­æ—¶é—´ æ¢å¥è¯è¯´ï¼Œè¿™äº›æŒ‡æ ‡è¡¡é‡æµé‡ã€å¯ç”¨æ€§å’Œå»¶è¿Ÿï¼ŒSRE å¯èƒ½ä¼šå°†è¿™äº›æŒ‡æ ‡è§†ä¸ºfour Golden Signals\nç¤ºä¾‹è¾“å‡º å½“ä½ è¿è¡Œæµ‹è¯•æ—¶ï¼Œæ‰€æœ‰å†…ç½®çš„å’Œè‡ªå®šä¹‰æŒ‡æ ‡çš„æ±‡æ€»æ‘˜è¦å°†è¾“å‡ºåˆ°stdout:\n1 2 3 4 5 import http from \u0026#39;k6/http\u0026#39; export default function () { http.get(\u0026#39;https://quickpizza.grafana.com\u0026#39;) } ä¸Šè¿°è„šæœ¬å°†è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 $ k6 run script.js /\\ Grafana /â€¾â€¾/ /\\ / \\ |\\ __ / / / \\/ \\ | |/ / / â€¾â€¾\\ / \\ | ( | (â€¾) | / __________ \\ |_|\\_\\ \\_____/ execution: local script: http_get.js output: - scenarios: (100.00%) 1 scenario, 1 max VUs, 10m30s max duration (incl. graceful stop): * default: 1 iterations for each of 1 VUs (maxDuration: 10m0s, gracefulStop: 30s) â–ˆ TOTAL RESULTS HTTP http_req_duration.......................................................: avg=117.55ms min=117.55ms med=117.55ms max=117.55ms p(90)=117.55ms p(95)=117.55ms { expected_response:true }............................................: avg=117.55ms min=117.55ms med=117.55ms max=117.55ms p(90)=117.55ms p(95)=117.55ms http_req_failed.........................................................: 0.00% 0 out of 1 http_reqs...............................................................: 1 2.768749/s EXECUTION iteration_duration......................................................: avg=361.09ms min=361.09ms med=361.09ms max=361.09ms p(90)=361.09ms p(95)=361.09ms iterations..............................................................: 1 2.768749/s NETWORK data_received...........................................................: 6.8 kB 19 kB/s data_sent...............................................................: 541 B 1.5 kB/s running (00m03.8s), 0/1 VUs, 1 complete and 0 interrupted iterations default âœ“ [======================================] 1 VUs 00m03.8s/10m0s 1/1 iters, 1 per VU åœ¨è¯¥è¾“å‡ºä¸­ï¼Œæ‰€æœ‰ä»¥httpã€interationã€vuå¼€å¤´çš„æŒ‡æ ‡éƒ½æ˜¯å†…ç½®æŒ‡æ ‡\næŒ‡æ ‡åç§°é™åˆ¶ æŒ‡æ ‡åç§°å¿…é¡»ç¬¦åˆ OpenTelemetry å’Œ Prometheus çš„é™åˆ¶ ã€‚å­—ç¬¦é™åˆ¶ä¸ k6 åœ¨é™åˆ¶å­—ç¬¦é›†ä¹‹å‰çš„é™åˆ¶ç›¸åŒ\næ„å‘³ç€ï¼š\nåŒ…å«æœ€å¤š 128 ä¸ªç¬¦å·ï¼ˆASCII å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿ï¼‰ã€‚ ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ã€‚ å†…ç½®æŒ‡æ ‡ æ— è®ºæµ‹è¯•ä»€ä¹ˆåè®®(http/websocket/grpc)ï¼Œk6 å§‹ç»ˆæ”¶é›†ä»¥ä¸‹æŒ‡æ ‡\næŒ‡æ ‡å ç±»å‹ æè¿° checks Rate æ£€æŸ¥æˆåŠŸç‡ data_received Counter å·²æ¥æ”¶åˆ°çš„æ•°æ® data_send Counter å·²å‘é€çš„æ•°æ® dropped_iterations Counter ç”±äº vu ä¸è¶³æˆ–æ—¶é—´ä¸è¶³è€Œæœªå¯åŠ¨çš„è¿­ä»£æ¬¡æ•° iteration_duration Trend å®Œæˆä¸€æ¬¡å®Œæ•´çš„è¿­ä»£æ‰€éœ€çš„æ—¶é—´ï¼ŒåŒ…æ‹¬setupå’Œteardown iterations Counter vu æ‰§è¡Œ js è„šæœ¬(default å‡½æ•°)çš„æ€»æ¬¡æ•° vus Gauge å½“å‰æ´»è·ƒè™šæ‹Ÿç”¨æˆ·æ•° vus_max Gauge æœ€å¤§å¯èƒ½çš„è™šæ‹Ÿç”¨æˆ·æ•° http å†…ç½®æŒ‡æ ‡ æŒ‡æ ‡åç§° ç±»å‹ æè¿° http_req_blocked Trend å‘èµ·è¯·æ±‚ä¹‹å‰é˜»å¡çš„æ—¶é—´float http_req_connecting Trend ä¸è¿œç¨‹ä¸»æœºå»ºç«‹ TCP è¿æ¥æ‰€èŠ±è´¹çš„æ—¶é—´float http_req_duration Trend è¯·æ±‚çš„æ€»æ—¶é—´ã€‚å®ƒç­‰äº http_req_sending + http_req_waiting + http_req_receiving ï¼ˆå³è¿œç¨‹æœåŠ¡å™¨å¤„ç†è¯·æ±‚å’Œå“åº”æ‰€éœ€çš„æ—¶é—´ï¼Œä¸åŒ…æ‹¬åˆå§‹ DNS æŸ¥æ‰¾/è¿æ¥æ—¶é—´ï¼‰ float http_req_failed Rate æ ¹æ® setResponseCallback å›è°ƒå‡½æ•°å®šä¹‰ä¸ºå¤±è´¥çš„è¯·æ±‚ http_req_receiving Trend ä»è¿œç¨‹ä¸»æœºæ¥æ”¶å“åº”æ•°æ®æ‰€èŠ±è´¹çš„æ—¶é—´ float http_req_sending Trend å‘è¿œç¨‹ä¸»æœºå‘é€æ•°æ®æ‰€èŠ±è´¹çš„æ—¶é—´float http_req_tls_handshaking Trend ä¸è¿œç¨‹ä¸»æœºæ¡æ‰‹ TLS ä¼šè¯æ‰€ç”¨çš„æ—¶é—´ http_req_waiting Trend ç­‰å¾…è¿œç¨‹ä¸»æœºå“åº”çš„æ—¶é—´ï¼ˆåˆç§°â€œç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´â€æˆ–â€œTTFBâ€ï¼‰ float http_reqs Counter k6 æ€»å…±ç”Ÿæˆäº†å¤šå°‘ä¸ª HTTP è¯·æ±‚ æµè§ˆå™¨æŒ‡æ ‡ K6 æµè§ˆå™¨æŒ‡æ ‡åŸºäºCore Web Vitals\néšç€æŠ€æœ¯çš„å˜åŒ–ï¼Œè¿™äº›æ ¸å¿ƒæŒ‡æ ‡ä¹Ÿä¼šéšä¹‹å˜åŒ–ï¼Œç›®å‰ï¼ŒK6 è·Ÿè¸ªä»¥ä¸‹æ ¸å¿ƒç½‘ç»œç”Ÿå‘½åŠ›ï¼š\nMetric name Description browser_web_vital_cls é€šè¿‡é‡åŒ–å¯è§é¡µé¢å†…å®¹çš„æ„å¤–å¸ƒå±€åç§»é‡æ¥è¡¡é‡ç½‘é¡µçš„è§†è§‰ç¨³å®šæ€§ã€‚è¯·å‚é˜…Cumulative Layout Shiftä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ browser_web_vital_fid é€šè¿‡é‡åŒ–ç”¨æˆ·é¦–æ¬¡äº¤äº’ï¼ˆä¾‹å¦‚ç‚¹å‡»æŒ‰é’®ï¼‰ä¸æµè§ˆå™¨å“åº”ä¹‹é—´çš„å»¶è¿Ÿæ¥è¡¡é‡ç½‘é¡µçš„å“åº”èƒ½åŠ›ã€‚è¯·å‚é˜…First Input Delayäº†è§£æ›´å¤šä¿¡æ¯ã€‚ browser_web_vital_lcp æµ‹é‡é¡µé¢ä¸Šæœ€å¤§å†…å®¹å…ƒç´ å¯è§æ‰€éœ€çš„æ—¶é—´ã€‚è¯·å‚é˜… è¯·å‚é˜…Larger Contentful Paint ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚ é™¤äº†æ ¸å¿ƒ Web æŒ‡æ ‡å¤–ï¼Œæµè§ˆå™¨æ¨¡å—è¿˜æŠ¥å‘ŠOther Web Vitals\næŒ‡æ ‡åç§° æè¿° browser_web_vital_fcp æµ‹é‡æµè§ˆå™¨æ¸²æŸ“é¡µé¢ä¸Šç¬¬ä¸€ä¸ª DOM å…ƒç´ ï¼ˆæ— è®ºæ˜¯æ–‡æœ¬ã€å›¾ç‰‡è¿˜æ˜¯æ ‡é¢˜ï¼‰æ‰€éœ€çš„æ—¶é—´ã€‚è¯·å‚é˜…First Contentful Paint äº†è§£æ›´å¤šä¿¡æ¯ browser_web_vital_inp è¡¡é‡é¡µé¢å“åº”èƒ½åŠ›çš„å®éªŒæ€§æŒ‡æ ‡è¯·å‚é˜…Interaction to Next Paintä»¥è·å–æ›´å¤šä¿¡æ¯. browser_web_vital_ttfb æµ‹é‡æµè§ˆå™¨è¯·æ±‚å’ŒæœåŠ¡å™¨å“åº”ä¹‹é—´çš„æ—¶é—´ã€‚è¯·å‚é˜…Time to First Byteä»¥è·å–æ›´å¤šä¿¡æ¯ å†…ç½® Websocket æŒ‡æ ‡ ","date":"2025-05-18T20:55:24+08:00","permalink":"https://www.cengdong.store/p/k6%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95k6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"ã€K6æ€§èƒ½æµ‹è¯•ã€‘K6å­¦ä¹ ç¬”è®°"},{"content":"ä¸ºä»€ä¹ˆè¦å†™ Charles æœ€è¿‘åˆé‡è¿”æµ‹è¯•å²—ä½ï¼Œä½œä¸ºä¸€åæµ‹è¯•å·¥ä½œäººå‘˜ï¼ŒæŒæ¡å¥½ä»£ç†å·¥å…·ï¼Œåˆ†æ bug äº§ç”Ÿçš„åŸå› ï¼Œæ˜¯ä¸€é¡¹å¿…ä¸å¯å°‘çš„æŠ€èƒ½\néœ€è¦æŒæ¡çš„ä»£ç†å·¥å…·æœ‰å“ªäº› æˆ–è€…è¯´é‚£äº›ä»£ç†å·¥å…·å€¼å¾—æŒæ¡\nCharles Fildder äºŒé€‰ä¸€(å› ä¸ºä¹ æƒ¯ç”¨ macï¼Œ æ›´å€¾å‘äº Charles) Mitmproxy(è¿™ä¸ªæˆ‘è§‰å¾—æ˜¯æ›´å¥½çš„é€‰é¡¹ï¼Œcode first, çµæ´»æ€§æ›´å¼º) Charles å¸¸ç”¨åŠŸèƒ½ æµé‡è¿‡æ»¤ è¿‡æ»¤è‡ªå·±èƒ½çœ‹åˆ°çš„åŒ…æœ‰ä¸¤ç§é€‰é¡¹\nProxy -\u0026gt; recording settings -\u0026gt; include/exclude å·¦ä¸‹è§’å¡«å†™è¿‡æ»¤è¡¨è¾¾å¼(æˆ‘ä¸€èˆ¬éƒ½æŒ‰ç…§åŸŸåè¿‡æ»¤) å¹¶å‘æµ‹è¯• å…¶å®ä¸ç®—æ˜¯ä»€ä¹ˆå¹¶å‘ï¼Œå°±æ˜¯ repeat è¯·æ±‚ï¼Œadvanced repeat å¯ä»¥æŒ‡å®šå¹¶å‘æ•°\nåœ¨å°‘é‡çš„æ‰¹é‡æ¥å£è°ƒç”¨æ—¶å¯ä»¥æ–¹ä¾¿ä½¿ç”¨ï¼Œä¼šé»˜è®¤æ–°å»ºä¸€ä¸ª seesion\næ–­ç‚¹ breaking pointså¯ä»¥å¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œæˆªæ–­å¹¶ä¿®æ”¹ï¼Œæœ€è¿‘åœ¨æ”¯ä»˜æµ‹è¯•çš„æ—¶å€™ç”¨çš„å¤š\nå¯¹ç¬¦åˆbreaking pointsè§„åˆ™çš„æ¯ä¸€ä¸ªè¯·æ±‚/å“åº”éƒ½ä¼šè¿›è¡Œæˆªæ–­\nå¦‚æœæ˜¯éœ€è¦æ¯æ¬¡éƒ½ä¿®æ”¹å“åº”ï¼Œå¯ä»¥ä½¿ç”¨map localæ›´ä¸ºæ–¹ä¾¿\ncompose compose å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œä»£æ›¿ postman æ¥å£æµ‹è¯•ï¼Ÿ\né‡å®šå‘ map local(æœ¬åœ°é‡å®šå‘ï¼Œå¯ä»¥å…ˆsave responseåˆ°æœ¬åœ°ï¼Œå†æŠŠæ¥å£è¯·æ±‚é‡å®šå‘åˆ°ä¿å­˜çš„å“åº”å») map remote(é‡å®šå‘åˆ°è¿œç¨‹æœåŠ¡å™¨, å®¢æˆ·ç«¯è¿›è¡Œåç«¯æœåŠ¡å™¨æ›¿æ¢ï¼Œæ›¿æ¢ä¸ºmockæœåŠ¡å™¨) æ„Ÿè§‰è¿™ä¸¤ä¸ªåŠŸèƒ½å¦‚æœæƒ³è¦æ›´é«˜çš„çµæ´»æ€§ï¼Œå¯ä»¥ä½¿ç”¨mitmproxy\nèŠ‚æµå™¨ å¯ä»¥è¿›è¡Œç½‘å¼±æµ‹è¯•ï¼Œæ²¡æ€ä¹ˆç”¨è¿‡(devTools ä¹Ÿæœ‰ç›¸åº”åŠŸèƒ½)\nç«¯å£è½¬å‘ æ²¡ç”¨è¿‡ï¼Œä¸åšè¯„ä»·\n","date":"2025-04-27T21:31:43+08:00","permalink":"https://www.cengdong.store/p/charlescharles%E5%8A%9F%E8%83%BD%E5%A4%A7%E5%85%A8/","title":"ã€Charlesã€‘CharlesåŠŸèƒ½å¤§å…¨"},{"content":"ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ª è½¬å‹å¤±è´¥ï¼Œä¹‹å‰ä¸€ç›´æƒ³ä»æµ‹è¯•è½¬åˆ°åç«¯å¼€å‘ï¼Œä½†æ˜¯å›½å†…äº’è”ç½‘æ±‚èŒç¯å¢ƒä¸€å†æ¶åŒ– é›¶ç»éªŒè½¬è¡ŒåŸºæœ¬ä¸Šæ²¡æˆ ä¹‹åçš„èŒä¸šè§„åˆ’ æˆ‘æƒ³æ˜¯æœ‰ä¸‰ä¸ªé€‰é¡¹\nSDET(è¿™ä¸ªå¯èƒ½æ€§æœ€é«˜ï¼Œé™¤éæµ‹è¯•éœ€æ±‚æ²¡æœ‰äº†ï¼Œç›®æ ‡æ˜¯ä»ä¸­é«˜çº§å¼€å§‹) å‰ç«¯å¼€å‘(éœ€æ±‚é‡åº”è¯¥æ˜¯æœ€é«˜çš„ï¼Œç›®æ ‡æ˜¯ä»åˆçº§/åŠ©ç†å¼€å§‹) å…¨æ ˆå¼€å‘(è¿™ä¸ªçš„è¯å°±æ˜¯ nodejs å…¨æ ˆï¼Œç›®æ ‡ä¹Ÿæ˜¯åˆçº§/åŠ©ç†) éœ€è¦æå‡çš„æŠ€èƒ½ ä¼˜å…ˆçº§ä»é«˜åˆ°ä½\nPython/Js/Javaï¼ˆä¸èƒ½å¥½é«˜éª›è¿œï¼Œæµ‹è¯•éœ€è¦çš„å°±æ˜¯è¿™äº›æŠ€æœ¯æ ˆï¼‰ å¼€æºé¡¹ç›®å‚ä¸ï¼Œä» Playwright å…¥æ‰‹å‚ä¸å¼€æºé¡¹ç›® å‰ç«¯æ€§èƒ½æµ‹è¯•å®æˆ˜ï¼Œä¹‹å‰ç”¨ Lighthouse åˆæ­¥äº†è§£è¿‡ä¸€ç‚¹ï¼Œä½†æ˜¯è¿œè¿œä¸å¤Ÿ æ­£åœ¨åšçš„äº‹ k6 å­¦ä¹ ï¼Œæœ€è¿‘ä½¿ç”¨k6åšäº†ä¸€äº›å‹æµ‹å®æˆ˜ï¼Œæ”¶è·äº†ä¸å°‘ï¼Œæ­å»ºäº†æ¡†æ¶ æœç´¢å¼•æ“å‹æµ‹(elasticsearchä¸meilisearchçš„å‹æµ‹æ¯”è¾ƒ) å·¥ä½œä¸­éœ€è¦çš„æŠ€èƒ½ Mongo/Postgresï¼ˆä¹‹å‰æ²¡æ€ä¹ˆä½¿ç”¨è¿‡ï¼‰ Elasticsearch DSLï¼ˆå¤§æ•°æ®æµ‹è¯•è¿˜æ˜¯æœ‰é—¨æ§›ï¼Œä¹Ÿæœ‰éœ€æ±‚çš„ï¼‰ All in Python/Js ä»¥åŠ AI ","date":"2025-04-26T22:58:44+08:00","permalink":"https://www.cengdong.store/p/sdet%E4%B9%8B%E8%B7%AF%E5%BE%85%E6%8F%90%E5%8D%87%E6%8A%80%E8%83%BD/","title":"ã€SDETä¹‹è·¯ã€‘å¾…æå‡æŠ€èƒ½"},{"content":"å¥½çš„ä¹ æƒ¯ æµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™æ˜¯æœ€é‡è¦çš„èƒ½åŠ›ï¼Œéœ€è¦ä¸“é¡¹æå‡ æµ‹è¯•å‘ç°ä¸è‡ªå·±é¢„æœŸä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå…ˆè®°å½•ï¼Œå†é—®æ˜¯ä¸æ˜¯ bugï¼Œè¿˜è¦å®šä½åˆ°åº•æ˜¯è°çš„é—®é¢˜ è€ƒè™‘æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ä¸è¦ä»…ä»…è€ƒè™‘åŠŸèƒ½ç”¨ä¾‹ï¼Œè¿˜è¦è€ƒè™‘æ€§èƒ½/å®‰å…¨æ€§ç­‰é—®é¢˜ åœ¨éªŒè¯ä¸€ä¸ªåŠŸèƒ½/å›å½’ä¸€ä¸ª bug æ—¶ï¼Œè¦ä¸€æ¬¡æ€§éªŒè¯æ‰€æœ‰çš„ç›¸å…³åŠŸèƒ½ï¼Œé˜²æ­¢é‡å¤è¿”å·¥ æµ‹è¯•å·¥ç¨‹ä¸­è¦æ€è€ƒéœ€æ±‚å®ç°æ˜¯ä¸æ˜¯åˆç† æµ‹è¯•ç¯å¢ƒè¿›è¡Œçš„éªŒè¯å¯èƒ½åœ¨ç”Ÿäº§ç¯å¢ƒè·‘ä¸é€šï¼Œå› ä¸ºæ¶æ„ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æµ‹è¯•ç”¨ä¾‹ä¹Ÿè¦è€ƒè™‘ åœ¨éœ€æ±‚è¯„å®¡/æµ‹è¯•çš„é˜¶æ®µé¦–å…ˆè¦ç¡®å®šUIäº¤äº’çš„é—®é¢˜ å·¥å…·å¼€å‘èƒ½åŠ› æŠŠä¸€äº›é‡å¤çš„å·¥ä½œé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬è§£å†³ é€ æ•°å¹³å°(fastapi) æŒ¡æ¿(mitmproxy) sqlç¼–å†™èƒ½åŠ› å¸¸ç”¨sqlåœ¨navicatä¸­ä¿å­˜æˆæŸ¥è¯¢ ä¸šåŠ¡éœ€è¦çš„ç‰¹æ®Šæ•°æ®ç”¨sqlå®šæœŸæŸ¥è¯¢ çº¿ä¸Šå›å½’ æ¥å£è‡ªåŠ¨åŒ–ææ•ˆ åŸºæœ¬åŠŸèƒ½éœ€è¦è¿‡ä¸€é æ‰€æœ‰å¯èƒ½å½±å“çš„åŠŸèƒ½éƒ½éœ€è¦ç‚¹ä¸€ç‚¹ å¦‚ä½•å¿«é€Ÿææ‡‚ä¸šåŠ¡ å¹³å¸¸å¤šç”¨åŠŸèƒ½ æŸ¥çœ‹æ¥å£/æ¥å£æ–‡æ¡£ï¼ŒæŠ“åŒ…è¿›è¡Œåˆ†æ æŸ¥çœ‹æ•°æ®åº“è¡¨/å­—æ®µçš„æ³¨é‡Š æ‹‰å–å‰åç«¯ä»£ç è¿›è¡Œèµ°è¯»/review å·¥ä½œä¸­éœ€è¦çš„èƒ½åŠ› æµ‹è¯•ç”¨ä¾‹è®¾è®¡çš„é«˜æ•ˆä»¥åŠåŠŸèƒ½è¦†ç›–ç‡ åŠŸèƒ½ç‚¹çš„ UI æ ¡éªŒï¼ˆæ–‡å­—ä»¥åŠæ ·å¼ï¼‰(è¦å­¦ä¼šä½¿ç”¨ figma) åŠŸèƒ½ç‚¹è¾“å…¥çš„è®¾è®¡ åŠŸèƒ½ç‚¹è¾“å‡ºçš„è®¾è®¡ åŠŸèƒ½ç‚¹çŠ¶æ€çš„è®¾è®¡(çŠ¶æ€æœºè½¬ç§»ï¼ŒçŠ¶æ€æ˜¯å¦å¯é‡å…¥) æ²Ÿé€šèƒ½åŠ› è¯´æ˜é—®é¢˜çš„èƒ½åŠ›ï¼ˆæ bug æ˜¯å¦æ¸…æ™°ï¼šå¤ç°æ­¥éª¤ï¼Œå¿…è¦æ—¶åŠ ä¸Šå½•å±ï¼‰ è¯·æ±‚é—®é¢˜ï¼ˆé«˜æ•ˆæé—®çš„èƒ½åŠ›ï¼‰ è§£å†³é—®é¢˜çš„èƒ½åŠ› é‡åˆ°é—®é¢˜é¦–å…ˆæƒ³åˆ°çš„æ˜¯è®°å½•(å› ä¸ºå¤ç°çš„æˆæœ¬æ¯”è¾ƒé«˜) ä¸èƒ½æœ‰ä»»ä½•ä¾¥å¹¸å¿ƒç† å¯è§‚æµ‹æ€§å»ºè®¾ä¸èƒ½åŠ›æå‡(logs/traces/metrics) code review ","date":"2025-04-21T19:08:21+08:00","permalink":"https://www.cengdong.store/p/%E5%B7%A5%E4%BD%9C%E5%BF%83%E5%BE%97%E6%B5%8B%E8%AF%95%E5%B7%A5%E4%BD%9C%E5%BF%83%E5%BE%97/","title":"ã€å·¥ä½œå¿ƒå¾—ã€‘æµ‹è¯•å·¥ä½œå¿ƒå¾—"},{"content":"ui è‡ªåŠ¨åŒ–éœ€è¦è·³è½¬æ–°çš„ tab é¡µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 async addMonitorEnterprise() { const pagePromise = this.page.context().waitForEvent(\u0026#39;page\u0026#39;) await this.searchInput.focus() await this.searchInput.fill(\u0026#39;ä¹è§†\u0026#39;) await expect(this.hisEntList).toBeVisible({}) await this.hisEntItem.first().click() // ç­‰å¾…æ–°é¡µé¢è·³è½¬å¹¶è·å–æ–°çš„é¡µé¢ const newPage = await pagePromise // ä½¿ç”¨æ–°é¡µé¢çš„å®šä½å™¨ const addMonitorButton = newPage .locator(\u0026#39;.info-basic-box\u0026#39;) .getByRole(\u0026#39;button\u0026#39;, { name: \u0026#39; æ·»åŠ ç›‘æ§\u0026#39;, }) await expect(addMonitorButton).toBeVisible() await addMonitorButton.click() } æ³¨æ„ç‚¹ ä½¿ç”¨page.context().waitForEvent()å¾—åˆ°æ–°é¡µé¢çš„ promise ç­‰å¾…è‡ªåŠ¨åŒ–ä»£ç è§¦å‘æ‰“å¼€æ–°é¡µé¢ await è¿™ä¸ª promise è·å¾—æ–°é¡µé¢ ä½¿ç”¨æ–°é¡µé¢çš„å¯¹è±¡è°ƒç”¨æ–¹æ³• ","date":"2025-04-17T23:45:57+08:00","permalink":"https://www.cengdong.store/p/playwrightplaywright%E6%A0%87%E7%AD%BE%E9%A1%B5%E5%88%87%E6%8D%A2/","title":"ã€Playwrightã€‘Playwrightæ ‡ç­¾é¡µåˆ‡æ¢"},{"content":"é‡åˆ°çš„é—®é¢˜ ä½¿ç”¨playwright.config.tsä¸­çš„dependenciesé…ç½®é¡¹æ¥è¿›è¡Œå…¶ä»–ç”¨ä¾‹çš„å‰ç½®ç™»é™†\n1 2 3 4 5 6 7 8 9 10 11 // Setup project { name: \u0026#39;setup\u0026#39;, testMatch: /setup\\.ts/ }, { name: \u0026#39;chromium\u0026#39;, use: { ...devices[\u0026#39;Desktop Chrome\u0026#39;], storageState: \u0026#39;tests/.auth/zengdong.json\u0026#39;, }, dependencies: [\u0026#39;setup\u0026#39;], }, å…¶ä¸­setup.tsçš„å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import { expect, test as setup } from \u0026#39;@playwright/test\u0026#39; import path from \u0026#39;path\u0026#39; const authFile = path.join(__dirname, \u0026#39;../.auth/zengdong.json\u0026#39;) setup(\u0026#39;authenticate\u0026#39;, async ({ page }) =\u0026gt; { // Perform authentication steps. Replace these actions with your own. await page.goto(\u0026#39;/auth/login\u0026#39;) await page.getByPlaceholder(\u0026#39;è¯·è¾“å…¥é‚®ç®±åœ°å€\u0026#39;).fill(\u0026#39;xxxxxxxx\u0026#39;) await page.getByPlaceholder(\u0026#39;è¯·è¾“å…¥å¯†ç \u0026#39;).fill(\u0026#39;xxxxxx\u0026#39;) await page.getByRole(\u0026#39;button\u0026#39;, { name: \u0026#39;ç™» å½•\u0026#39; }).click() // Wait until the page receives the cookies. await expect(page.getByText(\u0026#39;ç™»å½•æˆåŠŸ\u0026#39;)).toBeVisible() // Alternatively, you can wait until the page reaches a state where all cookies are set. await page.waitForURL(\u0026#39;http://xxxxxxxxxx\u0026#39;, { waitUntil: \u0026#39;load\u0026#39;, }) // End of authentication steps. await page.context().storageState({ path: authFile }) }) ä½†æ˜¯ç™»é™†é¡µé¢çš„ç”¨ä¾‹ä¸éœ€è¦å‰ç½®ç™»é™†\nè§£å†³æ–¹æ¡ˆ ç™»é™†ç”¨ä¾‹å•ç‹¬é…ç½®æˆä¸€ä¸ª projectï¼Œå…¶ä»– project å¿½ç•¥ç™»é™†ç”¨ä¾‹ ç™»é™†ç”¨ä¾‹ä¸ä½¿ç”¨ setup.ts ç”Ÿæˆçš„ storageState 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import { AuthPage } from \u0026#39;../pages/authPage\u0026#39; import { AllMonitorPage } from \u0026#39;../pages/allMonitorPage\u0026#39; import { test as baseTest } from \u0026#39;@playwright/test\u0026#39; export const test = baseTest.extend\u0026lt;{ authPage: AuthPage allMonitorPage: AllMonitorPage }\u0026gt;({ authPage: async ({ browser, storageState }, use) =\u0026gt; { // ğŸ‘‰ ä½¿ç”¨ test.use ä¼ ä¸‹æ¥çš„ storageState å‚æ•°ï¼ˆé»˜è®¤æˆ–è¢«è¦†ç›–ï¼‰ const context = await browser.newContext({ storageState: undefined, }) const page = await context.newPage() const authPage = new AuthPage(page) await use(authPage) await context.close() }, allMonitorPage: async ({ page }, use) =\u0026gt; { await use(new AllMonitorPage(page)) }, }) ","date":"2025-04-13T23:38:39+08:00","permalink":"https://www.cengdong.store/p/playwrightplaywright%E7%99%BB%E9%99%86%E8%AE%A4%E8%AF%81/","title":"ã€Playwrightã€‘Playwrightç™»é™†è®¤è¯"},{"content":"ä»‹ç» Python æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼Œç®€ç§° regexï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºå­—ç¬¦ä¸²åŒ¹é…ã€æŸ¥æ‰¾ã€æ›¿æ¢å’Œåˆ†å‰²ã€‚Python çš„ re æ¨¡å—æä¾›äº†å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒã€‚\nå¯¼å…¥ re æ¨¡å— åœ¨ Python ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œéœ€è¦å…ˆå¯¼å…¥ re æ¨¡å—ï¼š\n1 import re æ­£åˆ™è¡¨è¾¾å¼åŸºæœ¬è¯­æ³• æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼ˆå…ƒå­—ç¬¦ metacharactersï¼‰æ¥å®šä¹‰åŒ¹é…æ¨¡å¼ã€‚\nç¬¦å· è¯´æ˜ ç¤ºä¾‹ . åŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆé™¤æ¢è¡Œç¬¦ï¼‰ a.c å¯åŒ¹é… abc, a+c ^ åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ ^Hello åŒ¹é… \u0026quot;Hello world\u0026quot; $ åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ end$ åŒ¹é… \u0026quot;the end\u0026quot; * åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦ 0 æ¬¡æˆ–å¤šæ¬¡ ab*c åŒ¹é… \u0026quot;ac\u0026quot;, \u0026quot;abc\u0026quot; + åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦ 1 æ¬¡æˆ–å¤šæ¬¡ ab+c åŒ¹é… \u0026quot;abc\u0026quot;, \u0026quot;abbc\u0026quot; ? åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦ 0 æˆ– 1 æ¬¡ ab?c åŒ¹é… \u0026quot;ac\u0026quot;, \u0026quot;abc\u0026quot; {n} åŒ¹é…å‰ä¸€ä¸ªå­—ç¬¦ n æ¬¡ a{3} åŒ¹é… \u0026quot;aaa\u0026quot; {n,} è‡³å°‘åŒ¹é… n æ¬¡ a{2,} åŒ¹é… \u0026quot;aa\u0026quot;, \u0026quot;aaa\u0026quot; {n,m} åŒ¹é… n åˆ° m æ¬¡ a{2,4} åŒ¹é… \u0026quot;aa\u0026quot;, \u0026quot;aaa\u0026quot; [] åŒ¹é…å­—ç¬¦ç±»ä¸­çš„ä»»æ„å­—ç¬¦ [aeiou] åŒ¹é…ä»»ä½•å…ƒéŸ³å­—æ¯ \\d åŒ¹é…æ•°å­—ï¼ˆ0-9ï¼‰ \\d+ åŒ¹é… \u0026quot;123\u0026quot;, \u0026quot;456\u0026quot; \\D åŒ¹é…éæ•°å­— \\D+ åŒ¹é… \u0026quot;abc\u0026quot; å¸¸ç”¨é¢„å®šä¹‰å­—ç¬¦é›† ç¬¦å· ä½œç”¨ ç¤ºä¾‹ \\d åŒ¹é… æ•°å­—ï¼ˆ0-9ï¼‰ \\d+ åŒ¹é… \u0026quot;123\u0026quot;, \u0026quot;456\u0026quot; \\D åŒ¹é… éæ•°å­— \\D+ åŒ¹é… \u0026quot;abc\u0026quot;, \u0026quot;hello\u0026quot; \\w åŒ¹é… å•è¯å­—ç¬¦ï¼ˆå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼‰ \\w+ åŒ¹é… \u0026quot;hello_123\u0026quot; \\W åŒ¹é… éå•è¯å­—ç¬¦ \\W+ åŒ¹é… \u0026quot;,.!@\u0026quot; \\s åŒ¹é… ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ \\tã€æ¢è¡Œ \\nï¼‰ \\s+ åŒ¹é… \u0026quot; \u0026quot; \\S åŒ¹é… éç©ºç™½å­—ç¬¦ \\S+ åŒ¹é… \u0026quot;hello\u0026quot; re æ¨¡å—çš„å¸¸ç”¨å‡½æ•° re.match() - ä»å­—ç¬¦ä¸²å¼€å¤´å¼€å§‹åŒ¹é… 1 2 3 4 5 6 7 8 import re pattern = r\u0026#34;hello\u0026#34; text = \u0026#34;hello world\u0026#34; match = re.match(pattern, text) if match: print(\u0026#34;åŒ¹é…æˆåŠŸ:\u0026#34;, match.group()) # è¾“å‡º: hello re.search() - æœç´¢æ•´ä¸ªå­—ç¬¦ä¸² 1 2 3 4 5 6 7 8 import re pattern = r\u0026#34;world\u0026#34; text = \u0026#34;hello world\u0026#34; search_result = re.search(pattern, text) if search_result: print(\u0026#34;åŒ¹é…æˆåŠŸ:\u0026#34;, search_result.group()) # è¾“å‡º: world re.findall() - è¿”å›æ‰€æœ‰åŒ¹é…é¡¹çš„åˆ—è¡¨ 1 2 3 4 5 6 import re pattern = r\u0026#34;\\d+\u0026#34; text = \u0026#34;è®¢å•ç¼–å· 12345ï¼Œé‡‘é¢ 67890\u0026#34; matches = re.findall(pattern, text) print(matches) # è¾“å‡º: [\u0026#39;12345\u0026#39;, \u0026#39;67890\u0026#39;] re.finditer() - è¿”å›æ‰€æœ‰åŒ¹é…é¡¹çš„è¿­ä»£å™¨ 1 2 3 4 5 6 7 8 9 10 11 import re pattern = r\u0026#34;\\d+\u0026#34; text = \u0026#34;è®¢å•ç¼–å· 12345ï¼Œé‡‘é¢ 67890\u0026#34; matches = re.finditer(pattern, text) for match in matches: print(\u0026#34;åŒ¹é…é¡¹:\u0026#34;, match.group()) # è¾“å‡º: # åŒ¹é…é¡¹: 12345 # åŒ¹é…é¡¹: 67890 re.sub() - æ›¿æ¢åŒ¹é…é¡¹ 1 2 3 4 5 6 import re pattern = r\u0026#34;\\d+\u0026#34; text = \u0026#34;ä»·æ ¼ 100 å…ƒ\u0026#34; new_text = re.sub(pattern, \u0026#34;200\u0026#34;, text) print(new_text) # è¾“å‡º: ä»·æ ¼ 200 å…ƒ re.split() - æ ¹æ®åŒ¹é…é¡¹åˆ†å‰²å­—ç¬¦ä¸² 1 2 3 4 5 6 import re pattern = r\u0026#34;\\s+\u0026#34; text = \u0026#34;Hello world Python\u0026#34; split_text = re.split(pattern, text) print(split_text) # è¾“å‡º: [\u0026#39;Hello\u0026#39;, \u0026#39;world\u0026#39;, \u0026#39;Python\u0026#39;] ä½¿ç”¨ re.compile() æé«˜æ€§èƒ½ re.compile() å¯ä»¥é¢„ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œæé«˜åŒ¹é…æ•ˆç‡ï¼Œé€‚ç”¨äºéœ€è¦é‡å¤åŒ¹é…çš„æƒ…å†µã€‚\n1 2 3 4 5 6 7 8 import re pattern = re.compile(r\u0026#34;\\d+\u0026#34;) text = \u0026#34;è®¢å•ç¼–å· 12345ï¼Œé‡‘é¢ 67890\u0026#34; # å¤ç”¨ç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼ print(pattern.findall(text)) # è¾“å‡º: [\u0026#39;12345\u0026#39;, \u0026#39;67890\u0026#39;] print(pattern.sub(\u0026#34;X\u0026#34;, text)) # è¾“å‡º: è®¢å•ç¼–å· Xï¼Œé‡‘é¢ X è´ªå©ªåŒ¹é…ä¸éè´ªå©ªåŒ¹é… é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯è´ªå©ªåŒ¹é…ï¼ˆåŒ¹é…å°½å¯èƒ½å¤šçš„å­—ç¬¦ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 import re text = \u0026#39;\u0026lt;div\u0026gt;Hello\u0026lt;/div\u0026gt;\u0026lt;div\u0026gt;World\u0026lt;/div\u0026gt;\u0026#39; # è´ªå©ªåŒ¹é…ï¼ˆåŒ¹é…æœ€å¤§å¯èƒ½çš„éƒ¨åˆ†ï¼‰ print(re.findall(r\u0026#39;\u0026lt;div\u0026gt;.*\u0026lt;/div\u0026gt;\u0026#39;, text)) # è¾“å‡º: [\u0026#39;\u0026lt;div\u0026gt;Hello\u0026lt;/div\u0026gt;\u0026lt;div\u0026gt;World\u0026lt;/div\u0026gt;\u0026#39;] # éè´ªå©ªåŒ¹é…ï¼ˆåŒ¹é…æœ€å°å¯èƒ½çš„éƒ¨åˆ†ï¼‰ print(re.findall(r\u0026#39;\u0026lt;div\u0026gt;.*?\u0026lt;/div\u0026gt;\u0026#39;, text)) # è¾“å‡º: [\u0026#39;\u0026lt;div\u0026gt;Hello\u0026lt;/div\u0026gt;\u0026#39;, \u0026#39;\u0026lt;div\u0026gt;World\u0026lt;/div\u0026gt;\u0026#39;] ","date":"2025-03-15T22:43:13+08:00","permalink":"https://www.cengdong.store/p/pythonpython%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8Fre%E6%A8%A1%E5%9D%97/","title":"ã€Pythonã€‘Pythonæ­£åˆ™è¡¨è¾¾å¼reæ¨¡å—"},{"content":"ä»‹ç» åœ¨ Python ä¸­ï¼ŒEnumï¼ˆæšä¸¾ï¼‰æ˜¯ä¸€ç§ç”¨äºå®šä¹‰ä¸€ç»„å‘½åå¸¸é‡çš„ç±»ã€‚å®ƒå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œé˜²æ­¢ä½¿ç”¨é­”æ³•æ•°å­—ï¼ˆmagic numbersï¼‰ï¼Œå¹¶ç¡®ä¿å˜é‡çš„å€¼åªèƒ½æ˜¯é¢„å®šä¹‰çš„é€‰é¡¹ä¹‹ä¸€ã€‚\nå®šä¹‰ Enum Python æä¾›äº† enum æ¨¡å—ï¼Œå¯ä»¥ç”¨ Enum ç±»æ¥å®šä¹‰æšä¸¾ï¼š\n1 2 3 4 5 6 from enum import Enum class Color(Enum): RED = 1 GREEN = 2 BLUE = 3 è®¿é—®æšä¸¾æˆå‘˜\n1 2 3 print(Color.RED) # Color.RED print(Color.RED.name) # RED print(Color.RED.value) # 1 éå†æšä¸¾ å¯ä»¥ä½¿ç”¨ for å¾ªç¯éå†æšä¸¾ï¼š\n1 2 3 4 5 6 for color in Color: print(color.name, color.value) # RED 1 # GREEN 2 # BLUE 3 æˆå‘˜æ¯”è¾ƒ å¯ä»¥ä½¿ç”¨ is æˆ– == è¿›è¡Œæ¯”è¾ƒï¼š\n1 2 3 4 5 if Color.RED is Color.RED: print(\u0026#34;Same member\u0026#34;) if Color.RED == Color(1): print(\u0026#34;Same value\u0026#34;) æšä¸¾çš„å”¯ä¸€æ€§ é»˜è®¤æƒ…å†µä¸‹ï¼Œæšä¸¾æˆå‘˜çš„å€¼å¯ä»¥é‡å¤ï¼Œä½†å¯ä»¥ä½¿ç”¨ @unique è£…é¥°å™¨å¼ºåˆ¶å”¯ä¸€ï¼š\n1 2 3 4 5 6 7 8 from enum import Enum, unique @unique class UniqueColor(Enum): RED = 1 GREEN = 2 BLUE = 3 # YELLOW = 1 # è¿™è¡Œä¼šæŠ¥é”™ / This line will cause an error è‡ªåŠ¨èµ‹å€¼æšä¸¾ 1 2 3 4 5 6 7 8 9 10 from enum import Enum, auto class AutoColor(Enum): RED = auto() GREEN = auto() BLUE = auto() print(AutoColor.RED.value) # 1 print(AutoColor.GREEN.value) # 2 print(AutoColor.BLUE.value) # 3 IntEnumï¼ˆæ•´æ•°æšä¸¾ï¼‰ å¦‚æœæƒ³è®©æšä¸¾æˆå‘˜è¡¨ç°å¾—åƒæ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨ IntEnumï¼š\n1 2 3 4 5 6 7 8 9 from enum import IntEnum class Status(IntEnum): SUCCESS = 200 NOT_FOUND = 404 ERROR = 500 print(Status.SUCCESS == 200) # True print(Status.SUCCESS + 100) # 300 æ³¨æ„ï¼šæ™®é€š Enum ä¸èƒ½ç›´æ¥ä¸æ•´æ•°è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œè€Œ IntEnum å¯ä»¥ã€‚\næˆå‘˜åˆ«å å¦‚æœå¤šä¸ªæˆå‘˜çš„å€¼ç›¸åŒï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå®šä¹‰çš„æˆå‘˜ä¼šä½œä¸ºæ­£å¼æˆå‘˜ï¼Œå…¶ä»–çš„æ˜¯åˆ«åï¼š\n1 2 3 4 5 6 7 8 class Shape(Enum): CIRCLE = 1 OVAL = 2 ELLIPSE = 2 # è¿™æ˜¯ OVAL çš„åˆ«å / This is an alias for OVAL print(Shape.OVAL) # Shape.OVAL print(Shape.ELLIPSE) # Shape.OVAL print(Shape.OVAL is Shape.ELLIPSE) # True è‡ªå®šä¹‰æ–¹æ³• 1 2 3 4 5 6 7 8 class Message(Enum): HELLO = \u0026#34;Hello\u0026#34; GOODBYE = \u0026#34;Goodbye\u0026#34; def describe(self): return f\u0026#34;Message: {self.value}\u0026#34; print(Message.HELLO.describe()) # Message: Hello ","date":"2025-03-14T22:51:42+08:00","permalink":"https://www.cengdong.store/p/pythonpython%E6%9E%9A%E4%B8%BEenum/","title":"ã€Pythonã€‘Pythonæšä¸¾Enum"},{"content":"ä»‹ç» Python çš„**é­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰**æ˜¯ä»¥åŒä¸‹åˆ’çº¿ __ åŒ…å›´çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¸¸ç”¨äºé‡è½½è¿ç®—ç¬¦ã€å®šä¹‰å¯¹è±¡è¡Œä¸ºç­‰ã€‚\nå¯¹è±¡çš„åˆ›å»ºä¸é”€æ¯ æ–¹æ³• ä½œç”¨ __new-_(cls, *args, **kwargs) åˆ›å»ºå¯¹è±¡(åœ¨__init__ä¹‹å‰è°ƒç”¨) __init__(self, \\*args, \\*\\*kwargs) åˆå§‹åŒ–å¯¹è±¡ __del__(self) å¯¹è±¡é”€æ¯æ—¶è°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 class MyClass: def __new__(cls): print(\u0026#34;Creating instance\u0026#34;) return super().__new__(cls) def __init__(self): print(\u0026#34;Initializing instance\u0026#34;) def __del__(self): print(\u0026#34;Destroying instance\u0026#34;) obj = MyClass() del obj # æ˜¾å¼é”€æ¯å¯¹è±¡ å­—ç¬¦ä¸²è¡¨ç¤º æ–¹æ³• ä½œç”¨ __str__(self) str(obj)ï¼Œç”¨äºç”¨æˆ·å¯è¯»çš„å­—ç¬¦ä¸²è¡¨ç¤º __repr__(self) repr(obj)ï¼Œç”¨äºè°ƒè¯•çš„å­—ç¬¦ä¸²è¡¨ç¤º __format__(self, format_spec) format(obj, spec)ï¼Œè‡ªå®šä¹‰æ ¼å¼åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 class Person: def __init__(self, name): self.name = name def __str__(self): return f\u0026#34;Person: {self.name}\u0026#34; # ç”¨æˆ·å‹å¥½çš„æè¿° def __repr__(self): return f\u0026#34;Person(name={self.name!r})\u0026#34; # å¼€å‘è€…å‹å¥½çš„è¡¨ç¤º p = Person(\u0026#34;Alice\u0026#34;) print(str(p)) # Person: Alice print(repr(p)) # Person(name=\u0026#39;Alice\u0026#39;) ç®—æ•°è¿ç®—ç¬¦é‡è½½ æ–¹æ³• ä½œç”¨ __add__(self, other) + åŠ æ³• __sub__(self, other) - å‡æ³• __mul__(self, other) * ä¹˜æ³• __truediv__(self, other) / é™¤æ³• __floordiv__(self, other) // æ•´é™¤ __mod__(self, other) % å–ä½™ __pow__(self, other) ** å¹‚è¿ç®— __neg__(self) - å–è´Ÿ __abs__(self) abs(obj) ç»å¯¹å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 class Vector: def __init__(self, x, y): self.x, self.y = x, y def __add__(self, other): return Vector(self.x + other.x, self.y + other.y) def __str__(self): return f\u0026#34;Vector({self.x}, {self.y})\u0026#34; v1 = Vector(1, 2) v2 = Vector(3, 4) print(v1 + v2) # Vector(4, 6) æ¯”è¾ƒè¿ç®—ç¬¦ æ–¹æ³• ä½œç”¨ __eq__(self, other) == ç­‰äº __ne__(self, other) != ä¸ç­‰äº __lt__(self, other) \u0026lt; å°äº __le__(self, other) \u0026lt;= å°äºç­‰äº __gt__(self, other) \u0026gt; å¤§äº __ge__(self, other) \u0026gt;= å¤§äºç­‰äº 1 2 3 4 5 6 7 8 9 10 class Person: def __init__(self, age): self.age = age def __lt__(self, other): return self.age \u0026lt; other.age p1 = Person(25) p2 = Person(30) print(p1 \u0026lt; p2) # True å®¹å™¨ç›¸å…³ æ–¹æ³• ä½œç”¨ __len__(self) len(obj)ï¼Œè¿”å›å¯¹è±¡é•¿åº¦ __getitem__(self, key) obj[key]ï¼Œè·å–å…ƒç´  __setitem__(self, key, value) obj[key] = valueè®¾ç½®å…ƒç´  __delitem__(self, key) del obj[key]ï¼Œåˆ é™¤å…ƒç´  __contains__(self, item) item in objæ£€æŸ¥æ˜¯å¦åŒ…å« 1 2 3 4 5 6 7 8 9 10 11 12 13 class CustomList: def __init__(self, data): self.data = data def __len__(self): return len(self.data) def __getitem__(self, index): return self.data[index] cl = CustomList([1, 2, 3]) print(len(cl)) # 3 print(cl[1]) # 2 è¿­ä»£å™¨ æ–¹æ³• ä½œç”¨ __iter__self) ä½¿å¯¹è±¡å¯è¿­ä»£ __next__(self) next(obj)è¿”å›è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 class Counter: def __init__(self, max_count): self.max = max_count self.current = 0 def __iter__(self): return self # è¿­ä»£å™¨è¿”å›è‡ªèº« def __next__(self): if self.current \u0026lt; self.max: self.current += 1 return self.current else: raise StopIteration c = Counter(3) for i in c: print(i) # 1, 2, 3 ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆContext Managerï¼‰ æ–¹æ³• ä½œç”¨ __enter__(self) è¿›å…¥ with ä»£ç å— __exit__(self, exc_type, exc_value, traceback) é€€å‡º with ä»£ç å— 1 2 3 4 5 6 7 8 9 10 11 12 class FileHandler: def __init__(self, filename, mode): self.file = open(filename, mode) def __enter__(self): return self.file def __exit__(self, exc_type, exc_value, traceback): self.file.close() with FileHandler(\u0026#34;test.txt\u0026#34;, \u0026#34;w\u0026#34;) as f: f.write(\u0026#34;Hello, world!\u0026#34;) ","date":"2025-03-13T15:27:47+08:00","permalink":"https://www.cengdong.store/p/pythonpython%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/","title":"ã€Pythonã€‘Pythoné­”æœ¯æ–¹æ³•"},{"content":"ä»‹ç» CSS Grid Layoutï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰æ˜¯æœ€å¼ºå¤§çš„ CSS å¸ƒå±€ç³»ç»Ÿï¼Œå®ƒæä¾›äºŒç»´å¸ƒå±€èƒ½åŠ›ï¼Œèƒ½å¤Ÿç²¾ç¡®æ§åˆ¶è¡Œï¼ˆrowï¼‰å’Œåˆ—ï¼ˆcolumnï¼‰ï¼Œé€‚ç”¨äºç½‘é¡µæ•´ä½“ç»“æ„æˆ–å¤æ‚ç»„ä»¶\nGrid å®¹å™¨ï¼ˆGrid Containerï¼‰ ä½¿ç”¨ display: grid æˆ– display: inline-grid å£°æ˜ä¸€ä¸ª Grid å®¹å™¨ï¼š\n1 2 3 .container { display: grid; /* å®šä¹‰ä¸€ä¸ªç½‘æ ¼å¸ƒå±€å®¹å™¨ */ } ğŸ“Œ grid VS inline-gridï¼š\ngridï¼šå—çº§ç½‘æ ¼å®¹å™¨ï¼Œå æ®æ•´è¡Œ inline-gridï¼šå†…è”çº§ç½‘æ ¼å®¹å™¨ï¼Œå¤§å°ç”±å†…å®¹å†³å®š å®šä¹‰ç½‘æ ¼ï¼ˆè¡Œå’Œåˆ—ï¼‰ ä½¿ç”¨ grid-template-columns å’Œ grid-template-rows å®šä¹‰åˆ—æ•°å’Œè¡Œæ•°ï¼š\n1 2 3 4 5 .container { display: grid; grid-template-columns: 200px 100px auto; /* 3 åˆ— */ grid-template-rows: 100px 200px; /* 2 è¡Œ */ } ğŸ“Œ è§£é‡Šï¼š\n200px 100px auto â†’ 3 åˆ—ï¼Œåˆ†åˆ«ä¸º 200pxã€100px å’Œå‰©ä½™å®½åº¦ 100px 200px â†’ 2 è¡Œï¼Œåˆ†åˆ« 100pxã€200px frï¼ˆç½‘æ ¼æ¯”ä¾‹å•ä½ï¼‰ ç”¨ fr è®©ç½‘æ ¼è‡ªåŠ¨åˆ†é…å¯ç”¨ç©ºé—´ï¼š\n1 2 3 4 .container { display: grid; grid-template-columns: 1fr 2fr 1fr; /* æŒ‰æ¯”ä¾‹åˆ’åˆ†åˆ— */ } ğŸ“Œ 1fr 2fr 1fr â†’ è¿™ä¸‰åˆ—çš„å®½åº¦æ¯”ä¾‹ä¸º 1:2:1ï¼ˆç±»ä¼¼ flex-growï¼‰\nrepeat()ï¼ˆç®€åŒ–ç½‘æ ¼ï¼‰ ä½¿ç”¨ repeat() è®©ä»£ç æ›´ç®€æ´ï¼š\n1 2 grid-template-columns: repeat(3, 1fr); /* 3 åˆ—ï¼Œæ¯åˆ—ç­‰å®½ */ grid-template-rows: repeat(2, 100px); /* 2 è¡Œï¼Œæ¯è¡Œ 100px */ ğŸ“Œ repeat(3, 1fr) â†’ ç›¸å½“äº 1fr 1fr 1fr\ngapï¼ˆç½‘æ ¼é—´è·ï¼‰ 1 2 3 4 5 .container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; /* è®¾ç½®è¡Œåˆ—é—´è· */ } ğŸ“Œ ç­‰ä»·äºï¼š\n1 2 row-gap: 20px; /* ä»…è®¾ç½®è¡Œé—´è· */ column-gap: 20px; /* ä»…è®¾ç½®åˆ—é—´è· */ è‡ªåŠ¨å¡«å…… auto-fill \u0026amp; auto-fit ç”¨äºå“åº”å¼å¸ƒå±€ï¼š\n1 grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); ğŸ“Œ è§£é‡Šï¼š\nminmax(150px, 1fr) â†’ è®¾å®šæœ€å° 150pxï¼Œæœ€å¤§å¡«å……å‰©ä½™ç©ºé—´ auto-fill â†’ å°½å¯èƒ½å¤šå¡«å……åˆ—ï¼Œå³ä½¿æœ‰ç©ºç™½ auto-fit â†’ é€‚é…åˆ—æ•°ï¼Œä¼šå‹ç¼©ç©ºåˆ— å­å…ƒç´ å¸ƒå±€ grid-column \u0026amp; grid-rowï¼ˆæ§åˆ¶ç½‘æ ¼é¡¹ä½ç½®ï¼‰ 1 2 3 4 .item { grid-column: 1 / 3; /* è®©å…ƒç´ è·¨è¶Šç¬¬ 1 ~ 2 åˆ— */ grid-row: 1 / 3; /* è®©å…ƒç´ è·¨è¶Šç¬¬ 1 ~ 2 è¡Œ */ } ğŸ“Œ ç­‰ä»·äºï¼š\n1 2 3 4 grid-column-start: 1; grid-column-end: 3; grid-row-start: 1; grid-row-end: 3; span è¯­æ³• 1 2 3 4 .item { grid-column: span 2; /* è®©å…ƒç´ è·¨ 2 åˆ— */ grid-row: span 2; /* è®©å…ƒç´ è·¨ 2 è¡Œ */ } grid-auto-rows \u0026amp; grid-auto-columns ç”¨äºè‡ªåŠ¨ç”Ÿæˆé¢å¤–çš„è¡Œ/åˆ—ï¼š\n1 2 3 4 .container { grid-template-columns: 200px 200px; /* 2 åˆ— */ grid-auto-rows: 100px; /* é¢å¤–è¡Œé«˜ 100px */ } justify-content \u0026amp; align-contentï¼ˆç½‘æ ¼æ•´ä½“å¯¹é½ï¼‰ ç”¨äºæ§åˆ¶æ•´ä¸ªç½‘æ ¼çš„å¯¹é½æ–¹å¼ï¼š\n1 2 3 4 5 .container { display: grid; justify-content: center; /* æ°´å¹³å¯¹é½ */ align-content: center; /* å‚ç›´å¯¹é½ */ } å±æ€§ ä½œç”¨ å¯é€‰å€¼ justify-content æ§åˆ¶æ°´å¹³æ–¹å‘ start / center / end / space-between / space-around / space-evenly align-content æ§åˆ¶å‚ç›´æ–¹å‘ åŒä¸Š justify-items \u0026amp; align-itemsï¼ˆç½‘æ ¼é¡¹å¯¹é½ï¼‰ ç”¨äºæ§åˆ¶å•ä¸ªç½‘æ ¼é¡¹çš„å¯¹é½ï¼š\n1 2 3 4 .container { justify-items: center; /* æ°´å¹³å±…ä¸­ */ align-items: center; /* å‚ç›´å±…ä¸­ */ } ğŸ“Œ ä½œç”¨å¯¹è±¡ï¼š\njustify-items å½±å“æ‰€æœ‰ç½‘æ ¼é¡¹çš„æ°´å¹³å¯¹é½ align-items å½±å“æ‰€æœ‰ç½‘æ ¼é¡¹çš„å‚ç›´å¯¹é½ justify-self \u0026amp; align-selfï¼ˆå•ä¸ªç½‘æ ¼é¡¹å¯¹é½ï¼‰ 1 2 3 4 .item { justify-self: center; /* ä»…å½±å“å½“å‰å…ƒç´ çš„æ°´å¹³å¯¹é½ */ align-self: center; /* ä»…å½±å“å½“å‰å…ƒç´ çš„å‚ç›´å¯¹é½ */ } ğŸ“Œ åŒºåˆ«ï¼š\njustify-self æ§åˆ¶å•ä¸ªç½‘æ ¼é¡¹çš„æ°´å¹³ä½ç½® align-self æ§åˆ¶å•ä¸ªç½‘æ ¼é¡¹çš„å‚ç›´ä½ç½® grid-template-areasï¼ˆç½‘æ ¼å¸ƒå±€å‘½åï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 .container { display: grid; grid-template-areas: \u0026#39;header header header\u0026#39; \u0026#39;sidebar content content\u0026#39; \u0026#39;footer footer footer\u0026#39;; grid-template-columns: 200px 1fr 1fr; grid-template-rows: 80px auto 60px; } .header { grid-area: header; } .sidebar { grid-area: sidebar; } .content { grid-area: content; } .footer { grid-area: footer; } ","date":"2025-03-12T13:23:27+08:00","permalink":"https://www.cengdong.store/p/cssgrid%E5%B8%83%E5%B1%80/","title":"ã€CSSã€‘Gridå¸ƒå±€"},{"content":"ä»‹ç» Flexï¼ˆFlexible Boxï¼‰æ˜¯ä¸€ç§ç”¨äºå¸ƒå±€çš„ CSS æ–¹å¼ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°å®ç°å…ƒç´ åœ¨å®¹å™¨ä¸­çš„ è‡ªåŠ¨è°ƒæ•´å¤§å°ã€å¯¹é½ã€æ¢è¡Œ ç­‰åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚ç”¨äºå“åº”å¼è®¾è®¡ã€‚\nå¯ç”¨ flex å¸ƒå±€ è¦ä½¿ç”¨ Flex å¸ƒå±€ï¼Œå¿…é¡»å…ˆåœ¨çˆ¶å®¹å™¨ä¸Šè®¾ç½®ï¼š\n1 2 3 .container { display: flex; } flex å®¹å™¨(çˆ¶çº§)å±æ€§ å±æ€§ ä½œç”¨ display: flex å¯ç”¨ flex å¸ƒå±€ï¼Œä½¿å­å…ƒç´ å˜æˆå¼¹æ€§ flex-direction è®¾å®šä¸»è½´æ–¹å‘(rowã€column) flex-wrap è®¾å®šå­å…ƒç´ æ˜¯å¦æ¢è¡Œ(wrapã€nowrap) justify-content æ§åˆ¶ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼(å±…ä¸­ã€å‡åˆ†) align-items æ§åˆ¶äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼ align-content æ§åˆ¶å¤šè¡Œå¼¹æ€§é¡¹çš„å¯¹é½æ–¹å¼ flex-directionï¼ˆä¸»è½´æ–¹å‘ï¼‰ å†³å®šä¸»è½´çš„æ–¹å‘ï¼Œé»˜è®¤å€¼æ˜¯ rowï¼ˆä»å·¦åˆ°å³ï¼‰ã€‚\n1 2 3 4 5 6 .container { flex-direction: row; /* ä»å·¦åˆ°å³ (é»˜è®¤) */ flex-direction: row-reverse; /* ä»å³åˆ°å·¦ */ flex-direction: column; /* ä»ä¸Šåˆ°ä¸‹ */ flex-direction: column-reverse; /* ä»ä¸‹åˆ°ä¸Š */ } flex-wrapï¼ˆæ˜¯å¦æ¢è¡Œï¼‰ 1 2 3 4 5 .container { flex-wrap: nowrap; /* é»˜è®¤å€¼ï¼Œä¸æ¢è¡Œ */ flex-wrap: wrap; /* æ¢è¡Œ */ flex-wrap: wrap-reverse; /* åå‘æ¢è¡Œ */ } justify-contentï¼ˆä¸»è½´å¯¹é½æ–¹å¼ï¼‰ 1 2 3 4 5 6 7 8 .container { justify-content: flex-start; /* é»˜è®¤ï¼Œå·¦å¯¹é½ */ justify-content: flex-end; /* å³å¯¹é½ */ justify-content: center; /* å±…ä¸­ */ justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ï¼Œä¸­é—´å¹³å‡åˆ†å¸ƒ */ justify-content: space-around; /* æ¯ä¸ªå…ƒç´ ä¸¤ä¾§é—´è·ç›¸ç­‰ */ justify-content: space-evenly; /* æ¯ä¸ªå…ƒç´ ä¹‹é—´é—´è·ç›¸ç­‰ */ } align-itemsï¼ˆäº¤å‰è½´å¯¹é½æ–¹å¼ï¼‰ 1 2 3 4 5 6 7 .container { align-items: flex-start; /* é¡¶éƒ¨å¯¹é½ */ align-items: flex-end; /* åº•éƒ¨å¯¹é½ */ align-items: center; /* å‚ç›´å±…ä¸­ */ align-items: baseline; /* æ–‡å­—åŸºçº¿å¯¹é½ */ align-items: stretch; /* é«˜åº¦è‡ªåŠ¨æ‹‰ä¼¸ï¼ˆé»˜è®¤ï¼‰ */ } align-contentï¼ˆå¤šè¡Œå¯¹é½æ–¹å¼ï¼‰ é€‚ç”¨äº flex-wrap: wrap çš„å¤šè¡Œæƒ…å†µ\n1 2 3 4 5 6 7 8 .container { align-content: flex-start; /* å¤šè¡Œä»é¡¶éƒ¨å¼€å§‹ */ align-content: flex-end; /* å¤šè¡Œä»åº•éƒ¨å¼€å§‹ */ align-content: center; /* å¤šè¡Œå±…ä¸­ */ align-content: space-between; /* ä¸¤ç«¯å¯¹é½ */ align-content: space-around; /* æ¯è¡Œä¸¤ä¾§é—´è·ç›¸ç­‰ */ align-content: stretch; /* è®©æ‰€æœ‰è¡Œå¡«å……æ•´ä¸ªå®¹å™¨ï¼ˆé»˜è®¤ï¼‰ */ } Flex å­é¡¹ï¼ˆå­å…ƒç´ ï¼‰å±æ€§ å±æ€§ ä½œç”¨ flex-grow æ§åˆ¶å…ƒç´ æ”¾å¤§æ¯”ä¾‹(é»˜è®¤ 0ï¼Œä¸æ”¾å¤§) flex-shrink æ§åˆ¶å…ƒç´ ç¼©å°æ¯”ä¾‹(é»˜è®¤ 1ï¼Œå…è®¸ç¼©å°) flex-basis è®¾å®šå…ƒç´ åˆå§‹å¤§å° flex flex-grow, flex-shrink, flex-basis çš„ç¼©å†™ align-self æ§åˆ¶å•ä¸ªå…ƒç´ åœ¨äº¤å‰è½´ä¸Šçš„å¯¹é½æ–¹å¼ flex-growï¼ˆæ”¾å¤§æ¯”ä¾‹ï¼‰ å†³å®šäº†å…ƒç´ åœ¨ æœ‰å‰©ä½™ç©ºé—´ æ—¶å¦‚ä½•åˆ†é…ï¼š\n1 2 3 4 5 .item { flex-grow: 0; /* ä¸æ”¾å¤§ï¼ˆé»˜è®¤å€¼ï¼‰ */ flex-grow: 1; /* å‡åˆ†å‰©ä½™ç©ºé—´ */ flex-grow: 2; /* è¯¥å…ƒç´ ä¼šå æ® 2 ä»½ç©ºé—´ */ } flex-shrinkï¼ˆç¼©å°æ¯”ä¾‹ï¼‰ å†³å®šäº†å…ƒç´ åœ¨ ç©ºé—´ä¸è¶³ æ—¶å¦‚ä½•ç¼©å°ï¼š\n1 2 3 4 .item { flex-shrink: 1; /* é»˜è®¤å€¼ï¼Œå…è®¸ç¼©å° */ flex-shrink: 0; /* ä¸å…è®¸ç¼©å° */ } flex-basisï¼ˆåˆå§‹å¤§å°ï¼‰ ç”¨äºè®¾å®šå…ƒç´ çš„åˆå§‹å¤§å°ï¼ˆç±»ä¼¼ widthï¼Œä½†å— flex-grow å½±å“ï¼‰ï¼š\n1 2 3 4 .item { flex-basis: auto; /* é»˜è®¤ï¼Œå–å†³äºå†…å®¹å¤§å° */ flex-basis: 100px; /* åˆå§‹å®½åº¦ 100px */ } flexï¼ˆç®€å†™å±æ€§ï¼‰ ç­‰ä»·äº flex-grow flex-shrink flex-basisï¼š\n1 2 3 4 5 .item { flex: 1; /* ç­‰ä»·äº flex: 1 1 0%; */ flex: 2; /* ç­‰ä»·äº flex: 2 1 0%; */ flex: 1 0 auto; /* å…è®¸æ”¾å¤§ï¼Œä¸ç¼©å°ï¼Œå¤§å°å–å†³äºå†…å®¹ */ } align-selfï¼ˆå•ä¸ªå­é¡¹çš„å¯¹é½æ–¹å¼ï¼‰ å•ç‹¬è°ƒæ•´æŸä¸ªå­é¡¹çš„ align-itemsï¼š\n1 2 3 4 5 6 .item { align-self: flex-start; /* é¡¶éƒ¨å¯¹é½ */ align-self: flex-end; /* åº•éƒ¨å¯¹é½ */ align-self: center; /* å±…ä¸­å¯¹é½ */ align-self: stretch; /* æ‹‰ä¼¸å¡«å…… */ } ","date":"2025-03-12T12:22:21+08:00","permalink":"https://www.cengdong.store/p/cssflex%E5%B8%83%E5%B1%80/","title":"ã€CSSã€‘Flexå¸ƒå±€"},{"content":"ä»‹ç» åœ¨ Python ä¸­ï¼Œä½œç”¨åŸŸï¼ˆScopeï¼‰ å’Œ å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ æ˜¯ç®¡ç†å˜é‡è®¿é—®å’Œå­˜å‚¨çš„æ ¸å¿ƒæ¦‚å¿µã€‚ç†è§£å®ƒä»¬å¯¹äºç¼–å†™é«˜æ•ˆã€å¯ç»´æŠ¤çš„ä»£ç éå¸¸é‡è¦ã€‚\nä½œç”¨åŸŸ ä½œç”¨åŸŸ æŒ‡çš„æ˜¯ å˜é‡çš„å¯è§èŒƒå›´ï¼Œå†³å®šäº†å˜é‡åœ¨ç¨‹åºä¸­çš„å“ªäº›éƒ¨åˆ†å¯ä»¥è¢«è®¿é—®ã€‚\nPython é‡‡ç”¨ LEGB è§„åˆ™ ç¡®å®šå˜é‡çš„ä½œç”¨åŸŸï¼š\nLï¼ˆLocalï¼Œå±€éƒ¨ä½œç”¨åŸŸï¼‰ï¼šå‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œä»…åœ¨å‡½æ•°å†…éƒ¨æœ‰æ•ˆã€‚ Eï¼ˆEnclosingï¼ŒåµŒå¥—ä½œç”¨åŸŸï¼‰ï¼šåµŒå¥—å‡½æ•°çš„å¤–å±‚å‡½æ•°ä½œç”¨åŸŸï¼ˆéå…¨å±€ï¼‰ã€‚ Gï¼ˆGlobalï¼Œå…¨å±€ä½œç”¨åŸŸï¼‰ï¼šå½“å‰ Python æ–‡ä»¶ï¼ˆæ¨¡å—ï¼‰å†…çš„å…¨å±€å˜é‡ã€‚ Bï¼ˆBuilt-inï¼Œå†…ç½®ä½œç”¨åŸŸï¼‰ï¼šPython å†…ç½®çš„å˜é‡ï¼Œæ¯”å¦‚ len()ã€print()ã€‚ LEGB è§„åˆ™çš„æœç´¢é¡ºåºï¼š\nLocalï¼ˆå±€éƒ¨ï¼‰ â†’ Enclosingï¼ˆåµŒå¥—ï¼‰ â†’ Globalï¼ˆå…¨å±€ï¼‰ â†’ Built-inï¼ˆå†…ç½®ï¼‰ ä¸€æ—¦æ‰¾åˆ°åŒ¹é…çš„å˜é‡ï¼Œå°±ä¸ä¼šç»§ç»­å‘ä¸Šæœç´¢ã€‚ ä½œç”¨åŸŸç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 def scope_test(): def do_local(): spam = \u0026#34;local spam\u0026#34; def do_nonlocal(): nonlocal spam spam = \u0026#34;nonlocal spam\u0026#34; def do_global(): global spam spam = \u0026#34;global spam\u0026#34; spam = \u0026#34;test spam\u0026#34; do_local() print(\u0026#34;After local assignment:\u0026#34;, spam) do_nonlocal() print(\u0026#34;After nonlocal assignment:\u0026#34;, spam) do_global() print(\u0026#34;After global assignment:\u0026#34;, spam) scope_test() print(\u0026#34;In global scope:\u0026#34;, spam) ä»£ç çš„è¾“å‡ºæ˜¯\n1 2 3 4 After local assignment: test spam After nonlocal assignment: nonlocal spam After global assignment: nonlocal spam In global scope: global spam å‘½åç©ºé—´ å‘½åç©ºé—´ æ˜¯å­˜å‚¨å˜é‡ï¼ˆåå­— â†’ å€¼ æ˜ å°„ï¼‰çš„åœ°æ–¹ï¼Œæ¯ä¸ªå˜é‡ååœ¨ Python é‡Œéƒ½ä¼šè¢«å­˜å‚¨åœ¨æŸä¸ªå‘½åç©ºé—´ä¸­ã€‚\nå±€éƒ¨å‘½åç©ºé—´ æ¯ä¸ªå‡½æ•°éƒ½ä¼šåˆ›å»ºè‡ªå·±çš„å±€éƒ¨å‘½åç©ºé—´ï¼Œå­˜å‚¨å±€éƒ¨å˜é‡ã€‚ å˜é‡åœ¨å‡½æ•°æ‰§è¡Œå®Œåä¼šè¢«é”€æ¯ã€‚ 1 2 3 4 def foo(): x = 10 # x åœ¨å±€éƒ¨å‘½åç©ºé—´ print(x) foo() å…¨å±€å‘½åç©ºé—´ å­˜å‚¨æ¨¡å—çº§å˜é‡ï¼Œå³å®šä¹‰åœ¨å‡½æ•°ä¹‹å¤–çš„å˜é‡ã€‚ åªè¦ Python è§£é‡Šå™¨è¿è¡Œï¼Œå˜é‡å°±å­˜åœ¨ã€‚ 1 2 3 4 y = 20 # y åœ¨å…¨å±€å‘½åç©ºé—´ def bar(): print(y) # è®¿é—®å…¨å±€å˜é‡ bar() å†…ç½®å‘½åç©ºé—´ ç”± Python è§£é‡Šå™¨é¢„å®šä¹‰çš„å†…ç½®å‡½æ•°å’Œå¯¹è±¡ï¼Œä¾‹å¦‚ print(), len(), list()ã€‚\n1 print(len([1, 2, 3])) # è®¿é—®å†…ç½®å‘½åç©ºé—´çš„ `len` å‘½åç©ºé—´ç”Ÿå‘½å‘¨æœŸ å‡½æ•°å†…éƒ¨èµ‹å€¼çš„å˜é‡ ä¼šè¢«è®¤ä¸ºæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šå½±å“å¤–éƒ¨å˜é‡ã€‚ è¦ä¿®æ”¹å…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚ è¦ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸå˜é‡ï¼Œéœ€è¦ä½¿ç”¨ nonlocal å…³é”®å­—ã€‚ global ä¸ nonlocal å…³é”®å­— åœ¨ Python ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼š\nå‡½æ•°å†…éƒ¨èµ‹å€¼çš„å˜é‡ ä¼šè¢«è®¤ä¸ºæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šå½±å“å¤–éƒ¨å˜é‡ã€‚ è¦ä¿®æ”¹å…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚ è¦ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸå˜é‡ï¼Œéœ€è¦ä½¿ç”¨ nonlocal å…³é”®å­—ã€‚ 1 2 3 4 5 6 7 8 x = 100 # å…¨å±€å˜é‡ def change_global(): global x # å£°æ˜ä½¿ç”¨å…¨å±€å˜é‡ x = 200 # ä¿®æ”¹å…¨å±€å˜é‡ change_global() print(x) # è¾“å‡º 200 ğŸ’¡ ä¸åŠ  globalï¼Œx åœ¨ change_global() å†…éƒ¨æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šå½±å“å¤–éƒ¨å˜é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 def outer(): x = 10 # å¤–éƒ¨ï¼ˆEnclosing ä½œç”¨åŸŸï¼‰ def inner(): nonlocal x # å£°æ˜ `x` æ¥è‡ªå¤–éƒ¨ä½œç”¨åŸŸ x = 20 # ä¿®æ”¹ `outer()` é‡Œçš„ `x` inner() print(x) # è¾“å‡º 20 outer() ğŸ’¡ ä¸åŠ  nonlocalï¼Œinner() é‡Œçš„ x åªæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ä¼šå½±å“ outer() é‡Œçš„ xã€‚\nä½œç”¨åŸŸä¸å‘½åç©ºé—´çš„å…³ç³» ä½œç”¨åŸŸæ˜¯å˜é‡çš„å¯è§èŒƒå›´ï¼Œè€Œå‘½åç©ºé—´æ˜¯å˜é‡çš„å­˜å‚¨ä½ç½®ã€‚ ä½œç”¨åŸŸå†³å®šäº† Python è§£é‡Šå™¨åœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å¦‚ä½•æŸ¥æ‰¾å˜é‡ã€‚ Python æŒ‰ç…§ LEGB è§„åˆ™ åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­æœç´¢å˜é‡ã€‚ locals() ä¸ globals() locals() å’Œ globals() æ˜¯ Python å†…ç½®çš„ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºè®¿é—® å±€éƒ¨å‘½åç©ºé—´ï¼ˆLocal Namespaceï¼‰ å’Œ å…¨å±€å‘½åç©ºé—´ï¼ˆGlobal Namespaceï¼‰ã€‚\næ³¨æ„ï¼šlocals()å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸè°ƒç”¨ï¼Œè¿”å›çš„å°±æ˜¯å…¨å±€å‘½åç©ºé—´çš„å­—å…¸\n","date":"2025-03-10T19:33:02+08:00","permalink":"https://www.cengdong.store/p/python%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/","title":"ã€Pythonã€‘ä½œç”¨åŸŸä¸å‘½åç©ºé—´"},{"content":"logging ä»‹ç» æ—¥å¿—æ˜¯å¯¹è½¯ä»¶æ‰§è¡Œæ—¶æ‰€å‘ç”Ÿäº‹ä»¶çš„ä¸€ç§è¿½è¸ªæ–¹å¼ã€‚è½¯ä»¶å¼€å‘äººå‘˜å¯¹ä»–ä»¬çš„ä»£ç æ·»åŠ æ—¥å¿—è°ƒç”¨ï¼Œå€Ÿæ­¤æ¥æŒ‡ç¤ºæŸäº‹ä»¶çš„å‘ç”Ÿã€‚\nä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ—¥å¿— ä½ å¯ä»¥é€šè¿‡æ‰§è¡Œ logger = getLogger(__name__) åˆ›å»ºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨ç„¶åè°ƒç”¨æ—¥å¿—è®°å½•å™¨çš„ debug(), info(), warning(), error() å’Œ critical() æ–¹æ³•æ¥ä½¿ç”¨æ—¥å¿—è®°å½•åŠŸèƒ½ã€‚ è¦ç¡®å®šä½•æ—¶ä½¿ç”¨æ—¥å¿—è®°å½•ï¼Œä»¥åŠç¡®å®šè¦ä½¿ç”¨å“ªä¸ªæ—¥å¿—è®°å½•å™¨æ–¹æ³•ï¼Œè¯·å‚é˜…ä¸‹è¡¨ã€‚ å®ƒé’ˆå¯¹ä¸€ç»„å¸¸è§ä»»åŠ¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½åˆ—å‡ºäº†æœ€é€‚åˆè¯¥ä»»åŠ¡çš„å·¥å…·ã€‚\nä½ æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡ æ­¤ä»»åŠ¡æœ€å¥½çš„å·¥å…· å¯¹äºå‘½ä»¤è¡Œæˆ–ç¨‹åºçš„åº”ç”¨ï¼Œç»“æœæ˜¾ç¤ºåœ¨æ§åˆ¶å°ã€‚ print() åœ¨å¯¹ç¨‹åºçš„æ™®é€šæ“ä½œå‘ç”Ÿæ—¶æäº¤äº‹ä»¶æŠ¥å‘Š(æ¯”å¦‚ï¼šçŠ¶æ€ç›‘æ§å’Œé”™è¯¯è°ƒæŸ¥) æ—¥å¿—è®°å½•å™¨çš„ info() (æˆ–è€…å¯¹äºè¯Šæ–­ç›®çš„éœ€è¦éå¸¸è¯¦ç»†çš„è¾“å‡ºæ—¶åˆ™ä½¿ç”¨ debug() æ–¹æ³•) æå‡ºä¸€ä¸ªè­¦å‘Šä¿¡æ¯åŸºäºä¸€ä¸ªç‰¹æ®Šçš„è¿è¡Œæ—¶äº‹ä»¶ warnings.warn() ä½äºä»£ç åº“ä¸­ï¼Œè¯¥äº‹ä»¶æ˜¯å¯ä»¥é¿å…çš„ï¼Œéœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯åº”ç”¨ä»¥æ¶ˆé™¤å‘Šè­¦ å¯¹äºå®¢æˆ·ç«¯åº”ç”¨æ— æ³•å¹²é¢„ï¼Œä½†äº‹ä»¶ä»ç„¶éœ€è¦è¢«å…³æ³¨çš„åœºåˆåˆ™ä½¿ç”¨æ—¥å¿—è®°å½•å™¨çš„ warning() æ–¹æ³• å¯¹ä¸€ä¸ªç‰¹æ®Šçš„è¿è¡Œæ—¶äº‹ä»¶æŠ¥å‘Šé”™è¯¯ å¼•å‘å¼‚å¸¸ æŠ¥å‘Šé”™è¯¯è€Œä¸å¼•å‘å¼‚å¸¸(å¦‚åœ¨é•¿æ—¶é—´è¿è¡Œä¸­çš„æœåŠ¡ç«¯è¿›ç¨‹çš„é”™è¯¯å¤„ç†) æ—¥å¿—è®°å½•å™¨çš„ error(), exception() æˆ– critical() æ–¹æ³•åˆ†åˆ«é€‚ç”¨äºç‰¹å®šçš„é”™è¯¯åŠåº”ç”¨é¢†åŸŸ æ—¥å¿—çš„çº§åˆ« çº§åˆ« ä½•æ—¶ä½¿ç”¨ DEBUG ç»†èŠ‚ä¿¡æ¯ï¼Œä»…å½“è¯Šæ–­é—®é¢˜æ—¶é€‚ç”¨ã€‚ INFO ç¡®è®¤ç¨‹åºæŒ‰é¢„æœŸè¿è¡Œã€‚ WARNING è¡¨æ˜æœ‰å·²ç»æˆ–å³å°†å‘ç”Ÿçš„æ„å¤–ï¼ˆä¾‹å¦‚ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼‰ã€‚ç¨‹åºä»æŒ‰é¢„æœŸè¿›è¡Œã€‚ ERROR ç”±äºä¸¥é‡çš„é—®é¢˜ï¼Œç¨‹åºçš„æŸäº›åŠŸèƒ½å·²ç»ä¸èƒ½æ­£å¸¸æ‰§è¡Œ CRITICAL ä¸¥é‡çš„é”™è¯¯ï¼Œè¡¨æ˜ç¨‹åºå·²ä¸èƒ½ç»§ç»­æ‰§è¡Œ ç¤ºä¾‹ åŸºç¡€ç”¨æ³• 1 2 3 import logging logging.warning(\u0026#39;Watch out!\u0026#39;) # å°†æ‰“å°ä¸€æ¡æ¶ˆæ¯åˆ°æ§åˆ¶å° logging.info(\u0026#39;I told you so\u0026#39;) # å°†ä¸æ‰“å°ä»»ä½•æ¶ˆæ¯ INFO æ¶ˆæ¯æ²¡æœ‰å‡ºç°æ˜¯å› ä¸ºé»˜è®¤çº§åˆ«ä¸º WARNING\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥ä½¿ç”¨ logging æ¨¡å—çš„å‡½æ•°ï¼Œæ¯”å¦‚ logging.debugï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨å¹¶è°ƒç”¨å…¶æ–¹æ³•ã€‚ è¿™äº›å‡½æ•°æ˜¯åœ¨æ ¹æ—¥å¿—è®°å½•å™¨ä¸Šæ“ä½œçš„ï¼Œä½†å®ƒä»¬åœ¨æœªè¢«è°ƒç”¨æ—¶å°†ä¼šè°ƒç”¨ basicConfig()æ¥å‘æŒ¥ä½œç”¨ï¼Œå°±åƒåœ¨è¿™ä¸ªä¾‹å­ä¸­é‚£æ ·ã€‚ ç„¶è€Œåœ¨æ›´å¤§çš„ç¨‹åºä¸­ä½ é€šå¸¸ä¼šéœ€è¦æ˜¾å¼åœ°æ§åˆ¶æ—¥å¿—è®°å½•çš„é…ç½® â€”â€” æ‰€ä»¥å‡ºäºè¿™æ ·é‚£æ ·çš„ç†ç”±ï¼Œæœ€å¥½è¿˜æ˜¯åˆ›å»ºæ—¥å¿—è®°å½•å™¨å¹¶è°ƒç”¨å…¶æ–¹æ³•\nè®°å½•æ—¥å¿—åˆ°æ–‡ä»¶ 1 2 3 4 5 6 7 import logging logger = logging.getLogger(__name__) logging.basicConfig(filename=\u0026#39;example.log\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;, level=logging.DEBUG) logger.debug(\u0026#39;This message should go to the log file\u0026#39;) logger.info(\u0026#39;So should this\u0026#39;) logger.warning(\u0026#39;And this, too\u0026#39;) logger.error(\u0026#39;And non-ASCII stuff, too, like Ã˜resund and MalmÃ¶\u0026#39;) ä¸Šé¢çš„ç¤ºä¾‹å°†æ—¥å¿—äº‹ä»¶è®°å½•åˆ°æ–‡ä»¶ä¸­å¹¶è®¾ç½®äº†æ—¥å¿—ç­‰çº§\næ˜¾ç¤ºæ¶ˆæ¯çš„æ ¼å¼ 1 2 3 4 5 import logging logging.basicConfig(format=\u0026#39;%(levelname)s:%(message)s\u0026#39;, level=logging.DEBUG) logging.debug(\u0026#39;This message should appear on the console\u0026#39;) logging.info(\u0026#39;So should this\u0026#39;) logging.warning(\u0026#39;And this, too\u0026#39;) åœ¨æ¶ˆæ¯ä¸­æ˜¾ç¤ºæ—¥æœŸ/æ—¶é—´\n1 2 3 import logging logging.basicConfig(format=\u0026#39;%(asctime)s %(message)s\u0026#39;) logging.warning(\u0026#39;is when this event was logged.\u0026#39;) è¿›é˜¶æ—¥å¿—æ•™ç¨‹ æ—¥å¿—åº“é‡‡ç”¨æ¨¡å—åŒ–æ–¹æ³•ï¼Œå¹¶æä¾›å‡ ç±»ç»„ä»¶ï¼šè®°å½•å™¨ã€å¤„ç†å™¨ã€è¿‡æ»¤å™¨å’Œæ ¼å¼å™¨ã€‚\nè®°å½•å™¨æš´éœ²äº†åº”ç”¨ç¨‹åºä»£ç ç›´æ¥ä½¿ç”¨çš„æ¥å£ã€‚ å¤„ç†å™¨å°†æ—¥å¿—è®°å½•ï¼ˆç”±è®°å½•å™¨åˆ›å»ºï¼‰å‘é€åˆ°é€‚å½“çš„ç›®æ ‡ã€‚ è¿‡æ»¤å™¨æä¾›äº†æ›´ç»†ç²’åº¦çš„åŠŸèƒ½ï¼Œç”¨äºç¡®å®šè¦è¾“å‡ºçš„æ—¥å¿—è®°å½•ã€‚ æ ¼å¼å™¨æŒ‡å®šæœ€ç»ˆè¾“å‡ºä¸­æ—¥å¿—è®°å½•çš„æ ·å¼ã€‚ æœ€ä½³å®è·µ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 import logging import os # æ—¥å¿—æ–‡ä»¶è·¯å¾„ LOG_DIR = \u0026#34;logs\u0026#34; os.makedirs(LOG_DIR, exist_ok=True) # ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨ LOG_FILE = os.path.join(LOG_DIR, \u0026#34;app.log\u0026#34;) # åˆ›å»ºæ—¥å¿—å™¨ï¼ˆå…¨å±€ä½¿ç”¨ï¼‰ logger = logging.getLogger(\u0026#34;my_app\u0026#34;) logger.setLevel(logging.DEBUG) # è®¾ç½®æœ€ä½æ—¥å¿—çº§åˆ« # åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼ˆç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼‰ formatter = logging.Formatter( \u0026#34;%(asctime)s - %(name)s - %(levelname)s - %(message)s\u0026#34; ) # åˆ›å»ºæ§åˆ¶å° Handler console_handler = logging.StreamHandler() console_handler.setLevel(logging.INFO) # ä»…è¾“å‡º INFO åŠä»¥ä¸Šçš„æ—¥å¿— console_handler.setFormatter(formatter) # åˆ›å»ºæ–‡ä»¶ Handler file_handler = logging.FileHandler(LOG_FILE, encoding=\u0026#34;utf-8\u0026#34;) file_handler.setLevel(logging.DEBUG) # è®°å½•æ‰€æœ‰çº§åˆ«çš„æ—¥å¿— file_handler.setFormatter(formatter) # ç»‘å®š Handlerï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰ if not logger.handlers: logger.addHandler(console_handler) logger.addHandler(file_handler) # æµ‹è¯•æ—¥å¿— logger.debug(\u0026#34;è¿™æ˜¯ä¸€æ¡ DEBUG æ—¥å¿—\u0026#34;) logger.info(\u0026#34;è¿™æ˜¯ä¸€æ¡ INFO æ—¥å¿—\u0026#34;) logger.warning(\u0026#34;è¿™æ˜¯ä¸€æ¡ WARNING æ—¥å¿—\u0026#34;) logger.error(\u0026#34;è¿™æ˜¯ä¸€æ¡ ERROR æ—¥å¿—\u0026#34;) logger.critical(\u0026#34;è¿™æ˜¯ä¸€æ¡ CRITICAL æ—¥å¿—\u0026#34;) ","date":"2025-03-08T19:13:43+08:00","permalink":"https://www.cengdong.store/p/pythonlogging%E6%A8%A1%E5%9D%97/","title":"ã€Pythonã€‘loggingæ¨¡å—"},{"content":"ä»‹ç» è¿™ä¸ªæ¨¡å—å®ç°äº†ä¸€äº›ä¸“é—¨åŒ–çš„å®¹å™¨ï¼Œæä¾›äº†å¯¹ Python çš„é€šç”¨å†…å»ºå®¹å™¨ dictã€listã€set å’Œ tuple çš„è¡¥å……ã€‚\nç±» ä½œç”¨ namedtuple() ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨æ¥åˆ›å»ºå…ƒç»„çš„å­ç±»ï¼Œå­ç±»çš„å­—æ®µæ˜¯æœ‰åç§°çš„ã€‚ deque ç±»ä¼¼åˆ—è¡¨çš„å®¹å™¨ï¼Œä½† append å’Œ pop åœ¨å…¶ä¸¤ç«¯çš„é€Ÿåº¦éƒ½å¾ˆå¿«ã€‚ ChainMap ç±»ä¼¼å­—å…¸çš„ç±»ï¼Œç”¨äºåˆ›å»ºåŒ…å«å¤šä¸ªæ˜ å°„çš„å•ä¸ªè§†å›¾ã€‚ Counter ç”¨äºè®¡æ•° hashable å¯¹è±¡çš„å­—å…¸å­ç±» OrderedDict å­—å…¸çš„å­ç±»ï¼Œèƒ½è®°ä½æ¡ç›®è¢«æ·»åŠ è¿›å»çš„é¡ºåºã€‚ defaultdict å­—å…¸çš„å­ç±»ï¼Œé€šè¿‡è°ƒç”¨ç”¨æˆ·æŒ‡å®šçš„å·¥å‚å‡½æ•°ï¼Œä¸ºé”®æä¾›é»˜è®¤å€¼ã€‚ UserDict å°è£…äº†å­—å…¸å¯¹è±¡ï¼Œç®€åŒ–äº†å­—å…¸å­ç±»åŒ– UserList å°è£…äº†åˆ—è¡¨å¯¹è±¡ï¼Œç®€åŒ–äº†åˆ—è¡¨å­ç±»åŒ– UserString å°è£…äº†å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç®€åŒ–äº†å­—ç¬¦ä¸²å­ç±»åŒ– ChainMap ChainMap ç±»å°†å¤šä¸ªæ˜ å°„è¿…é€Ÿåœ°é“¾åˆ°ä¸€èµ·ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥ä½œä¸ºä¸€ä¸ªå•å…ƒå¤„ç†ã€‚è¿™é€šå¸¸æ¯”åˆ›å»ºä¸€ä¸ªæ–°å­—å…¸å†é‡å¤åœ°ä½¿ç”¨ update() è¦å¿«å¾—å¤šã€‚\nclass collections.ChainMap(*maps)\nåŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 from collections import ChainMap dict1 = {\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 2} dict2 = {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4} cm = ChainMap(dict1, dict2) print(cm) # ChainMap({\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 2}, {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4}) ChainMap çš„é”®å€¼æŸ¥æ‰¾è§„åˆ™ 1 2 3 print(cm[\u0026#39;a\u0026#39;]) # 1 ï¼ˆæ¥è‡ª dict1ï¼‰ print(cm[\u0026#39;b\u0026#39;]) # 2 ï¼ˆdict1 è¦†ç›–äº† dict2 çš„ \u0026#39;b\u0026#39;ï¼‰ print(cm[\u0026#39;c\u0026#39;]) # 4 ï¼ˆæ¥è‡ª dict2ï¼‰ ChainMap æŒ‰ç…§ ä»å·¦åˆ°å³ï¼ˆå³ ä»ç¬¬ä¸€ä¸ªå­—å…¸åˆ°æœ€åä¸€ä¸ªå­—å…¸ï¼‰çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ã€‚ b åœ¨ dict1 å’Œ dict2 éƒ½å­˜åœ¨ï¼Œä½† dict1 é‡Œçš„å€¼ ä¼˜å…ˆçº§æ›´é«˜ã€‚ å¦‚æœæŸ¥æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„é”®ï¼Œä¼šæŠ¥ KeyErrorï¼š\n1 print(cm[\u0026#39;d\u0026#39;]) # KeyError: \u0026#39;d\u0026#39; ChainMap çš„ä¿®æ”¹è§„åˆ™ ä¿®æ”¹ ChainMap åªä¼šå½±å“ç¬¬ä¸€ä¸ªå­—å…¸\n1 2 3 cm[\u0026#39;b\u0026#39;] = 99 print(dict1) # {\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 99} print(dict2) # {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4} ç›´æ¥ä¿®æ”¹ cm[\u0026lsquo;b\u0026rsquo;] åªä¼šå½±å“ dict1ï¼Œä¸ä¼šå½±å“ dict2ã€‚ ChainMap åªå…è®¸ä¿®æ”¹ ç¬¬ä¸€ä¸ªå­—å…¸ä¸­çš„å€¼ã€‚ æ–°å¢é”®å€¼å¯¹ä¹Ÿä¼šåŠ åˆ°ç¬¬ä¸€ä¸ªå­—å…¸ä¸­ ChainMap çš„åŠ¨æ€ç‰¹æ€§ ChainMap åŠ¨æ€åæ˜ åº•å±‚å­—å…¸çš„å˜åŒ–ï¼š\n1 2 dict1[\u0026#39;a\u0026#39;] = 42 print(cm[\u0026#39;a\u0026#39;]) # 42 ï¼ˆdict1 æ”¹å˜åï¼ŒChainMap ä¹Ÿä¼šæ›´æ–°ï¼‰ ChainMap çš„æ–¹æ³• maps - è®¿é—®æ‰€æœ‰å­—å…¸ 1 print(cm.maps) # [{\u0026#39;a\u0026#39;: 42, \u0026#39;b\u0026#39;: 99, \u0026#39;d\u0026#39;: 100}, {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4}] new_child() - åˆ›å»ºæ–°çš„ ChainMap 1 2 cm2 = cm.new_child({\u0026#39;e\u0026#39;: 5}) print(cm2) # ChainMap({\u0026#39;e\u0026#39;: 5}, {\u0026#39;a\u0026#39;: 42, \u0026#39;b\u0026#39;: 99, \u0026#39;d\u0026#39;: 100}, {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4}) è¿™æ · cm2 é‡Œ e åªä¼šå½±å“æœ€å‰é¢çš„æ–°å­—å…¸ï¼Œcm ä¸å—å½±å“ã€‚ è¿™åœ¨ä½œç”¨åŸŸç®¡ç†ä¸­å¾ˆæœ‰ç”¨ï¼ˆæ¯”å¦‚ Python è§£é‡Šå™¨çš„å˜é‡æŸ¥æ‰¾ï¼‰ã€‚ ChainMap çš„åº”ç”¨åœºæ™¯ é…ç½®ç®¡ç† åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ é»˜è®¤é…ç½®ï¼Œä½†ä¹Ÿå…è®¸ç”¨æˆ·æä¾› è‡ªå®šä¹‰é…ç½®ï¼š\n1 2 3 4 5 6 7 default_config = {\u0026#39;theme\u0026#39;: \u0026#39;light\u0026#39;, \u0026#39;font\u0026#39;: \u0026#39;Arial\u0026#39;, \u0026#39;timeout\u0026#39;: 30} user_config = {\u0026#39;theme\u0026#39;: \u0026#39;dark\u0026#39;, \u0026#39;timeout\u0026#39;: 60} config = ChainMap(user_config, default_config) print(config[\u0026#39;theme\u0026#39;]) # dark ï¼ˆç”¨æˆ·é…ç½®è¦†ç›–é»˜è®¤é…ç½®ï¼‰ print(config[\u0026#39;font\u0026#39;]) # Arial ï¼ˆç”¨æˆ·æœªæä¾›ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼‰ è¿™æ ·å°±èƒ½ ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·é…ç½®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨é»˜è®¤å€¼ã€‚\nå˜é‡ä½œç”¨åŸŸ Python è§£é‡Šå™¨åœ¨æŸ¥æ‰¾å˜é‡æ—¶ï¼Œä¼šæŒ‰ å±€éƒ¨ -\u0026gt; å…¨å±€ -\u0026gt; å†…ç½® çš„é¡ºåºè¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¸ ChainMap ç±»ä¼¼ï¼š\n1 2 3 4 5 6 7 global_scope = {\u0026#39;x\u0026#39;: 10, \u0026#39;y\u0026#39;: 20} local_scope = {\u0026#39;y\u0026#39;: 5, \u0026#39;z\u0026#39;: 30} env = ChainMap(local_scope, global_scope) print(env[\u0026#39;x\u0026#39;]) # 10 ï¼ˆæ¥è‡ªå…¨å±€ä½œç”¨åŸŸï¼‰ print(env[\u0026#39;y\u0026#39;]) # 5 ï¼ˆå±€éƒ¨ä½œç”¨åŸŸä¼˜å…ˆï¼‰ print(env[\u0026#39;z\u0026#39;]) # 30 ï¼ˆæ¥è‡ªå±€éƒ¨ä½œç”¨åŸŸï¼‰ å‘½ä»¤è¡Œå‚æ•°è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 import argparse # å®šä¹‰å‘½ä»¤è¡Œå‚æ•° parser = argparse.ArgumentParser() parser.add_argument(\u0026#39;--timeout\u0026#39;, type=int) parser.add_argument(\u0026#39;--theme\u0026#39;, type=str) args = parser.parse_args([]) # æ¨¡æ‹Ÿä¸ä¼ é€’å‚æ•° cli_args = {k: v for k, v in vars(args).items() if v is not None} # é»˜è®¤é…ç½® default_settings = {\u0026#39;theme\u0026#39;: \u0026#39;light\u0026#39;, \u0026#39;timeout\u0026#39;: 30} config = ChainMap(cli_args, default_settings) print(config[\u0026#39;theme\u0026#39;]) # light print(config[\u0026#39;timeout\u0026#39;]) # 30 defaultdict defaultdict æ˜¯ Python collections æ¨¡å—ä¸­çš„ä¸€ä¸ªå­—å…¸å­ç±»ï¼Œå®ƒå’Œæ™®é€šçš„ dict å¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ï¼šå½“è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶ï¼Œdefaultdict ä¸ä¼šæŠ¥ KeyErrorï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™ä¸ªé»˜è®¤å€¼ç”±ä¸€ä¸ªå·¥å‚å‡½æ•°æä¾›ã€‚\ndefaultdict åŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 from collections import defaultdict # åˆ›å»ºä¸€ä¸ªé»˜è®¤å€¼ä¸º list çš„ defaultdict d = defaultdict(list) # è®¿é—®ä¸å­˜åœ¨çš„é”®ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç©ºåˆ—è¡¨ print(d[\u0026#34;key\u0026#34;]) # è¾“å‡ºï¼š[] å¯¹æ¯”æ™®é€šå­—å…¸ï¼š\n1 2 d = {} print(d[\u0026#34;key\u0026#34;]) # âŒ KeyError defaultdict çš„å‚æ•° 1 defaultdict(default_factory[, ...]) default_factoryï¼šç”¨äºç”Ÿæˆé»˜è®¤å€¼çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚ listã€intã€setã€lambda ç­‰ï¼‰ã€‚ å…¶ä»–å‚æ•°å’Œ dict ä¸€æ ·ã€‚ å¸¸è§é»˜è®¤å·¥å‚ é»˜è®¤å€¼ä¸º intï¼ˆé€‚ç”¨äºè®¡æ•°å™¨ï¼‰ 1 2 3 4 5 6 d = defaultdict(int) d[\u0026#34;apple\u0026#34;] += 1 d[\u0026#34;banana\u0026#34;] += 1 print(d) # {\u0026#39;apple\u0026#39;: 1, \u0026#39;banana\u0026#39;: 1} é»˜è®¤å€¼ä¸º listï¼ˆé€‚ç”¨äºåˆ†ç»„ï¼‰ 1 2 3 4 5 6 7 8 d = defaultdict(list) d[\u0026#34;fruits\u0026#34;].append(\u0026#34;apple\u0026#34;) d[\u0026#34;fruits\u0026#34;].append(\u0026#34;banana\u0026#34;) d[\u0026#34;vegetables\u0026#34;].append(\u0026#34;carrot\u0026#34;) print(d) # {\u0026#39;fruits\u0026#39;: [\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;], \u0026#39;vegetables\u0026#39;: [\u0026#39;carrot\u0026#39;]} é»˜è®¤å€¼ä¸º setï¼ˆå»é‡åˆ†ç»„ï¼‰ 1 2 3 4 5 6 7 8 d = defaultdict(set) d[\u0026#34;fruits\u0026#34;].add(\u0026#34;apple\u0026#34;) d[\u0026#34;fruits\u0026#34;].add(\u0026#34;banana\u0026#34;) d[\u0026#34;fruits\u0026#34;].add(\u0026#34;apple\u0026#34;) # é‡å¤æ·»åŠ ï¼Œä¸ä¼šé‡å¤å­˜å‚¨ print(d) # {\u0026#39;fruits\u0026#39;: {\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;}} OrderedDict OrderedDict æ˜¯ collections æ¨¡å—ä¸­çš„æœ‰åºå­—å…¸ï¼Œå®ƒç»§æ‰¿è‡ª dictï¼Œä½†èƒ½å¤Ÿä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼ˆåœ¨ Python 3.7+ çš„ dict ä¹Ÿé»˜è®¤ä¿æŒé¡ºåºï¼Œä½† OrderedDict ä»æœ‰ä¸€äº›é¢å¤–åŠŸèƒ½ï¼‰\nåˆ›å»º OrderedDict 1 2 3 4 5 6 7 8 9 from collections import OrderedDict # æ™®é€š dictï¼ˆPython 3.7+ é»˜è®¤ä¿æŒé¡ºåºï¼‰ d1 = {\u0026#34;a\u0026#34;: 1, \u0026#34;b\u0026#34;: 2, \u0026#34;c\u0026#34;: 3} print(d1) # {\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 2, \u0026#39;c\u0026#39;: 3} # OrderedDictï¼ˆæ˜¾å¼ä½¿ç”¨ï¼‰ d2 = OrderedDict([(\u0026#34;a\u0026#34;, 1), (\u0026#34;b\u0026#34;, 2), (\u0026#34;c\u0026#34;, 3)]) print(d2) # OrderedDict([(\u0026#39;a\u0026#39;, 1), (\u0026#39;b\u0026#39;, 2), (\u0026#39;c\u0026#39;, 3)]) ç‰¹ç‚¹ï¼š\nPython 3.6 åŠä»¥ä¸‹ï¼šæ™®é€š dict ä¸ä¼š ç»´æŒæ’å…¥é¡ºåºï¼ŒOrderedDict å¯ä»¥ã€‚ Python 3.7+ï¼šæ™®é€š dict é»˜è®¤ ç»´æŒé¡ºåºï¼Œä½† OrderedDict ä»ç„¶æä¾›é¢å¤–æ–¹æ³•ã€‚ OrderedDict å…³é”®ç‰¹æ€§ æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£ 1 2 3 4 5 6 7 8 9 10 11 12 d = OrderedDict() d[\u0026#34;x\u0026#34;] = 10 d[\u0026#34;y\u0026#34;] = 20 d[\u0026#34;z\u0026#34;] = 30 for k, v in d.items(): print(k, v) # è¾“å‡ºï¼š # x 10 # y 20 # z 30 âœ… é¡ºåºä¿æŒä¸å˜ æ”¯æŒ move_to_end è°ƒæ•´é¡ºåº move_to_end(key, last=True) å¯ä»¥ç§»åŠ¨æŒ‡å®šé”®åˆ°æœ«å°¾æˆ–å¼€å¤´ï¼š\n1 2 3 4 5 6 7 d = OrderedDict([(\u0026#34;a\u0026#34;, 1), (\u0026#34;b\u0026#34;, 2), (\u0026#34;c\u0026#34;, 3)]) d.move_to_end(\u0026#34;a\u0026#34;) # æŠŠ \u0026#39;a\u0026#39; ç§»åˆ°æœ«å°¾ print(d) # OrderedDict([(\u0026#39;b\u0026#39;, 2), (\u0026#39;c\u0026#39;, 3), (\u0026#39;a\u0026#39;, 1)]) d.move_to_end(\u0026#34;c\u0026#34;, last=False) # æŠŠ \u0026#39;c\u0026#39; ç§»åˆ°å¼€å¤´ print(d) # OrderedDict([(\u0026#39;c\u0026#39;, 3), (\u0026#39;b\u0026#39;, 2), (\u0026#39;a\u0026#39;, 1)]) æ”¯æŒ popitem()å–å‡º(FIFO/LIFO) popitem(last=True):\nlast=Trueï¼ˆé»˜è®¤ï¼‰â¡ åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ last=False â¡ å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ 1 2 3 4 5 d = OrderedDict([(\u0026#34;a\u0026#34;, 1), (\u0026#34;b\u0026#34;, 2), (\u0026#34;c\u0026#34;, 3)]) print(d.popitem()) # (\u0026#39;c\u0026#39;, 3) âœ… é»˜è®¤ LIFO print(d.popitem(last=False)) # (\u0026#39;a\u0026#39;, 1) âœ… FIFO print(d) # OrderedDict([(\u0026#39;b\u0026#39;, 2)]) OrderedDict åº”ç”¨åœºæ™¯ ç”±äº OrderedDict ç»´æŠ¤é¡ºåºï¼Œå®ƒå¯ä»¥å®ç° LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç¼“å­˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class LRUCache: def __init__(self, capacity: int): self.cache = OrderedDict() self.capacity = capacity def get(self, key): if key not in self.cache: return -1 self.cache.move_to_end(key) # æœ€è¿‘è®¿é—®çš„ç§»åŠ¨åˆ°æœ«å°¾ return self.cache[key] def put(self, key, value): if key in self.cache: self.cache.move_to_end(key) self.cache[key] = value if len(self.cache) \u0026gt; self.capacity: self.cache.popitem(last=False) # ç§»é™¤æœ€æ—©æ’å…¥çš„å…ƒç´ ï¼ˆFIFOï¼‰ # ç¤ºä¾‹ cache = LRUCache(2) cache.put(1, \u0026#34;A\u0026#34;) cache.put(2, \u0026#34;B\u0026#34;) print(cache.cache) # OrderedDict([(1, \u0026#39;A\u0026#39;), (2, \u0026#39;B\u0026#39;)]) cache.get(1) # è®¿é—® 1ï¼Œä½¿å…¶å˜æˆæœ€è¿‘ä½¿ç”¨ cache.put(3, \u0026#34;C\u0026#34;) # æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„ 2 print(cache.cache) # OrderedDict([(1, \u0026#39;A\u0026#39;), (3, \u0026#39;C\u0026#39;)]) ","date":"2025-03-07T16:45:07+08:00","permalink":"https://www.cengdong.store/p/pythoncollections%E6%A8%A1%E5%9D%97/","title":"ã€Pythonã€‘collectionsæ¨¡å—"},{"content":"React å¼€å‘ç¯å¢ƒæ­å»º å®‰è£… nodejsï¼šå®˜ç½‘ä¸‹è½½æœ€è¿‘ LTS ç‰ˆæœ¬ å®‰è£…é›†æˆå¼€å‘ç¯å¢ƒï¼švscode åˆ›å»º react é¡¹ç›®ï¼š npx create-react-app project-name npm create vite@latest React æ ¸å¿ƒè¯­æ³•ï¼šJSX JSXæ˜¯ Javascript å’Œ Html çš„ç¼©å†™ï¼Œè¡¨ç¤ºåœ¨jsä»£ç ä¸­ç¼–å†™htmlæ¨¡ç‰ˆ\nJSXä¸èƒ½ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œéœ€è¦bableè¿›è¡Œç¼–ç æˆçº¯ js ä»£ç \nJSX åŸºç¡€ JSX è¯†åˆ« js è¡¨è¾¾å¼ JSX é€šè¿‡{}è¯­æ³•å¯ä»¥è¯†åˆ« js è¡¨è¾¾å¼\nå¯è¿è¡Œä»¥ä¸‹ js è¡¨è¾¾å¼ï¼š\nå­—ç¬¦ä¸²ï¼š{\u0026ldquo;hello world\u0026rdquo;}(æ”¯æŒæ¨¡ç‰ˆå­—ç¬¦ä¸²) å˜é‡/js è¯­å¥(è¿ç®—ç¬¦) å‡½æ•°è°ƒç”¨ æ–¹æ³•è°ƒç”¨ åˆ—è¡¨æ¸²æŸ“ 1 2 3 4 5 6 7 8 function List() { const list = [\u0026#39;python\u0026#39;, \u0026#39;java\u0026#39;] return ( \u0026lt;ul\u0026gt; list.map(item =\u0026gt; \u0026lt;li key={item.id}\u0026gt;{item}\u0026lt;/li\u0026gt;) \u0026lt;/ul\u0026gt; ) } ç®€å•æ¡ä»¶æ¸²æŸ“ å¯¹äºç®€å•çš„æ¡ä»¶æ¸²æŸ“ï¼Œå¯é€šè¿‡é€»è¾‘ä¸è¿ç®—ç¬¦æˆ–è€…ä¸‰ç›®è¿ç®—ç¬¦å®ç°\n1 2 3 4 5 6 7 8 9 const isLogin = true function UserInfo({ username }) { return ( \u0026lt;\u0026gt; isLogin ? \u0026lt;p\u0026gt;username: {username}\u0026lt;/p\u0026gt; : \u0026lt;p\u0026gt;è¯·ç™»å½•\u0026lt;/p\u0026gt; \u0026lt;/\u0026gt; ) } å¤æ‚æ¡ä»¶æ¸²æŸ“ å¤æ‚çš„æ¡ä»¶æ¸²æŸ“é€šè¿‡å‡½æ•°å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 const type = 0 function showTypedTemplate() { if (type === 0) { return \u0026lt;div\u0026gt;æˆ‘æ˜¯type0\u0026lt;/div\u0026gt; } if (type === 1) { return \u0026lt;div\u0026gt;æˆ‘æ˜¯type1\u0026lt;/div\u0026gt; } if (type === 2) { return \u0026lt;div\u0026gt;æˆ‘æ˜¯type2\u0026lt;/div\u0026gt; } } func Article() { return showTypedTemplate() } React äº‹ä»¶ç»‘å®š è¯­æ³• on + äº‹ä»¶åç§° = {äº‹ä»¶å¤„ç†å‡½æ•°}\nä½¿ç”¨äº‹ä»¶å¯¹è±¡ åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨å½¢å‚e\n1 2 3 4 5 6 7 8 9 10 11 12 13 function App() { const handlerFunc = (e) =\u0026gt; { console.log(e) } return ( \u0026lt;div\u0026gt; \u0026lt;button onClick={handlerFunc}\u0026gt;click me\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } export default App ä¼ é€’å‚æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 function App() { const handlerFunc = (e, name) =\u0026gt; { console.log(e, name) } return ( \u0026lt;div\u0026gt; \u0026lt;button onClick={(e) =\u0026gt; { handlerFunc(\u0026#39;cengdong\u0026#39;) }} \u0026gt; click me \u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; ) } export default App React ç»„ä»¶çŠ¶æ€ç®¡ç† ç»™ React ç»„ä»¶æ·»åŠ ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œè®©ç»„ä»¶åœ¨ä¸åŒçŠ¶æ€ä¸‹æœ‰ä¸åŒè¡¨ç°\nuseState åŸºæœ¬ä½¿ç”¨ é€šè¿‡ useState hook å‡½æ•°ç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨å˜é‡\n1 2 3 4 5 6 7 8 9 fucntion App() { const [state, setState] = useState(0) const clickHandle = () =\u0026gt; { setState(count + 1) } return \u0026lt;button onClick={clickHandle}\u0026gt;{state}\u0026lt;/button\u0026gt; } useState æ³¨æ„äº‹é¡¹ çŠ¶æ€å˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œåªèƒ½é€šè¿‡setXXXå‡½æ•°ï¼Œå¹¶ä¸”ä¼ å…¥æ–°çš„å€¼æ¥æ”¹å˜çŠ¶æ€\nç›´æ¥ä¿®æ”¹çŠ¶æ€ä¸èƒ½å¼•å‘è§†å›¾æ›´æ–°\nuseState æ¡ˆä¾‹ tabl æ åˆ‡æ¢ é€šè¿‡ useSate(type)è®°å½• type çŠ¶æ€ é€šè¿‡äº‹ä»¶å›è°ƒå‡½æ•°è°ƒç”¨çŠ¶æ€ä¿®æ”¹å‡½æ•°ï¼Œä¼ é€’è¢«ç‚¹å‡»é¡¹çš„ type å€¼ä¸ºå‚æ•° é€šè¿‡ classnames æ’ä»¶ä¼˜é›…å®ç°ç±»ååˆ‡æ¢ è¡¨å•å—æ§ç»‘å®š é€šè¿‡è¡¨å•valueå±æ€§ç»‘å®šçŠ¶æ€ï¼Œé€šè¿‡onChangeäº‹ä»¶å±æ€§ç»‘å®šçŠ¶æ€åŒæ­¥çš„å‡½æ•°\n1 2 3 4 5 6 7 function App() { const [content, setContent] = useState(\u0026#34;\u0026#34;) const clickHandle = () =\u0026gt; { setContent(\u0026#34;\u0026#34;) } return \u0026lt;input type=text value={content} onChange={(e) =\u0026gt; setContent(e.target.value)}/\u0026gt; } React è·å– Dom å…ƒç´  é€šè¿‡ useRef hook è·å– dom å…ƒç´ ä»è€Œè°ƒç”¨ dom å…ƒç´ çš„æ–¹æ³•\nuseRef åŸºæœ¬ç”¨æ³• 1 2 3 4 5 6 7 8 function App() { const inputRef = useRef(null) const publishHandle = () =\u0026gt; { inputRef.current.focus() } return \u0026lt;input ref={inoutRef} onClick={publichHandle} /\u0026gt; } æ³¨æ„äº‹é¡¹ æ¸²æŸ“å®Œæ¯•ä¹‹åï¼Œdom æ‰å¯ç”¨\nuseRef ä½¿ç”¨åœºæ™¯ è·å– Dom å…ƒç´ ï¼Œè°ƒç”¨ Dom å…ƒç´ çš„å±æ€§æˆ–è€…æ–¹æ³• å¼•ç”¨ä¸€ä¸ªä¸éœ€è¦è¢«æ¸²æŸ“çš„å€¼ ref ä¸ä»…å¯ä»¥å¼•ç”¨å•ä¸ª dom å…ƒç´ ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨ä¸€ä¸ªåˆ—è¡¨ çˆ¶ç»„ä»¶è¦è·å–å­ç»„ä»¶ Dom éœ€è¦ forwardRef å‡½æ•°åšå¤„ç†ï¼Œå› ä¸º React æ¡†æ¶ä¸å…è®¸ ç»„ä»¶é—´é€šä¿¡ çˆ¶ä¼ å­ å®ç°æ­¥éª¤ï¼š\nçˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ï¼šåœ¨å­ç»„ä»¶æ ‡ç­¾ä¸Šç»‘å®šå±æ€§ å­ç»„ä»¶æ¥æ”¶æ•°æ®ï¼šå­ç»„ä»¶é€šè¿‡propså‚æ•°æ¥å—æ•°æ® props è¯´æ˜ props å¯¹è±¡åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„æ‰€æœ‰æ•°æ® props å¯¹è±¡èƒ½ä¼ é€’ä»»æ„ç±»å‹çš„æ•°æ® props å¯¹è±¡æ˜¯åªè¯»å¯¹è±¡ children è¯´æ˜ åœ¨å­ç»„ä»¶å†…éƒ¨è¿˜å¯ä»¥åµŒå¥—å†…å®¹ï¼ŒåŒæ ·ä¼šç»™å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œå­˜åœ¨ props å¯¹è±¡childrenå±æ€§ä¸Š\nå­ä¼ çˆ¶ å­ç»„ä»¶è°ƒç”¨çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å‡½æ•° é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶ å…„å¼Ÿç»„ä»¶é€šä¿¡ å…„å¼Ÿç»„ä»¶ä¹‹é—´é€šè¿‡çŠ¶æ€æå‡ä¼ é€’æ•°æ®\næ•°æ®è·¨å±‚é€šä¿¡ ä½¿ç”¨ createContext å‡½æ•°åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ Ctx åœ¨é¡¶å±‚ç»„ä»¶(App)ä¸­é€šè¿‡ Ctx.Provider ç»„ä»¶æä¾›æ•°æ® åœ¨åº•å±‚ç»„ä»¶(B)ä¸­é€šè¿‡ useContext hook è·å–æ¶ˆè´¹æ•°æ® useEffect useEffect æ˜¯ä¸€ä¸ª React Hookï¼Œå®ƒå…è®¸ä½  å°†ç»„ä»¶ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥\nå‚è€ƒ useEffect(setup, dependencies?)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import { useEffect } from \u0026#39;react\u0026#39; import { createConnection } from \u0026#39;./chat.js\u0026#39; function ChatRoom({ roomId }) { const [serverUrl, setServerUrl] = useState(\u0026#39;https://localhost:1234\u0026#39;) useEffect(() =\u0026gt; { const connection = createConnection(serverUrl, roomId) connection.connect() return () =\u0026gt; { connection.disconnect() } }, [serverUrl, roomId]) // ... } setupï¼šå¤„ç† Effect çš„å‡½æ•°ã€‚setup å‡½æ•°é€‰æ‹©æ€§è¿”å›ä¸€ä¸ª æ¸…ç†ï¼ˆcleanupï¼‰ å‡½æ•°ã€‚å½“ç»„ä»¶è¢«æ·»åŠ åˆ° DOM çš„æ—¶å€™ï¼ŒReact å°†è¿è¡Œ setup å‡½æ•°ã€‚åœ¨æ¯æ¬¡ä¾èµ–é¡¹å˜æ›´é‡æ–°æ¸²æŸ“åï¼ŒReact å°†é¦–å…ˆä½¿ç”¨æ—§å€¼è¿è¡Œ cleanup å‡½æ•°ï¼ˆå¦‚æœä½ æä¾›äº†è¯¥å‡½æ•°ï¼‰ï¼Œç„¶åä½¿ç”¨æ–°å€¼è¿è¡Œ setup å‡½æ•°ã€‚åœ¨ç»„ä»¶ä» DOM ä¸­ç§»é™¤åï¼ŒReact å°†æœ€åä¸€æ¬¡è¿è¡Œ cleanup å‡½æ•°ã€‚\nå¯é€‰ dependenciesï¼šsetup ä»£ç ä¸­å¼•ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ã€‚å“åº”å¼å€¼åŒ…æ‹¬ propsã€state ä»¥åŠæ‰€æœ‰ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœä½ çš„ä»£ç æ£€æŸ¥å·¥å…· é…ç½®äº† Reactï¼Œé‚£ä¹ˆå®ƒå°†éªŒè¯æ˜¯å¦æ¯ä¸ªå“åº”å¼å€¼éƒ½è¢«æ­£ç¡®åœ°æŒ‡å®šä¸ºä¸€ä¸ªä¾èµ–é¡¹ã€‚ä¾èµ–é¡¹åˆ—è¡¨çš„å…ƒç´ æ•°é‡å¿…é¡»æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å¿…é¡»åƒ [dep1, dep2, dep3] è¿™æ ·å†…è”ç¼–å†™ã€‚React å°†ä½¿ç”¨ Object.is æ¥æ¯”è¾ƒæ¯ä¸ªä¾èµ–é¡¹å’Œå®ƒå…ˆå‰çš„å€¼ã€‚å¦‚æœçœç•¥æ­¤å‚æ•°ï¼Œåˆ™åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“ç»„ä»¶ä¹‹åï¼Œå°†é‡æ–°è¿è¡Œ Effect å‡½æ•°ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¯·å‚è§ ä¼ é€’ä¾èµ–æ•°ç»„ã€ç©ºæ•°ç»„å’Œä¸ä¼ é€’ä¾èµ–é¡¹ä¹‹é—´çš„åŒºåˆ«ã€‚\nä¸åŒä¾èµ–é¡¹çš„åŒºåˆ« ä¾èµ–é¡¹ å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œæ—¶æœº æ²¡æœ‰ä¾èµ–é¡¹ ç»„ä»¶åˆæ¬¡æ¸²æŸ“+ç»„ä»¶æ›´æ–°æ—¶ ç©ºæ•°ç»„ ç»„ä»¶åˆæ¬¡æ¸²æŸ“ ç‰¹å®šä¾èµ–é¡¹ ç»„ä»¶åˆæ¬¡æ¸²æŸ“+ä¾èµ–é¡¹å˜åŒ– æ³¨æ„äº‹é¡¹ï¼š\nuseEffect æ˜¯ä¸€ä¸ª Hookï¼Œå› æ­¤åªèƒ½åœ¨ ç»„ä»¶çš„é¡¶å±‚ æˆ–è‡ªå·±çš„ Hook ä¸­è°ƒç”¨å®ƒï¼Œè€Œä¸èƒ½åœ¨å¾ªç¯æˆ–è€…æ¡ä»¶å†…éƒ¨è°ƒç”¨ã€‚å¦‚æœéœ€è¦ï¼ŒæŠ½ç¦»å‡ºä¸€ä¸ªæ–°ç»„ä»¶å¹¶å°† state ç§»å…¥å…¶ä¸­ã€‚ å¦‚æœä½  æ²¡æœ‰æ‰“ç®—ä¸æŸä¸ªå¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦ Effectã€‚ å½“ä¸¥æ ¼æ¨¡å¼å¯åŠ¨æ—¶ï¼ŒReact å°†åœ¨çœŸæ­£çš„ setup å‡½æ•°é¦–æ¬¡è¿è¡Œå‰ï¼Œè¿è¡Œä¸€ä¸ªå¼€å‘æ¨¡å¼ä¸‹ä¸“æœ‰çš„é¢å¤– setup + cleanup å‘¨æœŸã€‚è¿™æ˜¯ä¸€ä¸ªå‹åŠ›æµ‹è¯•ï¼Œç”¨äºç¡®ä¿ cleanup é€»è¾‘â€œæ˜ å°„â€åˆ°äº† setup é€»è¾‘ï¼Œå¹¶åœæ­¢æˆ–æ’¤æ¶ˆ setup å‡½æ•°æ­£åœ¨åšçš„ä»»ä½•äº‹æƒ…ã€‚å¦‚æœè¿™ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œè¯·å®ç° cleanup å‡½æ•°ã€‚ å¦‚æœä½ çš„ä¸€äº›ä¾èµ–é¡¹æ˜¯ç»„ä»¶å†…éƒ¨å®šä¹‰çš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œåˆ™å­˜åœ¨è¿™æ ·çš„é£é™©ï¼Œå³å®ƒä»¬å°† å¯¼è‡´ Effect è¿‡å¤šåœ°é‡æ–°è¿è¡Œã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·åˆ é™¤ä¸å¿…è¦çš„ å¯¹è±¡ å’Œ å‡½æ•° ä¾èµ–é¡¹ã€‚ä½ è¿˜å¯ä»¥ æŠ½ç¦»çŠ¶æ€æ›´æ–° å’Œ éå“åº”å¼çš„é€»è¾‘ åˆ° Effect ä¹‹å¤–ã€‚ å¦‚æœä½ çš„ Effect ä¸æ˜¯ç”±äº¤äº’ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰å¼•èµ·çš„ï¼Œé‚£ä¹ˆ React ä¼šè®©æµè§ˆå™¨ åœ¨è¿è¡Œ Effect å‰å…ˆç»˜åˆ¶å‡ºæ›´æ–°åçš„å±å¹•ã€‚å¦‚æœä½ çš„ Effect æ­£åœ¨åšä¸€äº›è§†è§‰ç›¸å…³çš„äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼Œå®šä½ä¸€ä¸ª tooltipï¼‰ï¼Œå¹¶ä¸”æœ‰æ˜¾è‘—çš„å»¶è¿Ÿï¼ˆä¾‹å¦‚ï¼Œå®ƒä¼šé—ªçƒï¼‰ï¼Œé‚£ä¹ˆå°† useEffect æ›¿æ¢ä¸º useLayoutEffectã€‚ å¦‚æœä½ çš„ Effect æ˜¯ç”±ä¸€ä¸ªäº¤äº’ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰å¼•èµ·çš„ï¼ŒReact å¯èƒ½ä¼šåœ¨æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ä¹‹å‰æ‰§è¡Œ Effectã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¿…é¡»è¦æ¨è¿Ÿ Effect æ‰§è¡Œåˆ°æµè§ˆå™¨ç»˜åˆ¶ä¹‹åï¼Œå’Œä½¿ç”¨ alert() ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ setTimeoutã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… reactwg/react-18/128ã€‚ å³ä½¿ä½ çš„ Effect æ˜¯ç”±ä¸€ä¸ªäº¤äº’ï¼ˆæ¯”å¦‚ç‚¹å‡»ï¼‰å¼•èµ·çš„ï¼ŒReact ä¹Ÿå¯èƒ½å…è®¸æµè§ˆå™¨åœ¨å¤„ç† Effect å†…éƒ¨çš„çŠ¶æ€æ›´æ–°ä¹‹å‰é‡æ–°ç»˜åˆ¶å±å¹•ã€‚é€šå¸¸ï¼Œè¿™æ ·æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸€å®šè¦é˜»æ­¢æµè§ˆå™¨é‡æ–°ç»˜åˆ¶å±å¹•ï¼Œåˆ™éœ€è¦ç”¨ useLayoutEffect æ›¿æ¢ useEffectã€‚ Effect åªåœ¨å®¢æˆ·ç«¯ä¸Šè¿è¡Œï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ä¸ä¼šè¿è¡Œã€‚ ä½¿ç”¨åœºæ™¯ è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import { useEffect } from \u0026#39;react\u0026#39; import { createConnection } from \u0026#39;./chat.js\u0026#39; function ChatRoom({ roomId }) { const [serverUrl, setServerUrl] = useState(\u0026#39;https://localhost:1234\u0026#39;) useEffect(() =\u0026gt; { const connection = createConnection(serverUrl, roomId) connection.connect() return () =\u0026gt; { connection.disconnect() } }, [serverUrl, roomId]) // ... } åœ¨è‡ªå®šä¹‰ Hook ä¸­å°è£… Effect Effect æ˜¯ä¸€ç§è„±å›´æœºåˆ¶ï¼šå½“ä½ éœ€è¦â€œèµ°å‡º React ä¹‹å¤–â€æˆ–è€…å½“ä½ çš„ä½¿ç”¨åœºæ™¯æ²¡æœ‰æ›´å¥½çš„å†…ç½®è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœä½ å‘ç°è‡ªå·±ç»å¸¸éœ€è¦æ‰‹åŠ¨ç¼–å†™ Effectï¼Œé‚£ä¹ˆè¿™é€šå¸¸è¡¨æ˜ä½ éœ€è¦ä¸ºç»„ä»¶æ‰€ä¾èµ–çš„é€šç”¨è¡Œä¸ºæå–ä¸€äº› è‡ªå®šä¹‰ Hookã€‚\nä¾‹å¦‚ï¼Œè¿™ä¸ª useChatRoom è‡ªå®šä¹‰ Hook æŠŠ Effect çš„é€»è¾‘â€œéšè—â€åœ¨ä¸€ä¸ªæ›´å…·å£°æ˜æ€§çš„ API ä¹‹åï¼š\n1 2 3 4 5 6 7 8 9 10 11 function useChatRoom({ serverUrl, roomId }) { useEffect(() =\u0026gt; { const options = { serverUrl: serverUrl, roomId: roomId, } const connection = createConnection(options) connection.connect() return () =\u0026gt; connection.disconnect() }, [roomId, serverUrl]) } ","date":"2024-07-12T10:23:54+08:00","permalink":"https://www.cengdong.store/p/reactreact%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/","title":"ã€Reactã€‘ReactåŸºç¡€å…¥é—¨"},{"content":"1. go-zero åˆ†å¸ƒå¼é”å®ç° çœ‹ä¸‹ go-zero ä¸­ redis åˆ†å¸ƒå¼é”çš„å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 var ( lockScript = NewScript(`if redis.call(\u0026#34;GET\u0026#34;, KEYS[1]) == ARGV[1] then redis.call(\u0026#34;SET\u0026#34;, KEYS[1], ARGV[1], \u0026#34;PX\u0026#34;, ARGV[2]) return \u0026#34;OK\u0026#34; else return redis.call(\u0026#34;SET\u0026#34;, KEYS[1], ARGV[1], \u0026#34;NX\u0026#34;, \u0026#34;PX\u0026#34;, ARGV[2]) end`) delScript = NewScript(`if redis.call(\u0026#34;GET\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;DEL\u0026#34;, KEYS[1]) else return 0 end`) ) åŠ é”å’Œè§£é”çš„è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡ lua è„šæœ¬å®ç°çš„ï¼Œå› ä¸º lua è„šæœ¬èƒ½å¤Ÿä¿è¯ redis çš„åŸå­æ€§ã€‚\n2. åˆ†å¸ƒå¼é”å¿…é¡»æ‹¥æœ‰çš„å±æ€§ æ’ä»–æ€§(åªèƒ½æœ‰ä¸€ä¸ªåç¨‹æŒæœ‰) å¯é‡å…¥(å·²ç»è·å–é”çš„åç¨‹èƒ½å†æ¬¡è®¿é—®) é˜²æ­»é”(å¿…é¡»æœ‰è¶…æ—¶æ—¶é—´ï¼Œè¾¾åˆ°åæŒæœ‰è€…è‡ªåŠ¨é‡Šæ”¾) é«˜æ€§èƒ½é«˜å¯ç”¨ 3. go-zero åˆ†å¸ƒå¼é”åŠ é”æµç¨‹ 1 2 3 4 5 6 7 8 # åˆ¤æ–­ARGV[1]æ˜¯å¦ç­‰äºKEY[1]çš„å€¼ # å¦‚æœç›¸ç­‰ï¼Œè¯´æ˜æ˜¯è¯¥é”çš„æŒæœ‰è€…é‡å…¥ï¼Œæ›´æ–°é”çš„è¿‡æœŸæ—¶é—´ï¼Œè¿”å›OK # å¦‚æœä¸æƒ³ç­‰ï¼Œè¯´æ˜é”ä¸å­˜åœ¨æˆ–è€…è¯¥ç”¨æˆ·ä¸æ˜¯é”çš„æŒæœ‰è€…ï¼Œç”¨set nx pxå‘½ä»¤æ“ä½œè¯¥key lockScript = NewScript(`if redis.call(\u0026#34;GET\u0026#34;, KEYS[1]) == ARGV[1] then redis.call(\u0026#34;SET\u0026#34;, KEYS[1], ARGV[1], \u0026#34;PX\u0026#34;, ARGV[2]) return \u0026#34;OK\u0026#34; else return redis.call(\u0026#34;SET\u0026#34;, KEYS[1], ARGV[1], \u0026#34;NX\u0026#34;, \u0026#34;PX\u0026#34;, ARGV[2]) 4. go-zero åˆ†å¸ƒå¼é”è§£é”æµç¨‹ 1 2 3 4 5 6 7 # åˆ¤æ–­ARGV[1]æ˜¯å¦ç­‰äºKEY[1]çš„å€¼ # å¦‚æœç›¸ç­‰ï¼Œè¯´æ˜æ˜¯é”çš„æ‹¥æœ‰è€…ï¼Œåˆ é™¤åˆ†å¸ƒå¼é”çš„KEY # å¦‚æœä¸æƒ³ç­‰ï¼Œè¯´æ˜ä¸æ˜¯é”çš„æ‹¥æœ‰è€…ï¼Œè¿”å›0 delScript = NewScript(`if redis.call(\u0026#34;GET\u0026#34;, KEYS[1]) == ARGV[1] then return redis.call(\u0026#34;DEL\u0026#34;, KEYS[1]) else return 0 ","date":"2023-09-28T09:30:39+08:00","permalink":"https://www.cengdong.store/p/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%88%A9%E7%94%A8redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/","title":"ã€åˆ†å¸ƒå¼é”ã€‘åˆ©ç”¨Rediså®ç°åˆ†å¸ƒå¼é”"},{"content":"1. èµ·å›  æœ€è¿‘åœ¨å­¦ä¹ go-zeroï¼Œç”¨go-zeroè‡ªå¸¦çš„sqlx+sqlcæ“ä½œæ•°æ®åº“ã€‚å› ä¸ºsqlx+sqlcä¸ä¼šåƒgormä¸€æ ·è‡ªåŠ¨ç®¡ç†è½¯åˆ é™¤å­—æ®µï¼Œæ‰€ä»¥å¯¹è¡¨ç»“æ„è¿›è¡Œé‡æ–°çš„è®¾è®¡ã€‚ ä¸‹é¢æ˜¯æ–°çš„è¡¨ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 DROP TABLE IF EXISTS `user`; CREATE TABLE `user` ( `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT \u0026#39;ç”¨æˆ·id\u0026#39;, `username` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT \u0026#39;ç”¨æˆ·å\u0026#39;, `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT \u0026#39;å¯†ç \u0026#39;, `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \u0026#39;åˆ›å»ºæ—¶é—´\u0026#39;, `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT \u0026#39;æ›´æ–°æ—¶é—´\u0026#39;, `delete_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT \u0026#39;åˆ é™¤æ—¶é—´\u0026#39;, `is_delete` tinyint unsigned NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;æ˜¯å¦è¢«åˆ é™¤\u0026#39;, `version` bigint unsigned NOT NULL DEFAULT \u0026#39;0\u0026#39; COMMENT \u0026#39;ç‰ˆæœ¬å·\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `idx_username` (`username`,`is_delete`) USING BTREE ) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=\u0026#39;ç”¨æˆ·è®°å½•\u0026#39;; ä¸šåŠ¡ä¸Šéœ€è¦usernameä¸Šè¿™ä¸ªå”¯ä¸€ç´¢å¼•ï¼ŒåŒæ—¶å½“ä¸šåŠ¡éœ€è¦åˆ é™¤æ•°æ®æ—¶åªèƒ½è½¯åˆ é™¤ï¼Œæ–¹ä¾¿æ•°æ®æº¯æºä¸æ¢å¤ã€‚\n2. é‡åˆ°çš„é—®é¢˜ å½“æ—¶åªè€ƒè™‘åˆ°ä¸šåŠ¡è¯­ä¹‰ä¸Šusernameéœ€è¦å”¯ä¸€ç´¢å¼•ï¼Œå†™å®Œä»£ç åç”¨ postman è¿›è¡Œæµ‹è¯•ï¼Œæ’å…¥ä¸€æ¡æ•°æ®ï¼Œå†åˆ é™¤è¿™æ¡æ•°æ®ã€‚å†æ’å…¥ä¸€æ¡ç›¸åŒç”¨æˆ·åçš„æ•°æ®æ—¶ï¼Œ æ¥å£æŠ¥é”™å”¯ä¸€ç´¢å¼•å†²çªã€‚å‚è€ƒgo-zeroå¾®ä¿¡ç¾¤çš„å»ºè®®ï¼Œç»™è½¯åˆ é™¤å­—æ®µis_deleteä¹ŸåŠ ä¸Šå”¯ä¸€ç´¢å¼•ã€‚æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå†åˆ é™¤è¿™æ¡æ•°æ®ã€‚å†æ’å…¥ä¸€æ¡ç›¸åŒç”¨æˆ·åçš„æ•°æ®ï¼Œ å†åˆ é™¤è¿™æ¡æ•°æ®æ—¶ï¼Œæ¥å£è¿˜æ˜¯æŠ¥é”™å”¯ä¸€ç´¢å¼•å†²çªã€‚\n3. å†åŠ ç´¢å¼• ç¾¤é‡Œç«‹é©¬åˆæœ‰å¤§ä½¬è¯´è¿˜éœ€è¦ç»™åˆ é™¤æ—¶é—´åŠ ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œå› ä¸ºåˆ é™¤æ—¶ä¸šåŠ¡ä¸Šä¼šæŠŠåˆ é™¤æ—¶é—´æ›´æ–°ä¸ºå½“å‰æ—¶é—´ï¼Œä¸ä¼šæœ‰å†²çªã€‚ä¸€é¡¿æ“ä½œä¸‹æ¥ï¼Œå°±ç»™ä¸‰ä¸ªå­—æ®µåŠ ä¸Šäº†å”¯ä¸€ç´¢å¼•ã€‚ ä¸ªäººæ„Ÿè§‰è¿™ä¸ªç´¢å¼•è¿˜æ˜¯æœ‰ç‚¹å¤§ï¼Œåˆå»ç½‘ä¸Šæ‰¾äº†ä¸å°‘ç›¸å…³åšå®¢ã€‚é¦–å…ˆç¡®å®šçš„æ˜¯ï¼š\næœ‰å”¯ä¸€ç´¢å¼•éœ€è¦çš„å­—æ®µå¿…é¡»åŠ ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œä¸èƒ½å› ä¸ºä¸šåŠ¡ä¸Šæœ‰æ ¡éªŒå°±åˆ é™¤è¯¥ç´¢å¼•ã€‚ åŒæ—¶åˆ é™¤æ•°æ®æ—¶åº”è¯¥ä½¿ç”¨è½¯åˆ é™¤ã€‚ ä½†æ˜¯æœ‰ä¸€ç‚¹å¯ä»¥ä¼˜åŒ–ï¼Œå°±æ˜¯æ ‡è®°è½¯åˆ é™¤çš„å­—æ®µä¸å¿…åªæ˜¯ 0 å’Œ 1ï¼Œå½“åˆ é™¤æ•°æ®æ—¶ï¼Œæ›´æ–°è¯¥å­—æ®µä¸ºè¯¥è®°å½•çš„ä¸»é”®å€¼ã€‚ 4. åˆé‡åˆ°é—®é¢˜ å› ä¸ºgo-zeroçš„æ•°æ®åº“æ“ä½œä»£ç æ˜¯é ä»£ç ç”Ÿæˆçš„ï¼Œä¼šæ ¹æ®ç´¢å¼•å­—æ®µè‡ªåŠ¨ç”Ÿæˆæ–¹æ³•åï¼Œå½“æœ‰å”¯ä¸€ç´¢å¼•éœ€æ±‚æ˜¯ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•åä¼šå¸¦ä¸Šç´¢å¼•çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ è½¯åˆ é™¤å­—æ®µï¼Œæ–¹æ³•åæ ¼å¤–å°´å°¬ä¸è¯´ï¼Œå†…éƒ¨ç”Ÿæˆçš„ä»£ç è¿˜å¤šåˆ¤æ–­äº†ä¸€æ¬¡is_delete = 0ï¼Œè¯·æ•™äº† looklook é¡¹ç›®ä½œè€…ï¼Œè¿™ç§éœ€è¦ fork go-zeroæºä»£ç å†è‡ªå·±è¿›è¡Œé­”æ”¹ã€‚\n","date":"2023-09-28T08:37:51+08:00","permalink":"https://www.cengdong.store/p/mysql%E8%A7%A3%E5%86%B3%E8%BD%AF%E5%88%A0%E9%99%A4%E4%B8%AD%E7%9A%84%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E9%97%AE%E9%A2%98/","title":"ã€MySQLã€‘è§£å†³è½¯åˆ é™¤ä¸­çš„å”¯ä¸€ç´¢å¼•é—®é¢˜"},{"content":"1. éœ€æ±‚ éœ€è¦æŠŠ mysql çš„æ•°æ®èšåˆåŒæ­¥åˆ° es ä»¥æä¾›æµ·é‡æ•°æ®æ£€ç´¢èƒ½åŠ›\n2. è§£å†³æ–¹æ¡ˆ å˜æ›´ mysql æ•°æ®æ—¶åŒæ­¥è°ƒç”¨ es çš„ api å˜æ›´ mysql æ•°æ®æ—¶å¼‚æ­¥è°ƒç”¨ es çš„ api(å…ˆå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœç´¢å¾®æœåŠ¡è°ƒç”¨ es çš„ api æ¶ˆè´¹æ•°æ®) canal ç›‘å¬ mysql çš„ binlog æ—¥å¿—ï¼Œå†åŒæ­¥åˆ° es flink-cdc ç›‘å¬ mysql çš„ binlog æ—¥å¿—åŒæ­¥åˆ° es 3. é€‰ç”¨æ–¹æ¡ˆ æœ€ç»ˆé€‰æ‹© flink-cdc çš„æ–¹æ¡ˆï¼Œä¸€æ˜¯ go-canal çš„ä»“åº“ä¸æ´»è·ƒï¼Œå°±ä¸‰ä¸ª issueï¼Œæäº† bug ä¹Ÿæ²¡äººä¿®ï¼Œè€Œä¸”åç»­å¯èƒ½æœ‰å®æ—¶åˆ†æçš„å¤§æ•°æ®éœ€æ±‚ï¼Œæœ¬èº«å°±æœ‰ flink é›†ç¾¤çš„éœ€æ±‚ã€‚ äºŒæ˜¯ canal çš„ release ç‰ˆæœ¬è¦æœ€è¿‘æ‰ä¼šæ›´æ–°ï¼Œæœ€åä¸€æ¬¡æ›´æ–°æ˜¯ 21 å¹´ 4 æœˆï¼Œå®³æ€•çƒ‚å°¾ã€‚ä¸‰æ˜¯ä¿ºå°è¯•éƒ¨ç½² canalï¼Œæœ€åå¤±è´¥äº† ğŸ’¦ã€‚\n4. éƒ¨ç½²ç¯å¢ƒ é€‰ç”¨ docker-compose éƒ¨ç½² mysqlã€link ä¸ elasticsearch\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 version: \u0026#39;3\u0026#39; services: elasticsearch: image: docker.elastic.co/elasticsearch/elasticsearch:7.17.13 container_name: elasticsearch user: root environment: - discovery.type=single-node - \u0026#39;ES_JAVA_OPTS=-Xms512m -Xmx512m\u0026#39; - TZ=Asia/Shanghai volumes: - ./data/elasticsearch/data:/usr/share/elasticsearch/data restart: always ports: - \u0026#39;9200:9200\u0026#39; - \u0026#39;9300:9300\u0026#39; networks: - douyin_net kibana: image: docker.elastic.co/kibana/kibana:7.17.13 container_name: kibana environment: - elasticsearch.hosts=http://elasticsearch:9200 - TZ=Asia/Shanghai restart: always networks: - douyin_net ports: - \u0026#39;5601:5601\u0026#39; depends_on: - elasticsearch mysql: image: mysql:latest container_name: mysql environment: TZ: Asia/Shanghai MYSQL_ROOT_PASSWORD: my-secret-pw ports: - \u0026#39;3306:3306\u0026#39; volumes: # æ•°æ®æŒ‚è½½ - Data mounting - ./data/mysql/data:/var/lib/mysql - ./data/mysql/my.cnf:/etc/my.cnf privileged: true restart: always networks: - douyin_net jobmanager: image: flink:latest container_name: jobmanager expose: - \u0026#39;6123\u0026#39; ports: - \u0026#39;8081:8081\u0026#39; command: jobmanager environment: - TZ=Asia/Shanghai - JOB_MANAGER_RPC_ADDRESS=jobmanager restart: always networks: - douyin_net taskmanager: image: flink:latest container_name: taskmanager expose: - \u0026#39;6121\u0026#39; - \u0026#39;6122\u0026#39; depends_on: - jobmanager command: taskmanager environment: - JOB_MANAGER_RPC_ADDRESS=jobmanager - TZ=Asia/Shanghai restart: always networks: - douyin_net networks: douyin_net: driver: bridge ipam: config: - subnet: 172.16.0.0/16 å…¶ä¸­ mysql æŒ‚è½½çš„é…ç½®æ–‡ä»¶å†…å®¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [mysqld] skip-host-cache skip-name-resolve datadir=/var/lib/mysql socket=/var/run/mysqld/mysqld.sock secure-file-priv=/var/lib/mysql-files user=mysql log-bin=mysql-bin binlog-format=ROW server_id=66 pid-file=/var/run/mysqld/mysqld.pid [client] socket=/var/run/mysqld/mysqld.sock !includedir /etc/mysql/conf.d/ ä¸»è¦æ˜¯ä¸ºäº†å¼€å¯ binlog\n5. é…ç½® å…ˆå¯åŠ¨é›†ç¾¤\n1 docker-compose up -d æ£€æŸ¥ binlog æ˜¯å¦å¼€å¯\n1 2 3 docker exec mysql -uroot -pmy-secret-pw show variables like \u0026#39;log_bin\u0026#39;; show variables like \u0026#39;binlog_format\u0026#39;; ä¸‹è½½ mysqlã€es çš„ connector å¹¶æ‹·è´åˆ°å®¹å™¨å†…éƒ¨\nflink-sql-connector-elasticsearch7-3.0.1-1.17.jar flink-sql-connector-mysql-cdc-2.4.1.jar 1 2 3 docker cp ./flink-sql-connector-elasticsearch7-3.0.1-1.17.jar jobmanager:/opt/flink/lib/ docker cp ./flink-sql-connector-mysql-cdc-2.4.1.jar jobmanager:/opt/flink/lib/ docker restart jobmanager 6. æµ‹è¯• è¿›å…¥ mysql å®¹å™¨/è¿æ¥ mysql åˆ›å»º mysql æ•°æ®åº“è¡¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 CREATE DATABASE mydb; USE mydb; CREATE TABLE orders ( order_id INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY, order_date DATETIME NOT NULL, customer_name VARCHAR(255) NOT NULL, price DECIMAL(10, 5) NOT NULL, product_id INTEGER NOT NULL, order_status BOOLEAN NOT NULL -- Whether order has been placed ) AUTO_INCREMENT = 10001; INSERT INTO orders VALUES (default, \u0026#39;2020-07-30 10:08:22\u0026#39;, \u0026#39;Jark\u0026#39;, 50.50, 102, false), (default, \u0026#39;2020-07-30 10:11:09\u0026#39;, \u0026#39;Sally\u0026#39;, 15.00, 105, false), (default, \u0026#39;2020-07-30 12:00:30\u0026#39;, \u0026#39;Edward\u0026#39;, 25.25, 106, false); è¿›å…¥ jobmanager å®¹å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 docker exec -it jobmanager /bin/bash cd bin \u0026amp;\u0026amp; ./sql-client.sh SET execution.checkpointing.interval = 3s; CREATE TABLE orders ( order_id INT, order_date TIMESTAMP(0), customer_name STRING, price DECIMAL(10, 5), product_id INT, order_status BOOLEAN, PRIMARY KEY (order_id) NOT ENFORCED ) WITH ( \u0026#39;connector\u0026#39; = \u0026#39;mysql-cdc\u0026#39;, \u0026#39;hostname\u0026#39; = \u0026#39;192.168.2.248\u0026#39;, \u0026#39;port\u0026#39; = \u0026#39;3306\u0026#39;, \u0026#39;username\u0026#39; = \u0026#39;root\u0026#39;, \u0026#39;password\u0026#39; = \u0026#39;my-secret-pw\u0026#39;, \u0026#39;database-name\u0026#39; = \u0026#39;mydb\u0026#39;, \u0026#39;table-name\u0026#39; = \u0026#39;orders\u0026#39; ); CREATE TABLE es_orders ( order_id INT, order_date TIMESTAMP(0), customer_name STRING, price DECIMAL(10, 5), product_id INT, order_status BOOLEAN, PRIMARY KEY (order_id) NOT ENFORCED ) WITH ( \u0026#39;connector\u0026#39; = \u0026#39;elasticsearch-7\u0026#39;, \u0026#39;hosts\u0026#39; = \u0026#39;http://192.168.2.248:9200\u0026#39;, \u0026#39;index\u0026#39; = \u0026#39;orders\u0026#39; ); INSERT INTO es_orders SELECT * FROM orders; è®¿é—® kibana æŸ¥è¯¢ es æ•°æ®\n1 2 3 4 5 6 GET orders/_search { \u0026#34;query\u0026#34;:{ \u0026#34;match_all\u0026#34;: {} } } ","date":"2023-09-20T22:34:29+08:00","permalink":"https://www.cengdong.store/p/flink%E5%88%A9%E7%94%A8flink-cdc%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE%E5%88%B0es/","title":"ã€Flinkã€‘åˆ©ç”¨flink CdcåŒæ­¥mysqlæ•°æ®åˆ°es"},{"content":"1. é‡åˆ°çš„é—®é¢˜ï¼šä¸Šä¼ æ–‡ä»¶åˆ°é˜¿é‡Œäº‘ Oss å¤±è´¥ï¼Œé€šè¿‡æ—¥å¿—å®šä½åˆ°æ˜¯ Linux ç³»ç»Ÿæ—¶é—´ä¸æ­£ç¡® 2. è§£å†³æ–¹æ¡ˆ 1 2 3 4 5 timedatectl set-timezone Asia/Shanghai sudo yum -y install ntp ntpdate pool.ntp.org systemctl start ntpd systemctl enable ntpd ","date":"2023-09-15T02:58:36+08:00","permalink":"https://www.cengdong.store/p/linuxcentos7%E8%A7%A3%E5%86%B3%E6%97%B6%E9%97%B4%E4%B8%8D%E6%AD%A3%E7%A1%AE%E9%97%AE%E9%A2%98/","title":"ã€Linuxã€‘Centos7è§£å†³æ—¶é—´ä¸æ­£ç¡®é—®é¢˜"},{"content":"1. ç¯å¢ƒå‡†å¤‡ M1 Mac Vmware Fusion Tech Preview ç»ˆç«¯è¿æ¥å·¥å…· Termius Centos7 è™šæ‹Ÿæœºä¸‰å°ï¼Œå†…å­˜éƒ½ä¸º 4Gï¼Œç£ç›˜ 30Gï¼Œçº¿ç¨‹æ•°ä¸º 4 master: 192.168.2.3 node-1: 192.168.2.4 node-2: 192.168.2.5 2. ä¿®æ”¹ä¸»æœºå åœ¨ä¸‰å°èŠ‚ç‚¹ä¸Šéƒ½æ‰§è¡Œ\n1 2 3 4 5 cat \u0026gt;\u0026gt; /etc/hosts \u0026lt;\u0026lt; EOF 192.168.2.3 master 192.168.2.4 node-1 192.168.2.5 node-2 EOF 1 2 3 4 5 6 # masterä¸Šæ‰§è¡Œ hostnamectl set-hostname master # node-1ä¸Šæ‰§è¡Œ hostnamectl set-hostname node-1 # node-2ä¸Šæ‰§è¡Œ hostnamectl set-hostname node-2 3. å…³é—­ selinuxã€swap 1 2 3 4 5 6 swapoff -a sed -i \u0026#39;s/enforcing/disabled/\u0026#39; /etc/selinux/config setenforce 0 echo \u0026#34;net.bridge.bridge-nf-call-iptables = 1 \u0026#34;\u0026gt;\u0026gt;/etc/sysctl.d/k8s.conf echo \u0026#34;net.bridge.bridge-nf-call-ip6tables = 1 \u0026#34;\u0026gt;\u0026gt;/etc/sysctl.d/k8s.conf sysctl --system 4. ipvs å®‰è£… 1 2 3 4 modprobe br_netfilter echo 1 \u0026gt; /proc/sys/net/bridge/bridge-nf-call-iptables echo 1 \u0026gt; /proc/sys/net/ipv4/ip_forward lsmod | grep br_netfilter 1 yum -y install ipset ipvsadm 1 2 3 4 5 6 7 cat \u0026gt; /etc/sysconfig/modules/ipvs.modules \u0026lt;\u0026lt;EOF modprobe -- ip_vs modprobe -- ip_vs_rr modprobe -- ip_vs_wrr modprobe -- ip_vs_sh modprobe -- nf_conntrack EOF 1 chmod a+x /etc/sysconfig/modules/ipvs.modules æ‰§è¡Œè„šæœ¬ /etc/sysconfig/modules/ipvs.modules\néªŒè¯ ipvs æ¨¡å— lsmod | grep -e ip_vs -e nf_conntrack_ipv4\n1 2 3 4 5 # æ‰§è¡Œè„šæœ¬ /etc/sysconfig/modules/ipvs.modules # éªŒè¯ipvsæ¨¡å— lsmod | grep -e ip_vs -e nf_conntrack_ipv4 1 2 3 4 cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/modules-load.d/containerd.conf overlay br_netfilter EOF 1 2 modprobe overlay modprobe br_netfilter 5. å®‰è£… docker 1 2 3 4 5 6 7 yum install -y yum-utils yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo yum install docker-ce-19.03.5 docker-ce-cli-19.03.5 systemctl enable docker systemctl start docker é…ç½® docker\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/docker/daemon.json { \u0026#34;insecure-registries\u0026#34;:[\u0026#34;47.99.140.12:8077\u0026#34;], \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;], \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://l10nt4hq.mirror.aliyuncs.com\u0026#34;, \u0026#34;https://registry.docker-cn.com\u0026#34;, \u0026#34;http://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34; ] } EOF #é‡æ–°åŠ è½½æœåŠ¡çš„é…ç½®æ–‡ä»¶ systemctl daemon-reload #é‡å¯docker systemctl restart docker systemctl status docker.service 6. é…ç½® k8s æº 1 2 3 4 5 6 7 8 9 10 11 12 13 cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64 enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF yum clean all yum makecache 7. å®‰è£… kubeadmã€kubectlã€kubelet 1 2 3 4 5 yum install -y kubeadm-1.23.3-0 kubectl-1.23.3-0 kubelet-1.23.3-0 --disableexcludes=kubernetes # åªåœ¨masterèŠ‚ç‚¹æ‰§è¡Œ systemctl enable kubelet systemctl start kubelet 8. master èŠ‚ç‚¹åŠ å…¥ K8s é›†ç¾¤ 1 kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.23.3 --apiserver-advertise-address 192.168.2.2 --pod-network-cidr=10.244.0.0/16 --service-cidr=10.1.0.0/16 9. master èŠ‚ç‚¹éƒ¨ç½² flannel ç½‘ç»œ 1 2 3 4 tar zxvf cni-plugins-linux-arm-v0.8.6.tgz cp flannel /opt/cni/bin chmod 777 /opt/cni/bin/flannel kubectl apply -f kube-flannel.yml 10. node èŠ‚ç‚¹åŠ å…¥ k8s é›†ç¾¤ 1 2 kubeadm join 192.168.2.2:6443 --token uxohvw.84c30cwr4g6t8he8 \\ --discovery-token-ca-cert-hash sha256:cc7e139e28e61db426dc91a3ecccc0a72f26b09af6dfd12c6171d58f4359c0e5 token å¤±æ•ˆåé‡æ–°ç”Ÿæˆ\n1 2 3 4 5 kubeadm token create # master æ‰§è¡Œ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2\u0026gt;/dev/null | openssl dgst -sha256 -hex | sed \u0026#39;s/^.* //\u0026#39; 11. node èŠ‚ç‚¹åŠ å…¥ flannel ç½‘ç»œ 1 2 3 4 5 6 7 8 # å­èŠ‚ç‚¹ä¸Šåˆ›å»ºæ–‡ä»¶å¤¹ mkdir -p /etc/cni/net.d # masterèŠ‚ç‚¹æ‹·è´æ–‡ä»¶åˆ°nodeèŠ‚ç‚¹ scp /etc/cni/net.d/10-flannel.conflist root@192.168.2.3:/etc/cni/net.d systemctl daemon-reload systemctl restart kubelet ","date":"2023-08-28T19:51:03+08:00","permalink":"https://www.cengdong.store/p/kubernetesarm%E6%9E%B6%E6%9E%84centos7%E9%80%9A%E8%BF%87kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/","title":"ã€Kubernetesã€‘armæ¶æ„Centos7é€šè¿‡kubeadmå®‰è£…k8sé›†ç¾¤"},{"content":"1. èµ·å›  æœ€è¿‘åœ¨å­¦ä¹  go-zero æ¡†æ¶ï¼ŒæŠŠ faker-douyin é¡¹ç›®é‡æ„æˆå¾®æœåŠ¡é¡¹ç›®ã€‚åœ¨é‡æ„çš„è¿‡ç¨‹ä¸­æœ‰ä¸€äº›å˜åŠ¨ï¼š\nåŸæ¥ä½¿ç”¨æœ¬åœ°è™šæ‹Ÿæœºæ„å»ºæœåŠ¡ä¸­é—´ä»¶ä¾èµ–ï¼Œç°åœ¨ä½¿ç”¨é˜¿é‡Œäº‘çš„æœåŠ¡ åŸæ¥ä¸Šä¼ è§†é¢‘æ—¶ç›´æ¥é€šè¿‡ ftp ä¸Šä¼ åˆ°è™šæ‹Ÿæœºï¼Œç°åœ¨ç›´æ¥ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ oss åœ¨ä»£ç ä¸Šä¼  github ä¸Šä¹‹åï¼Œé˜¿é‡Œäº‘å‘ç°æˆ‘çš„ accessKey åœ¨ github ä¸Šæ³„æ¼ï¼ˆä¸»è¦æ˜¯æˆ‘å®‰å…¨æ„è¯†ä¸å¥½ï¼‰\n2. è§£å†³åŠæ³• ä½¿ç”¨.gitignore æ–‡ä»¶ä½¿ git å¿½è§†é…ç½®æ–‡ä»¶ä¸Šä¼  åœ¨.gitignore æ–‡ä»¶ä¸­æ·»åŠ .yaml å¿½è§†æ‰€æœ‰ yaml ç±»å‹æ–‡ä»¶ 3. é‡åˆ°é—®é¢˜ æ›´æ”¹.gitignore æ–‡ä»¶ä¹‹åï¼Œæœ¬åœ°ä»“åº“æ²¡æœ‰ç”Ÿæ•ˆï¼ˆæ²¡æœ‰åˆ é™¤ gitignore æ–‡ä»¶åŒ¹é…çš„æ–‡ä»¶ï¼‰\n4. è§£å†³åŠæ³• 1 2 3 4 git rm --cached -r . git add . git commit -am \u0026#39;æ³¨é‡Š\u0026#39; git push ","date":"2023-08-12T15:00:13+08:00","permalink":"https://www.cengdong.store/p/git%E6%B7%BB%E5%8A%A0gitignore%E6%96%87%E4%BB%B6%E4%B9%8B%E5%90%8E%E5%88%A0%E9%99%A4github%E4%B8%8A%E5%A4%9A%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6/","title":"ã€Gitã€‘æ·»åŠ gitignoreæ–‡ä»¶ä¹‹ååˆ é™¤githubä¸Šå¤šä¸Šä¼ çš„æ–‡ä»¶"},{"content":"1. ä»‹ç» RabbitMQ is the most widely deployed open source message broker.\nç›´æ¥æŠŠ RabbitMQ å®˜ç½‘çš„ä»‹ç»æŠ„è¿‡æ¥ï¼šå®ƒæ˜¯éƒ¨ç½²æœ€å¹¿æ³›çš„æ¶ˆæ¯ä»£ç†\n2. ä½œç”¨ æ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶çš„ä½œç”¨ï¼š\nå‰Šå³°ï¼šå¤§é‡è¯·æ±‚å†™å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨æŒ‰ç…§è‡ªå·±èƒ½åŠ›å»æ¶ˆè´¹ è§£è€¦ï¼šæœåŠ¡ä¸Šæ¸¸ä¸ä¸‹æ¸¸è§£è€¦ï¼Œä¸Šæ¸¸åªéœ€æŠŠè¯·æ±‚å†™å…¥æ¶ˆæ¯ä»£ç†ï¼Œä¸‹æ¸¸åªéœ€è¦å»æ¶ˆæ¯ä¸­é—´ä»¶æ¶ˆè´¹ å¼‚æ­¥ï¼šå®æ—¶æ€§ä¸é«˜çš„åŠŸèƒ½æ”¾å…¥ä»£ç†ï¼Œå¿«é€Ÿå“åº”å®¢æˆ·ç«¯è¯·æ±‚ 3. ç«å“ ActiveMQ(å·²ç»å¯„äº†) RocketMQï¼ˆé˜¿é‡Œå¼€æºï¼Œå¹¿æ³›åº”ç”¨åœ¨ç”µå•†åœºæ™¯ï¼‰ Kafkaï¼ˆå¤§æ•°æ®åˆ©å™¨ï¼Œæ—¥å¿—ç³»ç»Ÿé‡è¦ç»„ä»¶ï¼‰ 4. ç³»ç»Ÿæ¶æ„ ç”Ÿäº§è€…ï¼šæ¶ˆæ¯å‘é€æ–¹ channelï¼šé€šä¿¡ä¿¡é“ï¼Œä¸€ä¸ªè¿æ¥é‡Œæœ‰å¤šä¸ªå¯ç”¨ä¿¡é“ï¼ˆæ„Ÿè§‰æ˜¯èµ„æºæ± ï¼‰ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½ä¼šä¸ broker å»ºç«‹è¿æ¥ exchangeï¼šäº¤æ¢æœºï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€ç»™å¯¹åº”äº¤æ¢æœºï¼ˆç”Ÿäº§è€…åªä¸äº¤æ¢æœºæ‰“äº¤é“ï¼‰ï¼Œäº¤æ¢æœºé€šè¿‡ routingKey å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ— queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜æ”¾æ¶ˆæ¯çš„å®ä½“ æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ¶ˆæ¯ è™šæ‹Ÿä¸»æœºï¼šå¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ï¼ˆä¸æƒ³æ·±å…¥ï¼Œä¹Ÿä¸åšè¿‡å¤šäº†è§£ï¼‰ 5. å·¥ä½œæ¨¡å¼ RabbitMQ å®˜æ–¹ç»™å‡ºäº†ä¸ƒç§å·¥ä½œæ¨¡å¼\nHello World Work Queues Publish/Subscribe Routing Topics RPC Publisher confirms 6. å®‰è£… RabbitMQ æˆ‘çš„è™šæ‹Ÿæœºå·²ç»å®‰è£…å¥½Dockerï¼Œé€šè¿‡ Docker å®‰è£…å¸¦ web å¯è§†åŒ–æ’ä»¶çš„RabbitMQï¼Œå…¶ä¸­ 5672 æ˜¯æœåŠ¡ç«¯çš„ç«¯å£ï¼Œ15672 æ˜¯ web å¯è§†åŒ–çš„ç«¯å£\n1 docker run --name rabbit --restart=always -p 15672:15672 -p 5672:5672 -d rabbitmq:management è®¿é—® web ç®¡ç†ç•Œé¢ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯guest\n7. åˆ›å»ºé¡¹ç›® åˆ›å»ºç›®å½•ï¼šmkdir rabbitmq-demo åˆå§‹åŒ–é¡¹ç›®ï¼šgo mod init rabbitmq-demo go å®¢æˆ·ç«¯é€‰ç”¨ï¼šè€è§„çŸ©ï¼Œæœ€å¤š star çš„é¡¹ç›®ï¼Œè™½ç„¶å·²ç»åœæ­¢ç»´æŠ¤å¾ˆä¹…äº†github.com/streadway/amqp 8. å‘é€æ¶ˆæ¯ï¼šä»¥ç®€å•æ¨¡å¼ä¸ºä¾‹ ç®€å•æ¨¡å¼å°±æ˜¯ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ è¾“æ¨¡å‹ï¼Œå®˜ç½‘ç§°ä¹‹ä¸ºHello Worldæ¨¡å¼ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™æŒ‡å®šé˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…ä»æŒ‡å®šé˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯ï¼Œå…¶ä¸­ç”Ÿäº§è€…ä»¥åŠæ¶ˆè´¹è€…éƒ½ç»‘å®šçš„æ˜¯é»˜è®¤äº¤æ¢æœºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/streadway/amqp\u0026#34; ) const url = \u0026#34;amqp://guest:guest@192.168.18.3:5672/\u0026#34; func main() { // è¿æ¥æœåŠ¡å™¨ conn, err := amqp.Dial(url) if err != nil { fmt.Println(err) } defer conn.Close() // è·å–channel channel, err := conn.Channel() defer channel.Close() if err != nil { fmt.Println(err) } // å£°æ˜é˜Ÿåˆ— queue, err := channel.QueueDeclare(\u0026#34;test\u0026#34;, false, false, false, false, nil) if err != nil { fmt.Println(err) } // å‘å¸ƒæ¶ˆæ¯ err = channel.Publish(\u0026#34;\u0026#34;, queue.Name, false, false, amqp.Publishing{ContentType: \u0026#34;text/plain\u0026#34;, Body: []byte(\u0026#34;hello world\u0026#34;)}) if err != nil { fmt.Println(err) } } 9. æ¥å—æ¶ˆæ¯ï¼šä»¥ç®€å•æ¨¡å¼ä¸ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/streadway/amqp\u0026#34; ) const rabbit_url = \u0026#34;amqp://guest:guest@192.168.18.3:5672/\u0026#34; func main() { // é“¾æ¥æœåŠ¡å™¨ conn, err := amqp.Dial(rabbit_url) if err != nil { fmt.Println(err) } defer conn.Close() // å»ºç«‹é“¾æ¥ channel, err := conn.Channel() if err != nil { fmt.Println(err) } defer channel.Close() // å£°æ˜é˜Ÿåˆ— queue, err := channel.QueueDeclare(\u0026#34;test\u0026#34;, false, false, false, false, nil) if err != nil { fmt.Println(err) } // æ¶ˆè´¹æ¶ˆæ¯ msg, err := channel.Consume(queue.Name, \u0026#34;\u0026#34;, true, false, false, false, nil) if err != nil { fmt.Println(err) } // éå†ç®¡é“ï¼Œè¯»å–æ¶ˆæ¯ for d := range msg { fmt.Println(string(d.Body)) } } 10. å¦‚ä½•ä¿éšœæ¶ˆæ¯ä¸ä¸¢å¤± 10.1 æ¶ˆæ¯åº”ç­”æœºåˆ¶ RabbitMQ æœ‰ä¸¤ç§æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼šè‡ªåŠ¨åº”ç­”å’Œæ‰‹åŠ¨åº”ç­”ï¼Œè‡ªåŠ¨åº”ç­”å³ NOACKï¼Œä¸éœ€è¦æ¥æ”¶æ–¹å›åº” ACK æ¶ˆæ¯ï¼Œé»˜è®¤æ˜¯è¿™ç§åº”ç­”æ–¹å¼ã€‚è¦å¼€å¯æ‰‹åŠ¨åº”ç­”ï¼Œé¦–å…ˆè¦æŠŠ channel.Consume æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º false\n1 func (ch *Channel) Consume(queue, consumer string, autoAck, exclusive, noLocal, noWait bool, args Table) (\u0026lt;-chan Delivery, error) è¿˜éœ€è¦åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶è°ƒç”¨Ackæˆ–Rejectæˆ– Nackæ–¹æ³•\n1 func (d Delivery) Ack(multiple bool) error 10.2 æ¶ˆæ¯æŒä¹…åŒ– è¦ä¿éšœæ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œå°±è¦ä¿éšœæ¶ˆæ¯çš„æŒä¹…åŒ–ï¼Œé¿å…æœåŠ¡å™¨æ•…éšœæˆ–é‡å¯æ—¶å†…å­˜ä¸­çš„æ¶ˆæ¯ä¸¢å¤±ã€‚æ¶ˆæ¯æŒä¹…åŒ–åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé˜Ÿåˆ—æŒä¹…åŒ–ã€æ¶ˆæ¯æŒä¹…åŒ–ã€‚\né˜Ÿåˆ—æŒä¹…åŒ–éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—æ—¶æŠŠå‚æ•° durable ä¼ ä¸º true\n1 func (ch *Channel) QueueDeclare(name string, durable, autoDelete, exclusive, noWait bool, args Table) (Queue, error) æ¶ˆæ¯æŒä¹…åŒ–éœ€è¦åœ¨å®ä¾‹åŒ–æ¶ˆæ¯æ—¶æŠŠPublishingç»“æ„ä½“çš„DeliveryModeå­—æ®µè®¾ç½®ä¸ºPersistent\n1 2 3 4 5 6 channel.Publish(\u0026#34;\u0026#34;, queue.Name, false, false, amqp.Publishing{ DeliveryMode: amqp.Persistent, ContentType: \u0026#34;text/plain\u0026#34;, Body: []byte(\u0026#34;hello world\u0026#34;), } ) 10.3 ç”Ÿäº§æ–¹å‘å¸ƒç¡®è®¤ ç”Ÿäº§æ–¹å‘å¸ƒç¡®è®¤åˆå«å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯ä¸€ç§ä¿éšœç”Ÿäº§æ–¹èƒ½ç¡®è®¤å‘å¸ƒæ¶ˆæ¯åˆ° Broker çš„æœºåˆ¶\nè¦å¼€å¯å‘å¸ƒç¡®è®¤æ¨¡å¼éœ€è¦è°ƒç”¨ channel.Conform æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 /* Confirm puts this channel into confirm mode so that the client can ensure all publishings have successfully been received by the server. After entering this mode, the server will send a basic.ack or basic.nack message with the deliver tag set to a 1 based incremental index corresponding to every publishing received after the this method returns. Add a listener to Channel.NotifyPublish to respond to the Confirmations. If Channel.NotifyPublish is not called, the Confirmations will be silently ignored. The order of acknowledgments is not bound to the order of deliveries. Ack and Nack confirmations will arrive at some point in the future. Unroutable mandatory or immediate messages are acknowledged immediately after any Channel.NotifyReturn listeners have been notified. Other messages are acknowledged when all queues that should have the message routed to them have either received acknowledgment of delivery or have enqueued the message, persisting the message if necessary. When noWait is true, the client will not wait for a response. A channel exception could occur if the server does not support this method. */ func (ch *Channel) Confirm(noWait bool) error { if err := ch.call( \u0026amp;confirmSelect{Nowait: noWait}, \u0026amp;confirmSelectOk{}, ); err != nil { return err } ch.confirmM.Lock() ch.confirming = true ch.confirmM.Unlock() return nil } å†è°ƒç”¨NotifyPublishæ–¹æ³•æˆ–NotifyConfirmæ³¨å†Œå‘å¸ƒæ¶ˆæ¯çš„å›è°ƒå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /* NotifyConfirm calls NotifyPublish and starts a goroutine sending ordered Ack and Nack DeliveryTag to the respective channels. For strict ordering, use NotifyPublish instead. */ func (ch *Channel) NotifyConfirm(ack, nack chan uint64) (chan uint64, chan uint64) { confirms := ch.NotifyPublish(make(chan Confirmation, cap(ack)+cap(nack))) go func() { for c := range confirms { if c.Ack { ack \u0026lt;- c.DeliveryTag } else { nack \u0026lt;- c.DeliveryTag } } close(ack) if nack != ack { close(nack) } }() return ack, nack } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 /* NotifyPublish registers a listener for reliable publishing. Receives from this chan for every publish after Channel.Confirm will be in order starting with DeliveryTag 1. There will be one and only one Confirmation Publishing starting with the delivery tag of 1 and progressing sequentially until the total number of Publishings have been seen by the server. Acknowledgments will be received in the order of delivery from the NotifyPublish channels even if the server acknowledges them out of order. The listener chan will be closed when the Channel is closed. The capacity of the chan Confirmation must be at least as large as the number of outstanding publishings. Not having enough buffered chans will create a deadlock if you attempt to perform other operations on the Connection or Channel while confirms are in-flight. It\u0026#39;s advisable to wait for all Confirmations to arrive before calling Channel.Close() or Connection.Close(). */ func (ch *Channel) NotifyPublish(confirm chan Confirmation) chan Confirmation { ch.notifyM.Lock() defer ch.notifyM.Unlock() if ch.noNotify { close(confirm) } else { ch.confirms.Listen(confirm) } return confirm } 11. å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ 11.1 å…¬å¹³è°ƒåº¦çš„å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ç±»ä¼¼äº Kafka çš„æ¶ˆè´¹è€…ç»„ï¼Œä¸ºäº†æé«˜æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›ã€‚ç”Ÿäº§è€…ä»£ç ä¸ç®€å•æ¨¡å¼ä¸€è‡´ï¼Œä¸ºäº†èƒ½ä»å‘½ä»¤è¡Œæ§åˆ¶è¦å‘é€çš„æ¶ˆæ¯ï¼Œåšä¸€äº›æ”¹é€ ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/streadway/amqp\u0026#34; \u0026#34;os\u0026#34; \u0026#34;strings\u0026#34; ) const url = \u0026#34;amqp://guest:guest@47.99.140.12:5672/\u0026#34; func main() { connection, err := amqp.Dial(url) if err != nil { fmt.Println(err) } defer connection.Close() channel, err := connection.Channel() if err != nil { fmt.Println(err) } defer channel.Close() queue, err := channel.QueueDeclare(\u0026#34;work_queues\u0026#34;, true, false, false, false, nil) if err != nil { fmt.Println(err) } body := bodyFrom(os.Args) err = channel.Publish(\u0026#34;\u0026#34;, queue.Name, false, false, amqp.Publishing{ ContentType: \u0026#34;text/plain\u0026#34;, DeliveryMode: amqp.Persistent, Body: []byte(body), }) if err != nil { fmt.Println(err) } fmt.Printf(\u0026#34;send msg %s\u0026#34;, body) } func bodyFrom(args []string) string { var s string if len(args) \u0026lt; 2 || os.Args[1] == \u0026#34;\u0026#34; { s = \u0026#34;hello\u0026#34; } else { s = strings.Join(args[1:], \u0026#34; \u0026#34;) } return s } æ¶ˆè´¹è€…ä»£ç ä¹Ÿä¸ç®€å•æ¨¡å¼ä¸€è‡´ï¼Œä¸ºäº†èƒ½ä»å¤šä¸ªæ¶ˆè´¹è€…åŒºåˆ†å·®å¼‚ï¼Œå¯¹æ¶ˆæ¯åšäº†ä¸€äº›è™šå‡çš„ä¸šåŠ¡å¤„ç†ï¼ˆæŒ‰ç…§æ¶ˆæ¯ä¸­å­—ç¬¦.çš„ä¸ªæ•°ç¡çœ ç›¸åº”ç§’æ•°ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 package main import ( \u0026#34;bytes\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/streadway/amqp\u0026#34; \u0026#34;time\u0026#34; ) const rabbit_url = \u0026#34;amqp://guest:guest@47.99.140.12:5672/\u0026#34; func main() { connection, err := amqp.Dial(rabbit_url) if err != nil { fmt.Println(err) } defer connection.Close() channel, err := connection.Channel() if err != nil { fmt.Println(err) } defer channel.Close() queue, err := channel.QueueDeclare(\u0026#34;work_queues\u0026#34;, true, false, false, false, nil) if err != nil { fmt.Println(err) } deliveries, err := channel.Consume(queue.Name, \u0026#34;\u0026#34;, true, false, false, false, nil) if err != nil { fmt.Println(err) } for delivery := range deliveries { fmt.Printf(\u0026#34;receive work: %s\\n\u0026#34;, delivery.Body) dotCount := bytes.Count(delivery.Body, []byte(\u0026#34;.\u0026#34;)) d := time.Duration(dotCount) time.Sleep(d * time.Second) fmt.Printf(\u0026#34;work done after %d\\n\u0026#34;, d) } } å…ˆåˆ†åˆ«åœ¨ä¸¤ä¸ªç»ˆç«¯ä¸­å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…\n1 go run receive.go å†å¯åŠ¨ç”Ÿäº§è€…å‘é€å¤šæ¡æ¶ˆæ¯\n1 2 3 4 5 go run send.go First Message. go run send.go Second Message.. go run send.go Third Message... go run send.go Fourth message.... go run send.go Fifth message..... ç”Ÿäº§è€… æ¶ˆè´¹è€… 1 æ¶ˆè´¹è€… 2 æ¶ˆè´¹è€… 1 æ¶ˆè´¹äº†æ¶ˆæ¯ 135ï¼Œæ¶ˆè´¹è€… 2 æ¶ˆè´¹äº†æ¶ˆæ¯ 24ï¼Œè¿™æ ·æé«˜äº†æ¶ˆè´¹è€…æ¶ˆè´¹çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ç”±äºå·¥ä½œé˜Ÿåˆ—æ¨¡å¼é»˜è®¤çš„æ¶ˆæ¯åˆ†å‘æœºåˆ¶æ˜¯è½®è¯¢ï¼Œå®˜ç½‘ç§°ä¹‹ä¸ºFair dispatch(å…¬å¹³è°ƒåº¦)\nå½“æœ‰å¤šä¸ªæ¶ˆè´¹è€…æ—¶ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›ä¸ä¸€æ ·ï¼Œè½®è¯¢çš„æ–¹å¼ä¼šæœ‰é—®é¢˜ã€‚\n11.2 è®¾ç½®é¢„å–å€¼çš„å·¥ä½œé˜Ÿåˆ—æ–¹å¼ ä¸ºäº†è§£å†³å…¬å¹³è°ƒåº¦å¸¦æ¥çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†é¢„å–è®¡æ•°è®¾ç½®ä¸ºå€¼1ã€‚è¿™å‘Šè¯‰RabbitMQä¸è¦ä¸€æ¬¡å‘ä¸€ä¸ªworkeræä¾›å¤šæ¡æ¶ˆæ¯ã€‚\næˆ–è€…ï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨workerå¤„ç†å¹¶ç¡®è®¤å‰ä¸€æ¡æ¶ˆæ¯ä¹‹å‰ï¼Œä¸è¦å‘workerå‘é€æ–°æ¶ˆæ¯ã€‚ç›¸åï¼Œå®ƒä¼šå°†å…¶è°ƒåº¦ç»™ä¸‹ä¸€ä¸ªå°šæœªç¹å¿™çš„å·¥ä½œäººå‘˜ã€‚\nè®¾ç½®é¢„å–å€¼éœ€è¦è°ƒç”¨ channel.Qos æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 # é€šå¸¸è®¾ç½® prefetchCount = 1 prefetchSize = 0 global = false func (ch *Channel) Qos(prefetchCount, prefetchSize int, global bool) error { return ch.call( \u0026amp;basicQos{ PrefetchCount: uint16(prefetchCount), PrefetchSize: uint32(prefetchSize), Global: global, }, \u0026amp;basicQosOk{}, ) } ","date":"2023-07-31T00:02:07+08:00","permalink":"https://www.cengdong.store/p/gorabbitmq%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","title":"ã€Goã€‘RabbitMQå­¦ä¹ ç¬”è®°"}]